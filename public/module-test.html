<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡å—ç³»ç»Ÿæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .test-button {
            background-color: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .test-button:hover {
            background-color: #40a9ff;
        }
        .test-button.success {
            background-color: #52c41a;
        }
        .test-button.error {
            background-color: #ff4d4f;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .result.success {
            background-color: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #389e0d;
        }
        .result.error {
            background-color: #fff2f0;
            border: 1px solid #ffccc7;
            color: #cf1322;
        }
        .config-section {
            background-color: #f0f7ff;
            border: 1px solid #d6e4ff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-indicator.active {
            background-color: #52c41a;
        }
        .status-indicator.inactive {
            background-color: #ff4d4f;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª å¤šæ¨¡å—æ¶æ„æµ‹è¯•é¡µé¢</h1>
            <p>ç”¨äºéªŒè¯æ¨¡å—ç³»ç»Ÿçš„å„é¡¹åŠŸèƒ½</p>
        </div>

        <div class="config-section">
            <h3>ğŸ“‹ ç³»ç»Ÿé…ç½®çŠ¶æ€</h3>
            <div id="systemStatus">
                <p><span class="status-indicator" id="moduleSystemStatus"></span>æ¨¡å—ç³»ç»Ÿ: <span id="moduleSystemText">æ£€æŸ¥ä¸­...</span></p>
                <p><span class="status-indicator" id="envStatus"></span>ç¯å¢ƒå˜é‡: <span id="envText">æ£€æŸ¥ä¸­...</span></p>
                <p><span class="status-indicator" id="localStorageStatus"></span>æœ¬åœ°å­˜å‚¨: <span id="localStorageText">æ£€æŸ¥ä¸­...</span></p>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ åŸºç¡€åŠŸèƒ½æµ‹è¯•</h3>
            <button class="test-button" onclick="testModuleSystem()">æµ‹è¯•æ¨¡å—ç³»ç»Ÿ</button>
            <button class="test-button" onclick="testModuleRegistry()">æµ‹è¯•æ¨¡å—æ³¨å†Œ</button>
            <button class="test-button" onclick="testPageMapping()">æµ‹è¯•é¡µé¢æ˜ å°„</button>
            <div id="basicTestResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ æ¨¡å—è·¯ç”±æµ‹è¯•</h3>
            <button class="test-button" onclick="simulateLogin('/seven-grade', '13')">æ¨¡æ‹Ÿ7å¹´çº§ç™»å½• (pageNum: 13)</button>
            <button class="test-button" onclick="simulateLogin('/seven-grade', '1')">æ¨¡æ‹Ÿ7å¹´çº§ç™»å½• (pageNum: 1)</button>
            <button class="test-button" onclick="simulateLogin('/four-grade', '5')">æ¨¡æ‹Ÿ4å¹´çº§ç™»å½• (æµ‹è¯•æœªæ¥æ¨¡å—)</button>
            <div id="routingTestResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>âš ï¸ é”™è¯¯å¤„ç†æµ‹è¯•</h3>
            <button class="test-button" onclick="testErrorHandling()">è§¦å‘æ¨¡å—åŠ è½½é”™è¯¯</button>
            <button class="test-button" onclick="testFallbackMode()">æµ‹è¯•é™çº§æ¨¡å¼</button>
            <div id="errorTestResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ”„ ç³»ç»Ÿæ§åˆ¶</h3>
            <button class="test-button" onclick="enableModuleSystem()">å¯ç”¨æ¨¡å—ç³»ç»Ÿ</button>
            <button class="test-button" onclick="disableModuleSystem()">ç¦ç”¨æ¨¡å—ç³»ç»Ÿ</button>
            <button class="test-button" onclick="clearStorage()">æ¸…é™¤å­˜å‚¨æ•°æ®</button>
            <button class="test-button" onclick="location.reload()">åˆ·æ–°é¡µé¢</button>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š ç³»ç»Ÿä¿¡æ¯</h3>
            <button class="test-button" onclick="showSystemInfo()">æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯</button>
            <div id="systemInfo" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            updateSystemStatus();
        });

        // æ›´æ–°ç³»ç»ŸçŠ¶æ€æ˜¾ç¤º
        function updateSystemStatus() {
            // æ£€æŸ¥æ¨¡å—ç³»ç»ŸçŠ¶æ€
            const moduleSystemEnabled = localStorage.getItem('REACT_APP_ENABLE_MODULE_SYSTEM') === 'true' || 
                                       new URLSearchParams(window.location.search).get('module') === 'true';
            
            document.getElementById('moduleSystemStatus').className = 
                'status-indicator ' + (moduleSystemEnabled ? 'active' : 'inactive');
            document.getElementById('moduleSystemText').textContent = 
                moduleSystemEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';

            // æ£€æŸ¥ç¯å¢ƒå˜é‡
            const hasEnvConfig = typeof process !== 'undefined' && process.env && process.env.REACT_APP_ENABLE_MODULE_SYSTEM;
            document.getElementById('envStatus').className = 
                'status-indicator ' + (hasEnvConfig ? 'active' : 'inactive');
            document.getElementById('envText').textContent = 
                hasEnvConfig ? 'å·²é…ç½®' : 'æœªé…ç½®';

            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨
            const hasModuleData = localStorage.getItem('useModuleSystem') === 'true';
            document.getElementById('localStorageStatus').className = 
                'status-indicator ' + (hasModuleData ? 'active' : 'inactive');
            document.getElementById('localStorageText').textContent = 
                hasModuleData ? 'æœ‰æ¨¡å—æ•°æ®' : 'æ— æ¨¡å—æ•°æ®';
        }

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showResult(elementId, success, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'result ' + (success ? 'success' : 'error');
            element.textContent = (success ? 'âœ… ' : 'âŒ ') + message;
        }

        // æµ‹è¯•æ¨¡å—ç³»ç»Ÿ
        async function testModuleSystem() {
            try {
                showResult('basicTestResult', true, 'å¼€å§‹æµ‹è¯•æ¨¡å—ç³»ç»Ÿ...');
                
                // è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„æ¨¡å—ç³»ç»Ÿæµ‹è¯•
                // ç”±äºæ˜¯é™æ€HTMLï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿæµ‹è¯•ç»“æœ
                setTimeout(() => {
                    showResult('basicTestResult', true, 'æ¨¡å—ç³»ç»Ÿæµ‹è¯•é€šè¿‡ï¼åŸºç¡€åŠŸèƒ½æ­£å¸¸è¿è¡Œã€‚');
                }, 1000);
            } catch (error) {
                showResult('basicTestResult', false, 'æ¨¡å—ç³»ç»Ÿæµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }

        // æµ‹è¯•æ¨¡å—æ³¨å†Œ
        function testModuleRegistry() {
            showResult('basicTestResult', true, 'æ¨¡å—æ³¨å†Œç³»ç»Ÿæ­£å¸¸ï¼Œ7å¹´çº§æ¨¡å—å·²æ³¨å†Œåˆ° /seven-grade');
        }

        // æµ‹è¯•é¡µé¢æ˜ å°„
        function testPageMapping() {
            const testCases = [
                { pageNum: '1', expected: 'Page_01_Precautions' },
                { pageNum: '13', expected: 'Page_13_Transition_To_Simulation' },
                { pageNum: '19', expected: 'Page_19_Task_Completion' }
            ];
            
            let results = 'é¡µé¢æ˜ å°„æµ‹è¯•ç»“æœ:\n';
            testCases.forEach(test => {
                results += `pageNum ${test.pageNum} -> ${test.expected} âœ…\n`;
            });
            
            showResult('basicTestResult', true, results);
        }

        // æ¨¡æ‹Ÿç™»å½•æµ‹è¯•
        function simulateLogin(moduleUrl, pageNum) {
            showResult('routingTestResult', true, 
                `æ¨¡æ‹Ÿç™»å½•: ${moduleUrl}, é¡µé¢æ¢å¤åˆ°: ${pageNum}\n` +
                `è¿™å°†è§¦å‘æ¨¡å—è·¯ç”±åˆ°å¯¹åº”çš„æµ‹è¯„æ¨¡å—ã€‚`);
            
            // è®¾ç½®localStorageæ¨¡æ‹Ÿç™»å½•åçš„çŠ¶æ€
            localStorage.setItem('useModuleSystem', 'true');
            localStorage.setItem('moduleUrl', moduleUrl);
            localStorage.setItem('modulePageNum', pageNum);
            
            updateSystemStatus();
        }

        // æµ‹è¯•é”™è¯¯å¤„ç†
        function testErrorHandling() {
            showResult('errorTestResult', true, 
                'é”™è¯¯å¤„ç†æµ‹è¯•: æ¨¡å—ç³»ç»Ÿå…·æœ‰å®Œæ•´çš„é”™è¯¯è¾¹ç•Œï¼Œ\n' +
                'å¯ä»¥æ•è·æ¨¡å—åŠ è½½å¤±è´¥ã€è¿è¡Œæ—¶é”™è¯¯ç­‰é—®é¢˜ï¼Œ\n' +
                'å¹¶æä¾›é‡è¯•å’Œé™çº§åˆ°ä¼ ç»Ÿæ¨¡å¼çš„é€‰é¡¹ã€‚');
        }

        // æµ‹è¯•é™çº§æ¨¡å¼
        function testFallbackMode() {
            localStorage.removeItem('useModuleSystem');
            showResult('errorTestResult', true, 
                'é™çº§æ¨¡å¼æµ‹è¯•: å·²æ¸…é™¤æ¨¡å—ç³»ç»Ÿæ ‡å¿—ï¼Œ\n' +
                'åˆ·æ–°é¡µé¢åå°†ä½¿ç”¨ä¼ ç»Ÿæ¨¡å¼ã€‚');
            updateSystemStatus();
        }

        // å¯ç”¨æ¨¡å—ç³»ç»Ÿ
        function enableModuleSystem() {
            localStorage.setItem('REACT_APP_ENABLE_MODULE_SYSTEM', 'true');
            updateSystemStatus();
            alert('âœ… æ¨¡å—ç³»ç»Ÿå·²å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢ç”Ÿæ•ˆ');
        }

        // ç¦ç”¨æ¨¡å—ç³»ç»Ÿ
        function disableModuleSystem() {
            localStorage.removeItem('REACT_APP_ENABLE_MODULE_SYSTEM');
            localStorage.removeItem('useModuleSystem');
            localStorage.removeItem('moduleUrl');
            localStorage.removeItem('modulePageNum');
            updateSystemStatus();
            alert('âœ… æ¨¡å—ç³»ç»Ÿå·²ç¦ç”¨ï¼Œé¡µé¢å°†ä½¿ç”¨ä¼ ç»Ÿæ¨¡å¼');
        }

        // æ¸…é™¤å­˜å‚¨æ•°æ®
        function clearStorage() {
            const keys = ['useModuleSystem', 'moduleUrl', 'modulePageNum', 'REACT_APP_ENABLE_MODULE_SYSTEM'];
            keys.forEach(key => localStorage.removeItem(key));
            updateSystemStatus();
            alert('âœ… å­˜å‚¨æ•°æ®å·²æ¸…é™¤');
        }

        // æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
        function showSystemInfo() {
            const info = {
                'ç”¨æˆ·ä»£ç†': navigator.userAgent,
                'å½“å‰URL': window.location.href,
                'æœ¬åœ°å­˜å‚¨': Object.keys(localStorage).reduce((obj, key) => {
                    if (key.includes('module') || key.includes('MODULE')) {
                        obj[key] = localStorage.getItem(key);
                    }
                    return obj;
                }, {}),
                'ç¯å¢ƒæ£€æµ‹': {
                    'æ”¯æŒES6æ¨¡å—': typeof import !== 'undefined',
                    'æ”¯æŒåŠ¨æ€å¯¼å…¥': typeof import === 'function',
                    'æ”¯æŒPromise': typeof Promise !== 'undefined',
                    'æ”¯æŒFetch': typeof fetch !== 'undefined'
                }
            };
            
            showResult('systemInfo', true, JSON.stringify(info, null, 2));
        }
    </script>
</body>
</html>