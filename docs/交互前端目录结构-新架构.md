交互前端目录结构（新架构建议）

目标
- 支撑统一提交/计时/页面框架/导航、CMI 子模块与 Flow 编排运行时；
- 保持对现有模块的最小侵入（包装器适配），允许渐进迁移；
- 目录清晰、职责分明、便于测试与复用。

推荐目录树
```
src/
  app/
    App.jsx                     # 顶层应用
    ModuleRouter.jsx            # 模块/Flow 路由入口

  flows/                        # Flow 编排运行时
    FlowModule.jsx              # /flow/<flowId> 入口模块
    orchestrator/
      FlowOrchestrator.ts       # 核心编排逻辑（拉取定义、定位进度、切换子模块）
      types.ts                  # FlowDefinition/Progress 类型
      utils.ts                  # 复合页码解析、进度计算

  submodules/                   # 子模块包装器（CMI 适配层）
    g7-experiment/              # 7年级蒸馒头-交互
      index.jsx                 # 导出 CMI 接口与 Component
      mapping.ts                # 页码与 pageId 映射、步数
    g7-questionnaire/
      index.jsx
      mapping.ts
    g7-tracking-experiment/
      index.jsx
      mapping.ts
    g7-tracking-questionnaire/
      index.jsx
      mapping.ts
    g4-experiment/
      index.jsx
      mapping.ts
    registry.ts                 # submoduleId → Component/元数据 的注册映射

  shared/                       # 可复用的通用能力与UI
    ui/
      LeftStepperNav/
        index.tsx               # 统一导航（像素级复用7年级视觉）
        styles.module.css
      TimerDisplay/
        index.tsx               # 统一计时器显示（像素级复用7年级视觉）
        styles.module.css
      PageFrame/
        AssessmentPageFrame.tsx # 统一页面框架（导航+计时+主体+下一页+错误托盘）
        TransitionPage.tsx      # 过渡页组件
        frame.module.css
    services/
      submission/
        usePageSubmission.ts    # 统一提交Hook（重试、401处理、校验）
        eventTypes.ts           # 标准事件枚举
      timers/
        TimerService.ts         # 统一计时引擎（task/questionnaire/notice）
      storage/
        storageKeys.ts          # 命名空间与键名
      api/
        apiClient.ts            # fetch/axios 封装（credentials/include）
        endpoints.ts            # 端点集中管理
    styles/
      nav-tokens.css            # 导航样式token（CSS变量）
      timer-tokens.css          # 计时器样式token（CSS变量）
    types/
      mark.ts                   # MarkObject/Operation/Answer TS 类型
      flow.ts                   # FlowDefinition/Progress 类型（与 orchestrator 对齐）

  modules/                      # 现有模块（保留）
    grade-4/
    grade-7/
    grade-7-tracking/

  context/
    AppContext.jsx              # 平台上下文（兼容保留）

  hooks/
    useHeartbeat.ts             # 心跳/进度回写（可选）

  utils/
    pageMappings.js             # 旧映射（与 CMI mapping 并存，逐步迁移）

  shared/legacy/                # 旧通用组件（过渡期）

  assets/
  styles/
  mocks/
```

迁移说明
- 新增 shared/ui 统一组件（LeftStepperNav/TimerDisplay/PageFrame），从 7 年级视觉像素级抽取；
- 子模块使用 CMI 包装器输出，映射位于 `submodules/*/mapping.ts`；
- FlowModule 驱动 FlowDefinition 的加载与子模块切换；
- FlowModule 在顶层通过 `<Route path="/flow/:flowId" element={<FlowModule key={flowId} flowId={flowId} />}>` 接线，依赖 `key=flowId` 强制卸载旧实例；内部的 `useEffect([flowId])` 也会销毁/重建 Orchestrator，避免从 `/flow/A` 切换到 `/flow/B` 时串页码或残留心跳。
- 提交/计时/存储统一从 shared/services 管理，历史路径逐步替换。

命名与类型
- 子模块ID（submoduleId）：kebab-case（如：`g7-experiment`）；
- 复合页码：推荐 `M<stepIndex>:<subPageNum>` 或 `stepIndex.subPageNum`；
- TS 类型集中在 `shared/types`，与 openspec 数据格式一致。

文档与规范引用
- 数据格式：`docs/data-format-specifications.md`（同步于 `openspec/specs/data-format/spec.md`）
- 会话与Cookie策略：`docs/session-and-cookie-policy.md`（同步于 `openspec/specs/security/session-cookie/spec.md`）
