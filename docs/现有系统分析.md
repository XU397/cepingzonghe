HCI-Evaluation 棕地增强架构文档
版本: 1.0
日期: 2025年7月25日
作者: Winston, BMad项目架构师

文档目的
本文件的核心目标是为“HCI-Evaluation”项目从单一模块向多模块平台的演进，提供一个清晰、可行且对AI和初级开发者友好的技术架构蓝图。本文档将作为所有后续功能开发、代码实现和测试工作的“唯一真实来源”（Single Source of Truth）。

项目目标
项目的首要业务目标是扩展现有的人机交互测评应用，集成一个全新的四年级“火车购票”测评模块。技术上的核心目标是构建一个可扩展的模块化前端架构，同时必须保证现有的七年级“蒸馒头”模块的功能和稳定性不受任何影响。

变更日志
日期	版本	描述	作者
2025-07-25	1.0	初始版本，定义了从单模块到多模块的混合架构方案。	Winston

导出到 Google 表格
1.0 项目现状分析 (Existing System Analysis)
1.1 现有架构
当前应用是一个基于React和Vite构建的单页应用（SPA），用于完成七年级的“蒸馒头”科学探究任务。

状态管理: 使用React Context API (AppContext.jsx) 进行全局状态管理，并通过localStorage实现会话恢复。

页面路由: 采用一个自定义的路由组件 PageRouter.jsx 来控制页面流程。

核心约束: 现有代码库包含了大量（约379个）的相对路径依赖。为了避免引入风险，我们必须将现有代码视为一个整体，不做任何内部文件移动、重命名或重构。

1.2 关键文件
src/context/AppContext.jsx: 全局状态和核心业务逻辑。

src/services/apiService.js: 后端API通信服务。

src/components/PageRouter.jsx: 现有模块的页面路由控制器。

src/utils/jsencrypt.ts: 用于登录密码的RSA加密。

2.0 多模块增强策略 (Multi-Module Enhancement Strategy)
为了在不破坏现有模块的前提下实现平滑扩展，我们将采用一种混合架构（Hybrid Architecture）。

2.1 架构方法
封装现有模块: 我们将使用包装器模式 (Wrapper Pattern) 将现有的七年级模块完整地封装起来，作为一个独立的“遗留模块”进行管理。

构建新模块体系: 所有新模块（包括四年级“火车购票”）将在一个全新的、清晰的模块化结构中开发。

建立共享层: 逐步将可复用的UI组件、Hooks和服务提取到一个共享层，供所有模块使用。

2.2 新增目录结构
我们将引入 modules 和 shared 两个新的一级目录。

Plaintext

src/
├── modules/                  # 新的模块化系统根目录
│   ├── grade-4/              # 【新】四年级“火车购票”模块
│   ├── grade-7/              # 【新】七年级“蒸馒头”模块的包装器
│   ├── ModuleRegistry.js     # 【新】模块注册中心
│   └── ModuleRouter.jsx      # 【新】顶层模块路由器
├── shared/                   # 【新】跨模块共享的代码
│   ├── components/           # 共享UI组件 (如: 定时器, 按钮)
│   ├── services/             # 共享服务 (如: apiService)
│   ├── hooks/                # 共享Hooks
│   └── utils/                # 共享工具函数
└── ... (所有现有文件和目录保持原位)
2.3 模块化路由
我们将引入一个新的顶层路由组件 ModuleRouter.jsx，它将取代 App.jsx 中原有的路由逻辑。

路由逻辑: 用户登录后，后端会返回一个 url 字段（例如 "/seven-grade" 或 "/four-grade"）。

模块选择: ModuleRouter.jsx 会根据这个 url 字段，从 ModuleRegistry.js 中查找并加载对应的模块组件。

3.0 新模块：“火车购票”
3.1 模块概述
新模块是一个面向四年级学生的测评任务，主题为“火车购票”。它包含了一系列复杂的交互任务，旨在评估用户的信息获取、路径计算、时间规划和多约束决策能力。

3.2 模块结构
该模块的所有代码将存放在 src/modules/grade-4/ 目录下，并拥有自己独立的内部结构，例如：

Plaintext

grade-4/
├── components/       # 该模块独有的UI组件
├── context/          # 模块内部的状态管理
├── pages/            # 模块的各个测评页面
├── utils/            # 模块独有的工具函数
└── index.jsx         # 模块入口文件
3.3 关键技术挑战
根据需求文档，该模块有几个技术实现难点，AI开发时需要特别注意：

时间规划拖拽界面 (题目 7 & 8): 这需要实现一个轻量级的甘特图逻辑。当用户拖拽任务块时，需要实时计算任务的关键路径来确定“总用时”，而不是简单地将时间相加。

自定义小键盘 (题目 10): 需要从零开始构建一个屏幕小键盘组件，用于捕获用户的计算公式和结果，以分析其解题思路。

严格的页面流程控制: 必须实现单向、不可逆的页面流，并禁用浏览器的后退功能。

4.0 共享组件与服务 (Shared Components & Services)
共享层的目标是提升代码复用率和开发效率。

迁移策略: 我们将采取渐进式的提取策略。初期，只将最核心的服务（如API通信）放入共享层。未来在开发新模块时，再逐步将通用的UI组件（如按钮、模态框）提取出来。

初期共享服务:

src/shared/services/apiService.js: 负责所有与后端API的通信。

src/shared/services/dataLogger.js: 封装 logOperation 和 collectAnswer 等数据上报逻辑，确保所有模块的上报格式一致。

5.0 数据提交标准 (强制)
这是与后端集成的核心契约，所有模块都必须严格遵守。

Endpoint: POST /stu/saveHcMark

数据格式: 必须使用 FormData，而不是 JSON。

markObject 结构: FormData 中 mark 字段的值必须是一个包含以下结构的JSON字符串：

JavaScript

{
  pageNumber: "字符串类型-页码",
  pageDesc: "字符串类型-页面描述",
  operationList: [ /* 包含所有用户交互记录的对象数组 */ ],
  answerList: [ /* 包含最终答案的对象数组 */ ],
  beginTime: "字符串类型-进入页面时间 (YYYY-MM-DD HH:mm:ss)",
  endTime: "字符串类型-离开页面时间 (YYYY-MM-DD HH:mm:ss)",
  imgList: []
}
必需函数: 每个模块都必须调用 logOperation() 来记录所有用户交互，并调用 collectAnswer() 来记录最终答案。

6.0 AI开发编码规范
为了让AI能更好地理解和执行任务，我们制定以下简化规范：

文件命名:

React组件: PascalCase (例如: TrainTicketSelector.jsx)

Hooks: camelCase，并以 use 开头 (例如: useTimer.js)

组件结构: 使用函数式组件和Hooks。

核心规则:

严禁修改 src/modules 和 src/shared 目录之外的任何现有文件（除非在明确的重构任务中）。

所有数据上报必须通过 src/shared/services/dataLogger.js 中的共享函数进行。

所有新组件必须做到样式和功能的解耦。

为关键的、复杂的业务逻辑函数编写注释。

7.0 实施阶段 (Implementation Phasing)
为确保平稳过渡，我们将分阶段进行开发：

阶段一：基础设施搭建: 创建 modules 和 shared 目录，添加 ModuleRouter.jsx 和 ModuleRegistry.js 文件，但不激活它们。

阶段二：增强认证: 修改登录逻辑，使其能处理后端返回的 url 字段，并将其存入全局状态。

阶段三：激活模块路由: 在 App.jsx 中正式启用 ModuleRouter，使其成为应用的顶层路由。

阶段四：开发新模块: 在 src/modules/grade-4/ 目录下，根据需求文档和本架构文档，完整开发“火车购票”模块。

阶段五：测试与部署: 进行端到端测试，确保两个模块都能正常路由和运行，然后进行部署。