需求文档：管理后台前端（Admin）

背景与目标
- 背景：为支撑“拼装式测评（Flow）”与批次管理、评分与分析，需要在管理后台提供可视化配置与运营能力。
- 目标：
  - 以图形化方式配置与发布 Flow（子模块序列/过渡页/计时覆盖/变体参数）；
  - 为批次绑定 Flow 并导入账号；
  - 提供数据浏览、评分配置与分析报表；
  - 强化权限与审计。

功能模块与需求
1) Flow Composer（拼装器）
- 能力：新建/编辑/复制/预览/发布/版本化/回滚。
- 步骤编辑：从“子模块注册表”选择 submoduleId（带 displayName/version），可排序；每步可设置：
  - overrides：`timers.task/questionnaire/notice`、`options`（UI/阈值/文案）
  - transitionPage：`title/desc/autoNextSeconds/nextButtonText` 等
- 校验：子模块兼容性、重复、空步骤、计时非负、版本冲突。
- 预览：生成本地 preview URL（沙箱模式），不写正式数据；
- 发布：生成 `flowId` 与 `url: /flow/<flowId>`，状态设为 `published`，写入版本号。

2) Flow 列表与详情
- 列表：显示 flowId、name、url、version、status、创建/发布信息、使用中的批次数量；
- 详情：JSON/差异对比、版本历史、预览入口、回滚按钮、审计记录。

3) 批次与账号管理
- 批次-Flow 绑定：选择已有 Flow 绑定到批次（或解绑/更换）；
- 账号导入：批量导入账号（Excel/CSV），校验必填字段与重复；
- 账号/批次详情：展示绑定的 Flow、当前进度（stepIndex/modulePageNum）、最近提交时间、异常告警（如 401、长时间无心跳）。

4) 数据浏览与评分配置
- 沿用现有模块

5) 权限与审计
- RBAC：角色（管理员、出题方、阅卷方、运维）、权限矩阵（Flow 管理/批次管理/数据查看/评分/报表/审计）。
- 审计：Flow 发布、回滚、批次绑定变更、账号导入操作记录。

API 集成点
- 子模块注册表：`GET /api/submodules`（可选，或静态配置）
- Flow：`POST /api/flows`、`GET /api/flows/{flowId}`、`POST /api/flows/{id}/publish`、`GET /api/flows`
- 批次绑定：`POST /api/batches/{batchCode}/assign-flow`、`GET /api/batches/{batchCode}/flow`
- 账号导入：`POST /api/accounts/import`
- 进度查看：`GET /api/progress?batchCode=...&examNo=...`
- 数据浏览：`GET /api/marks?filters=...`（分页）
- 评分配置/计算：`POST /api/scoring/rules`、`POST /api/scoring/run`（可选）

交互说明（要点）
- Flow Composer：拖拽排序、可视化步骤卡片、每步配置抽屉；保存草稿与发布分离；
- 批次绑定：支持批量操作、搜索筛选；
- 数据浏览器：多维筛选 + 表格 + 详情弹窗；
- 报表：可保存查询条件，下载导出。

非功能需求
- 安全：权限校验、CSRF/鉴权、敏感操作二次确认；
- 可靠：发布/回滚/绑定提供事务保障；
- 性能：大表筛选分页、后端索引支撑；
- 可观测：关键操作日志、错误上报、埋点。

验收标准
- 可完成 Flow 的创建、编辑、预览、发布、回滚全流程；
- 批次可绑定 Flow，登录后考试端可按 `/flow/<id>` 进入并恢复进度；
- 能按筛选条件浏览 Mark 数据，拉取报表；
- 权限/审计记录完整；异常操作有清晰提示。

里程碑
- M1：Flow Composer MVP（草稿/发布/预览）、批次绑定、账号导入；
- M2：数据浏览与基础报表；
- M3：评分配置与规则执行；
- M4：权限矩阵与审计完善。

