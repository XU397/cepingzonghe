# **6.0 史诗详情 (Epic Details)**

### **史诗 1: 多模块应用框架 (Multi-Module Application Framework)**

**史诗目标**: 对现有应用进行升级，搭建一个灵活、可扩展的多模块基础框架。此框架将能够根据用户身份动态加载不同的测评模块，同时必须确保现有七年级“蒸馒头”模块的绝对稳定和零代码改动。

---

#### **故事 1.1 (修订版): 基础设施搭建与安全重构 (Infrastructure Setup & Safe Refactoring)**

* **用户故事**: 作为一个开发者，我想要创建新的 modules 和 shared 目录结构，并将核心的API服务和数据上报逻辑**通过配置路径别名的方式**安全地迁移到 shared 目录中，以便为模块化开发和代码复用打下基础，**同时确保不修改任何现有模块的源代码**。  
* **验收标准**:  
  1. 项目根目录下成功创建 src/modules 和 src/shared 两个新目录。  
  2. src/shared 目录下包含 services, utils, hooks, components 等子目录。  
  3. 现有的 apiService.js 文件被移动到 src/shared/services/ 目录下。  
  4. **vite.config.js 文件被更新，添加了路径别名，使得对 src/services/apiService.js 的导入能够被正确解析到新路径。**  
  5. 创建一个新的 dataLogger.js 文件于 src/shared/services/，并封装数据上报逻辑。  
  6. 七年级模块的源代码**没有任何改动**，并且在功能上验证通过，能够正常调用API。

---

#### **故事 1.2: 模块注册与封装 (Module Registration & Wrapping)**

* **用户故事**: 作为一个开发者，我想要创建一个模块注册表 (ModuleRegistry.js) 来定义所有可用的测评模块，并为现有的七年级模块创建一个包装器 (wrapper.jsx)，以便新系统能将其作为一个标准模块来对待。  
* **验收标准**:  
  1. 成功创建 src/modules/ModuleRegistry.js 文件。  
  2. 注册表中至少定义了两个模块：grade-7 (蒸馒头) 和 grade-4 (火车购票)，并分别映射到URL路径 "/seven-grade" 和 "/four-grade"。  
  3. 成功创建 src/modules/grade-7/wrapper.jsx 文件。  
  4. 该包装器组件的功能是渲染现有的 PageRouter.jsx 组件，除此之外无任何其他逻辑。  
  5. 现有七年级模块的所有代码文件**未被**做任何修改。

---

#### **故事 1.3: 认证流程增强 (Authentication Flow Enhancement)**

* **用户故事**: 作为一个开发者，我需要修改登录逻辑，使其能够正确处理并存储从后端API返回的 url 字段，以便为后续的动态模块路由提供决策依据。  
* **验收标准**:  
  1. 当用户成功登录后，应用能从API响应中正确提取 url 字段。  
  2. 提取出的 url 值被成功存储到全局的 AppContext 状态中。  
  3. 如果API没有返回 url 字段，系统应有默认的处理方式（例如，默认导航至七年级模块）。  
  4. 现有的密码加密和用户认证逻辑保持不变。

---

#### **故事 1.4: 顶层模块路由器实现 (Top-Level Module Router Implementation)**

* **用户故事**: 作为一个开发者，我想要创建一个新的顶层路由组件 (ModuleRouter.jsx)，它将作为整个应用的入口，负责根据全局状态中的 url 值来动态加载和渲染对应的模块。  
* **验收标准**:  
  1. 成功创建 src/modules/ModuleRouter.jsx 文件。  
  2. 该组件能够从 AppContext 中读取 url 值。  
  3. 该组件能够使用 ModuleRegistry.js 来查找 url 对应的模块组件。  
  4. 当 url 为 "/seven-grade" 时，ModuleRouter 成功渲染七年级的包装器组件。  
  5. 当 url 为 "/four-grade" 时，ModuleRouter 能够尝试渲染四年级的模块组件（即使该模块此时尚不存在，也应有占位符或空组件）。

---

#### **故事 1.5: 激活新模块系统 (Activate New Module System)**

* **用户故事**: 作为一个开发者，我想要在主应用文件 (App.jsx) 中，用我们新创建的 ModuleRouter 替换掉旧的、直接调用 PageRouter 的逻辑，从而正式激活整个多模块路由系统。  
* **验收标准**:  
  1. App.jsx 文件被更新，其主要的渲染内容现在是 \<ModuleRouter /\>。  
  2. 应用启动后，能够成功完成登录流程。  
  3. 登录后，应用能够根据API返回的 url（例如 "/seven-grade"），正确地渲染出七年级“蒸馒头”模块的第一个页面。  
  4. 整个应用的现有功能（特指七年级模块）在新路由系统下运行正常，无任何功能衰退。

### **史诗 2 (修订版): “火车购票”测评模块 (基于PDF)**

**史诗目标**: 在新的多模块框架下，严格按照《【四年级数学】火车购票0401.pdf》的视觉稿和交互流程，从零开始完整开发并集成全新的四年级“火车购票”测评模块。

---

#### **故事 2.1: 模块骨架与引导页 (修订版)**

* **用户故事**: 作为一个开发者，我想要为四年级模块创建基本的目录结构，并精确实现PDF第2页的“注意事项”页面，包括其40秒强制阅读计时器。  
* **验收标准**:  
  1. src/modules/grade-4/ 目录下成功创建了 pages, components, assets 等子目录。  
  2. 成功创建并渲染了“注意事项”页面，其布局、文本内容与PDF第2页完全一致。  
  3. 页面加载时，标签为“我已阅读上述注意事项(40s)”的复选框处于禁用状态，并启动一个40秒的倒计时。  
  4. 倒计时期间，标签中的秒数动态更新。  
  5. 倒计时结束后，标签中的秒数文本消失，复选框变为可用状态。  
  6. 用户勾选复选框后，“下一页”按钮被激活。

---

#### **故事 2.2: 情景定义与问题识别 (修订版)**

* **用户故事**: 作为一个开发者，我需要实现PDF第3页的静态“情景介绍”页面和第4页的“问题识别”页面，精确复现其视觉布局和交互逻辑。  
* **验收标准**:  
  1. “情景介绍”页面（PDF第3页）的图文内容、布局和左侧导航栏状态与PDF完全一致。  
  2. “问题识别”页面（PDF第4页）成功渲染了“假期安排讨论群”的对话框样式和右侧的提问与输入区域。  
  3. 当右侧的文本输入框内容不为空时，“下一页”按钮被激活。  
  4. 用户输入的文本被正确捕获。  
  5. 左侧导航栏能够根据页面正确高亮“1 出行方案”和“2 出行方案”。

---

#### **故事 2.3: 因素分析与多选交互 (修订版)**

* **用户故事**: 作为一个开发者，我需要实现PDF第5页的“因素分析”页面，该页面包含一个带有自定义复选框样式的多选列表。  
* **验收标准**:  
  1. 页面布局、文本和人物插图与PDF第5页完全一致。  
  2. 成功渲染了六个选项，每个选项都带有方形选择框。  
  3. 用户可以点击选项来选中它（显示勾选标记），再次点击可以取消选择。  
  4. 当至少有一个选项被选中时，“下一页”按钮被激活。  
  5. 左侧导航栏正确高亮“3 火车购票”。

---

#### **故事 2.4: 交互式地图与数据录入 (修订版)**

* **用户故事**: 作为一个开发者，我需要实现PDF第6页至第11页所展示的“路线探索”交互功能，允许用户点击按钮切换不同的路线详情图，并输入计算结果。  
* **验收标准**:  
  1. 页面布局与PDF第6页完全一致，包含左侧的路线按钮、中央的地图区域和右侧的路程表格。  
  2. 点击左侧的“路线1”至“路线5”按钮，中央地图区域能正确地切换并显示PDF中对应的路线详情图（如PDF第7页显示路线1详情，第8页显示路线2详情等）。  
  3. “路线1”和“路线5”的路程输入框只接受数字输入。  
  4. 当两个输入框都被填入有效数值后，“下一页”按钮被激活。  
  5. 左侧导航栏在整个交互过程中持续高亮“4 火车购票:出发站”。

---

#### **故事 2.5: 决策制定与信息回顾 (修订版)**

* **用户故事**: 作为一个开发者，我需要实现PDF第12页的“站点推荐”页面，用户在此页面做出最终决策，并能通过点击页面下方的按钮回顾路线信息。  
* **验收标准**:  
  1. 页面布局、表格内容和文本与PDF第12页完全一致。  
  2. 点击页面下方的“路线1”至“路线5”按钮，能够以模态框（Modal）的形式弹出对应的路线详情图。  
  3. 当用户选择了“南充北站”或“南充站”中的一个，**并且**在“请简要说明理由”的文本框中输入了内容后，“下一页”按钮被激活。  
  4. 左侧导航栏正确高亮“5 火车购票:出发站”。

---

#### **故事 2.6: 拖拽式时间规划 (修订版)**

* **用户故事**: 作为一个开发者，我需要实现PDF第14页的“用户方案设计”拖拽交互界面，并能根据任务的**关键路径**实时计算总用时。  
* **验收标准**:  
  1. 页面布局与PDF第14页完全一致，包含顶部的五个可拖拽任务块和下方的两个方案放置区。  
  2. 用户可以将任务块从顶部拖入任一方案区。  
  3. 在方案区内，任务块可以被排列为串行或并行。  
  4. **（核心）当任务块被放置或移动时，关联的“总用时”能够根据任务排列的关键路径实时、正确地**更新。  
  5. 当“方案一”和“方案二”两个区域都至少包含一个任务块时，“下一页”按钮被激活。  
  6. 左侧导航栏正确高亮“7 火车购票:出发时间”。  
  7. \*\*（新增）\*\*同时需要实现PDF第13页的交互教程，点击播放按钮后，能以动画形式演示拖拽操作。

---

#### **故事 2.7: 条件渲染与方案优化 (修订版)**

* **用户故事**: 作为一个开发者，我需要实现PDF第15页和第16页的“方案评估与优化”功能，该功能能根据用户的单选结果，条件性地显示或隐藏一个用于改进方案的拖拽界面。  
* **验收标准**:  
  1. 页面初始状态与PDF第15页一致，改进方案的拖拽区域是隐藏的。  
  2. 当用户选择“是”时，“下一页”按钮直接激活。  
  3. 当用户选择“否”时，页面下方会显示如PDF第16页所示的拖拽区域，且“下一页”按钮保持禁用。  
  4. 在选择“否”后，只有当用户在**新出现的拖拽区域**中创建了一个有效的方案后，“下一页”按钮才被激活。  
  5. 左侧导航栏正确高亮“8 火车购票:出发时间”。

---

#### **故事 2.8: 车票筛选与自定义键盘 (修订版)**

* **用户故事**: 作为一个开发者，我需要实现PDF第17页的“车票筛选”和第18页的“最终推荐与计价”页面，后者包含一个功能和布局都与PDF完全一致的自定义屏幕小键盘。  
* **验收标准**:  
  1. “车票筛选”页面（PDF第17页）成功渲染了包含5个车次信息的表格，并支持通过点击车次前的圆形图标进行多选。  
  2. “最终推荐与计价”页面（PDF第18页）成功渲染了筛选后的2个车次信息、推荐理由输入框、公式输入框、总票价输入框和自定义小键盘。  
  3. 自定义小键盘的布局、按键（包括数字、运算符、等于号和换行键）与PDF完全一致，并能将用户点击的字符正确输入到公式区域。  
  4. 当所有必填项（车次选择、理由、公式、总票价）都完成后，“下一页”按钮被激活。  
  5. 左侧导航栏根据页面正确高亮“9”和“10”。

---

#### **故事 2.9: 测评完成与数据总提交 (修订版)**

* **用户故事**: 作为一个开发者，我需要实现PDF第19页的最终“测评完成”页面，点击此页的“完成”按钮将触发整个模块所有作答数据的汇总和提交。  
* **验收标准**:  
  1. “测评完成”页面的图文和按钮与PDF第19页完全一致。  
  2. 点击“完成”按钮后，全局计时器停止。  
  3. 应用能够将“火车购票”模块会话期间收集到的所有数据，整合成一个符合规范的JSON对象。  
  4. 通过调用共享的 dataLogger 服务，将该数据对象成功提交到后端。  
  5. 左侧导航栏正确高亮“11 火车购票”。
