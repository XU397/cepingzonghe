# 子模块设计说明书模板（交互前端子模块制作标准）

> 适用对象：人机交互前端（考试端）的 **Flow 子模块** 开发场景。  
> 使用方式：为每一个新子模块复制本模板，逐项填写并补充细节，作为 AI 交互工程师与人工工程师共同开发的约束说明。  
> 相关参考：  
> - `docs/需求-交互前端改造方案.md`  
> - `docs/三端改造方案与职责边界.md`  
> - `docs/模块化开发规范与扩展指引.md`  
> - `docs/SUBMODULE_REGISTRATION_GUIDE.md`  
> - `openspec/specs/assessment-core/spec.md`  
> - `openspec/specs/data-format/spec.md`  

---

## 1. 基本信息（Basic Info）[必填]

> 说明：本节用于快速识别子模块的业务属性与技术身份，是后续所有规范的索引。**必须完整填写**。

- **子模块名称（中文）**：  
  - 示例：`7年级蒸馒头-交互实验`

- **子模块标识 `submoduleId`（唯一，kebab-case）**：  
  - 示例：`g7-experiment` / `g7-questionnaire` / `g7-tracking-experiment`  
  - 要求：  
    - 全局唯一；  
    - 与管理后台子模块注册表、后端 `steps[].submoduleId` 完全一致；  
    - 命名建议：`<grade>-<type>[-<series>]`，如 `g4-experiment`、`g7-questionnaire`。

- **显示名称 `displayName`**：  
  - 用于管理后台和运营界面展示。  
  - 示例：`7年级蒸馒头-交互`。

- **版本号 `version`**：  
  - 示例：`1.0.0`  
  - 要求：  
    - 遵循 `major.minor.patch`；  
    - 与管理后台子模块注册表中的版本字段保持同步。

- **适用年级 / 学科 / 场景**：  
  - 示例：`七年级 / 科学 / 探究实验：蒸馒头`。

- **业务目标（简要描述）**：  
  - 示例：`评估学生在实验设计、观察记录、变量控制等方面的科学探究能力`。

- **所属 Flow 类型**：  
  - 示例：`标准 Flow 步骤` / `实验后问卷` / `总结页前说明`。  
  - 说明该子模块在完整 Flow 中所处的位置与角色。

---

## 2. 运行环境与全局约束（Runtime & Global Constraints）[必填]

> 说明：本节定义 “子模块可以假定的运行环境” 与必须遵守的全局约束，防止子模块越权或重复造轮子。

- **运行容器**：  
  - 子模块 **必须** 运行在统一页面框架中：  
    - 外壳：`AssessmentPageFrame`（导航 + 计时 + 主体 + 下一页按钮 + 错误托盘）；  
    - 左侧导航：`LeftStepperNav`。  
  - 子模块 **不得** 自行实现：全局导航、计时器、错误托盘、顶栏布局等。

- **技术栈约束**：  
  - 前端框架：React 18 + TypeScript（如项目整体为 TS）。  
  - 构建工具：Vite 4（由项目统一配置）。  
  - 风格规范：遵守项目现有 ESLint + Prettier 配置。  
  - 不得依赖浏览器不兼容特性（建议保持 ES2019 及以上语法，编译由项目统一处理）。

- **禁止直接操作的能力（必须通过统一封装）**：  
  - 路由跳转：不得直接使用 `window.location`/`history.pushState` 或 Router API 进行模块级跳转；**改用** 容器提供的 `onNext` 等回调。  
  - 本地存储：不得随意读写 `localStorage/sessionStorage` 任意 key；**必须** 使用项目封装（例如 `core.*` / `module.<id>.*` / `flow.<id>.*` 命名空间）。  
  - 会话处理：不得自行处理 401 / session 过期；**必须** 交由统一的 `handleSessionExpired`。  
  - 直接调用后端 API：除非明确允许，一般通过统一 API 层（如 `apiService`），并遵循数据格式规范。

- **支持环境假设**：  
  - 子模块可以假定：  
    - 已存在 `userContext`（含 `examNo`、`batchCode`、`flowId` 等）；  
    - Flow 容器会传入 `initialPageId`，无需自行解析 URL；  
    - 全局错误捕获与日志系统已启用（子模块只需按规范抛错或上报事件）。

---

## 3. CMI 接口定义与导出规范（CMI Definition）[必填]

> 说明：本节是交互端与子模块之间的正式“接口契约”。AI 工程师实现子模块时，**必须完整实现并导出** 本节定义的成员。  
> **重要说明**：下方 TypeScript 示例为规范化目标形态，**最终签名以 `src/shared/types/flow.ts` 中的 `SubmoduleDefinition` 与 `SubmoduleProps` 为准**。如示例与类型文件不一致，请优先更新类型定义或按当前类型实现，并在说明书中注明差异。

### 3.1 TypeScript 接口示意（供 AI 工程师参考）

```ts
// 仅为示意，最终以 src/shared/types/flow.ts 为准
export interface SubmoduleComponentProps {
  userContext: UserContext;
  initialPageId: string; // 子模块内部定义的 pageId
  // 当前实现：options 仅包含计时覆盖（timers）
  options?: {
    timers?: {
      task?: number;
      questionnaire?: number;
    };
    // 规范上可扩展 variant 等字段，扩展前请先更新 src/shared/types/flow.ts
  };
}

// 类型定义中 getNavigationMode 的返回类型应包含 'hidden'
// 'hidden' 用于“不显示左侧导航”的说明/注意事项/过渡页
export type NavigationMode = 'experiment' | 'questionnaire' | 'hidden';

export interface SubmoduleDefinition {
  submoduleId: string;
  displayName: string;
  version: string;

  Component: (props: SubmoduleComponentProps) => React.ReactNode;

  // 实际类型为 (subPageNum: string) => string
  // 调用方可在调用前将 number/undefined 正规化为 string
  getInitialPage(subPageNum: string): string; // 返回 pageId
  getTotalSteps(): number;
  getNavigationMode(pageId: string): NavigationMode;

  getDefaultTimers?: () => {
    task?: number; // 单位：秒
    questionnaire?: number;
    // TimerService 同时支持 notice 计时，如需使用需先扩展
    // SubmoduleDefinition 类型与 TimerService 接入点
    // notice?: number;
  };

  // 当前实现：onInitialize 无参数，FlowModule 直接调用 submoduleDefinition.onInitialize?.()
  onInitialize?: () => void;
  onDestroy?: () => void;

  // 规范上可引入 isComplete 用于 Flow 过渡页判定，
  // 当前 SubmoduleDefinition 暂未包含该字段，如需使用请先扩展类型
  // isComplete?: (state: unknown) => boolean;
}
```

> 填写要求：在说明书中给出该子模块的 `SubmoduleDefinition` 各字段设计说明（见下文各节）。

> 对应代码位置：  
> - 类型定义：`src/shared/types/flow.ts` 中的 `SubmoduleDefinition` 与 `SubmoduleProps`；  
> - 子模块导出：`src/submodules/<submoduleId>/index.tsx`。

### 3.2 导出位置与命名

- 代码文件建议：  
  - `src/submodules/<submoduleId>/index.tsx` 或 `index.jsx` 导出 `SubmoduleDefinition`。  
  - 通过统一的 `SubmoduleRegistry` 完成注册。

- 说明书中需写明：  
  - 实际导出文件路径；  
  - 导出对象名称（例如 `export const g7ExperimentSubmodule: SubmoduleDefinition = { ... }`）。

### 3.3 目录结构建议（新子模块）[推荐]

> 说明：本节给出“从零开发的新子模块”的推荐目录结构，用于约束页面、组件和映射文件的放置位置。对包装历史模块（复用 `src/modules/*`）可在此注明差异。

推荐结构（全新子模块）：

```text
src/submodules/<submoduleId>/
  index.tsx           # 导出 SubmoduleDefinition（导出路径写这里）
  Component.tsx       # 子模块主组件 (props: SubmoduleProps)
  mapping.ts          # subPageNum <-> pageId 映射 & getNavigationMode
  pages/              # 具体业务页面组件
    IntroPage.tsx
    TaskPage.tsx
    ...
  components/         # 子模块内通用组件
  styles/             # 样式文件（如 *.module.css）
```

包装历史模块时：
- `src/submodules/<submoduleId>/` 只放 CMI 包装器与映射（`index.tsx` + `Component.tsx` + `mapping.ts`）；  
- 业务页面仍位于原目录（如 `src/modules/grade-7/pages/*`），说明书中需在页面章节标明“复用旧模块页面路径”。

---

## 4. 页面模型与导航设计（Pages & Navigation）[必填]

> 说明：本节定义子模块内部的“页面宇宙”：有哪些页面、各自职责、顺序和导航规则。  
> 要求：AI 工程师实现时，应严格按此表构建页面组件和导航逻辑。

### 4.1 页面列表（必须提供完整清单）

请以表格方式列出所有页面：

| subPageNum | pageId                         | 类型（type）      | 导航模式（navigationMode） | 说明（业务含义）                   |
|-----------:|--------------------------------|-------------------|----------------------------|------------------------------------|
| 1          | `intro_notice`                 | `notice`          | `hidden`                   | 进入模块说明页（导航隐藏）         |
| 2          | `task_phase_1_design`          | `experiment`      | `experiment`               | 任务阶段 1：实验设计               |
| 3          | `task_phase_2_observe`         | `experiment`      | `experiment`               | 任务阶段 2：观察记录               |
| 4          | `questionnaire_interest`       | `questionnaire`   | `questionnaire`            | 问卷：兴趣与态度                   |
| ...        | ...                            | ...               | ...                        | ...                                |

> 说明：  
> - `subPageNum`：子模块内部页码（用于与后端 `modulePageNum` 对应）；  
> - `pageId`：子模块内部唯一页面标识（字符串，代码中使用）；  
> - `navigationMode`：将用于 `getNavigationMode(pageId)` 的返回值（类型应为 `'experiment' | 'questionnaire' | 'hidden'`，其中 `'hidden'` 用于不展示左侧导航的注意事项/引导/过渡说明页）；  
> - “类型”可用于辅助描述（如任务/问卷/说明），与 `navigationMode` 一般保持一致。

### 4.2 页码映射规则（subPageNum ↔ pageId）

> 本节要明确如何实现 `getInitialPage(subPageNum)` 以及如何从 `pageId` 推导当前步序号。

- `getInitialPage(subPageNum)` 实现规则：  
  - 合法输入范围：`1..N`；  
  - 越界或缺失时的处理（调用方保证传入 string，但值可能非法）：  
    - 若 `subPageNum` 不在范围内，则返回默认首页 `intro_notice`（示例）；  
    - 页面映射表中找不到时，记录错误日志并回退到最近的合法页。  

- 逆向映射（可选，但建议定义）：  
  - 给出 `pageId → stepIndex` 的映射算法或表格，以便导航组件计算 `currentStep`。  
  - 例如：  
    - `pageId` 按页面列表顺序从 1 开始编号；  
    - 或通过显式字典：`{ intro_notice: 1, task_phase_1_design: 2, ... }`。

### 4.3 导航规则（前进/返回/跳转）

需明确：

- 是否允许用户返回上一页？  
  - 若允许：由统一框架决定交互形式（通常不允许点击导航圆点跳转）；  
  - 子模块内部 **不得** 自行更改全局步进逻辑。

- 点击“下一页”前的前置条件：  
  - 例如：必须答完必答题；  
  - 若不满足，需阻断并显示统一错误提示，事件上报为 `click_blocked`。

- 特殊跳转规则：  
  - 如条件分支（根据答案跳转不同页面）需说明：  
    - 条件来源（答案字段）；  
    - 目标页面 `pageId`；  
    - 对 `getTotalSteps` 与导航展示的影响（一般建议仍保持线性顺序，复杂分支慎用）。

- **步数与页面关系总结**：  
  - `getTotalSteps()` 返回的是左侧导航显示的“步数”；  
  - 当 `getNavigationMode(pageId) === 'hidden'` 时，AssessmentPageFrame 会隐藏整栏导航（LeftStepperNav 不显示），通常用于：  
    - 进入模块的注意事项/引导页；  
    - 仅展示说明的过渡页；  
  - 对这些 `hidden` 页：  
    - 通常不单独占用一步（可以视为“第 0 步”引导）；  
    - 应在说明书中说明它们与步数的关系（例如：“第 1 页为 hidden，引导页；从第 2 页开始显示共 N 步导航”）。

> 对应代码位置示例：  
> - 页面映射：`src/submodules/<submoduleId>/pageMapping.ts`（或等价文件）；  
> - 页面组件：`src/submodules/<submoduleId>/pages/*`。

---

## 5. 计时策略（Timing Strategy）[推荐]

> 说明：本节定义默认计时配置与到期行为，将用于实现 `getDefaultTimers` 以及与统一计时器引擎的交互。

### 5.1 默认计时配置

- 对应 `getDefaultTimers()` 的返回值设计（当前类型仅包含 task/questionnaire）：

```ts
getDefaultTimers: () => ({
  task: 20 * 60,          // 任务总时长（秒），示例：20 分钟
  questionnaire: 10 * 60, // 问卷总时长，示例：10 分钟
  // notice: 60           // 如需“注意事项”计时，需先扩展类型声明与 TimerService 接入点
});
```

- 请说明：  
  - 哪些页面属于“任务计时范围”；  
  - 哪些页面属于“问卷计时范围”；  
  - “注意事项/说明页”是否计时（如需使用 notice 计时，请在实现前同步更新 `SubmoduleDefinition.getDefaultTimers` 类型与 TimerService 使用处）。

### 5.2 Flow 覆盖与优先级

- 若 Flow 在步骤配置中提供计时覆盖（overrides）：  
  - 说明：覆盖策略（例如 Flow 配置优先于子模块默认）；  
  - 建议在说明书中直接写明：“当 FlowDefinition 中存在 `overrides.timers` 时，以 Flow 配置为准，否则使用 `getDefaultTimers` 中的默认值。”

### 5.3 到期行为

- 任务计时到期时：  
  - 是否自动提交当前页数据？  
  - 是否直接进入本子模块的过渡页 / 完成页？  
  - 是否允许用户继续浏览？（通常为否）

- 问卷计时到期时：  
  - 未作答项如何填充（建议与现有规范一致：  
    - 手动翻页未答：`"未回答"`；  
    - 自动提交未答：`"超时未回答"`）。  
  - 是否允许用户修改答案？（通常为否）

> 对应代码位置示例：  
> - 计时器引擎：`src/shared/services/timers/TimerService.js` 与 `src/shared/services/timers/useTimer.js`；  
> - 集成示例：`src/submodules/g7-experiment/Component.jsx` 中的 TimerService 使用。

---

## 6. 数据提交与事件设计（Data & Events）[必填]

> 说明：本节是 AI 工程师实现数据层的唯一依据。需要明确：**提交格式、事件类型、提交时机**。

### 6.1 数据格式与工具

- 必须使用统一工具：  
  - `createMarkObject` / `validateMarkObject`；  
  - 事件枚举与字段定义以 `openspec/specs/data-format/spec.md` 为准。

- `MarkObject` 关键字段要求：  
  - `pageNumber`：推荐使用复合编码（由 Flow 容器生成），如：`"M<stepIndex>:<subPageNum>"` 或 `"stepIndex.subPageNum"`；  
  - `pageDesc`：  
    - 需在前缀附加 `[flowId/submoduleId/stepIndex]`；  
    - 示例：`"[flow123/g7-experiment/2] 蒸馒头-实验阶段1"`；  
  - `operationList`：  
    - 页面进入：记录一次 `page_enter`；  
    - 页面退出：记录一次 `page_exit`；  
    - 关键交互：如按钮点击、答案选择等使用统一事件名（例如 `click` / `change` / `click_blocked`）；  
  - `answerList`：  
    - 每题一个元素；  
    - `code` 从 1 开始自增；  
    - `targetElement` 命名建议：`P{pageNumber}_{业务语义ID或序号}`，如：`P21_好奇心问题1`；  
    - `value` 使用可读标签文本（不是内部编码）。

> 对应代码位置：  
> - 提交 Hook：`src/shared/services/submission/usePageSubmission.js`；  
> - Mark 构建工具：`src/shared/services/submission/createMarkObject.js`、`validateMarkObject.js`；  
> - 事件枚举：`src/shared/services/submission/eventTypes.js`。

### 6.2 事件类型与命名规范

- 请列出本子模块会产生的主要事件类型，例如：

| 事件名            | 触发时机                         | 备注                                              |
|-------------------|----------------------------------|---------------------------------------------------|
| `page_enter`      | 页面组件首次挂载                 | 必须                                              |
| `page_exit`       | 离开当前页面（切换前/提交后）    | 必须                                              |
| `change`          | 学生修改答案                     | 建议统一使用 `change` 表示答题交互               |
| `click`           | 点击普通按钮（非阻断）           | 包含按钮 id / 业务语义                            |
| `click_blocked`   | 点击“下一步/提交”但校验未通过    | 必须标记阻断原因（必填项未回答等）               |
| `auto_submit`     | 计时器到期触发自动提交           | 可选，便于排查                                   |

> 要求：在说明书中为每个事件明确：触发条件、携带字段、与业务行为的关系。

### 6.3 提交时机与失败处理

- 提交触发点（至少包含）：  
  - 点击“下一页/提交”时：  
    - 收集当前页全部答案 → 补齐未答占位 → 构造 `MarkObject` → 调用 `usePageSubmission.submit()`；  
    - 提交成功后才允许导航到下一页。  
  - 计时器到期自动提交时：  
    - 收集当前页答案 → 未答填 `"超时未回答"` → 提交并自动导航。

- 提交失败时：  
  - 如果是网络错误或服务端错误：  
    - 使用统一错误托盘显示错误信息；  
    - 阻断导航（DEV 环境可配置跳过，但需说明）；  
    - 允许用户重试提交。  
  - 如果是 401/会话过期：  
    - 调用 `handleSessionExpired`，清理状态并回登录；  
    - 子模块 **不得** 自己决定跳转 URL。

---

## 7. Flow 集成与进度恢复（Flow Integration）[必填]

> 说明：本节定义子模块与 Flow 容器之间的协作方式，包括进度恢复、完成判定与过渡页切换。

- **从进度到页面的映射**：  
  - 后端/容器提供：`stepIndex`（当前 Flow 步骤索引）与 `modulePageNum`（子模块内部页码）；  
  - FlowModule 调用：`getInitialPage(modulePageNum)` → 得到 `initialPageId`；  
  - 子模块在内部据此渲染对应页面。

- **完成判定逻辑**：  
  - 明确本子模块何时算“完成”：  
    - 到达最后一页并成功提交；  
    - 或通过自定义逻辑判断。当前 `SubmoduleDefinition` 未暴露 `isComplete` 字段，如需要类似能力，可通过 `flowContext.onComplete` 回调或扩展类型实现，并在说明书中说明。  
  - 完成后：  
    - 通知 Flow 容器（例如通过回调或状态）进入过渡页 `TransitionPage`；  
    - 容器再推进到下一 `stepIndex`。

- **Flow 覆盖配置的支持**：  
  - 若 FlowDefinition 中提供 `overrides`（如：计时、变体题目等），说明如何通过 `options` 传入 `Component` 并在子模块内部生效。  
  - 示例：  
    - 当前实现至少包含 `options.timers`（见 `FlowStep.overrides.timers`）；  
    - 规范上可扩展 `options.variant`、`options.enablePractice` 等字段，扩展前请先调整 `SubmoduleProps.options` 类型声明。

> 对应代码位置：  
> - Flow 类型定义与上下文：`src/shared/types/flow.ts`；  
> - Flow 编排运行时：`src/flows/FlowModule.jsx` 及相关 orchestrator 实现。

---

## 8. 本地存储与状态管理（Local State & Persistence）[推荐]

> 说明：本节约束子模块如何管理内部状态，以及哪些信息可以跨刷新恢复。

- **状态管理方式**：  
  - 建议：使用 React Context + Reducer 或 Hooks 管理模块内状态。  

- **可持久化的状态项（示例）**：  
  - 当前页指针（可选，通常由 Flow 容器负责）；  
  - 已作答答案草稿（避免刷新丢失）；  
  - 某些中间计算结果（非敏感）。  

- **存储命名空间**：  
  - 必须使用统一命名：  
    - 平台：`core.*`；  
    - 子模块：`module.<submoduleId>.*`；  
    - Flow：`flow.<flowId>.*`。  
  - 在说明书中列出实际使用的 key：  
    - 示例：`module.g7-experiment.answers`、`module.g7-experiment.lastPageId`。

- **刷新恢复策略**：  
  - 列出刷新时如何恢复：  
    - 从持久化状态中读取答案草稿并回填 UI；  
    - `initialPageId` 仍以 Flow 容器为准，子模块不自行跳页。

---

## 9. 错误处理与边界情况（Error Handling & Edge Cases）[必填]

> 说明：列出子模块需要显式处理的异常与边界场景，避免 AI 工程师忽略。

- **初始化失败**（如初始化数据接口错误）：  
  - 行为：显示统一错误 UI（可复用项目的“加载失败/重试”组件）；  
  - 可提供“重试”按钮，再次拉取数据。

- **非法页码 / 配置错误**：  
  - `subPageNum` 超出范围或找不到 `pageId`：记录错误日志，回退到首页或最近的合法页；  
  - FlowDefinition 中 `steps[].submoduleId` 与本子模块不符的情况视为不可恢复错误（通常交由上层处理）。

- **401/会话过期**：  
  - 一律交给统一 `handleSessionExpired`，清空状态并回登录。  
  - 子模块不得覆盖该行为。

- **网络波动与重试**：  
  - 提交失败时，使用 `usePageSubmission` 内部的重试机制（指数退避）；  
  - 子模块只需在 UI 上指示“正在重试 / 请稍后重试”。

---

## 10. 视觉与交互规范（UI & UX Constraints）[必填]

> 说明：明确子模块可以自定义的范围（主体内容），以及必须沿用统一框架的部分。

- **统一部分（不可覆盖）**：  
  - 页面外壳布局（左右结构 + 顶部计时 + 底部下一页按钮）；  
  - 左侧导航（圆点 + 步数显示）样式与逻辑；  
  - 计时器位置与基本样式；  
  - 全局错误托盘组件。

- **可自定义部分**：  
  - 主体区域的内容布局与控件；  
  - 控件样式，可通过 CSS 变量或局部样式覆盖；  
  - 业务特有的交互（拖拽、排序、模拟实验等）。

- **关键交互约束**：  
  - “下一页/提交”按钮：  
    - **不得** 自己实现独立的“下一页”按钮完成导航；  
    - 如需在模块内部触发下一步，必须通过容器提供的 `onNext()`（或等价回调）完成，并在调用前保证提交成功。  
  - 键盘快捷键 / 特殊交互：  
    - 如有，需在说明书中列明，避免与全局快捷键冲突。
- **模块内组件的样式**：
  - 颜色系统（Color System）：  
    - 基于全局CSS变量（src/styles/global.css），所有子模块必须使用统一色板：
      用途	CSS变量	色值	使用场景
      主色	--cartoon-primary	#59c1ff	主要按钮、强调元素、选中状态
      次色	--cartoon-secondary	#ffce6b	次要按钮、提示信息
      边框色	--cartoon-border	#ffd99e	卡片边框、分割线
      成功绿	--cartoon-green	#67d5b5	完成状态、正确提示
      警告红	--cartoon-red	#ff8a80	错误提示、警告信息
      正文色	--text-color	#333333	正文段落、标签
      次要文本	--text-secondary	#666666	说明文字、辅助信息
      背景色	--background-color	#f5f5f5	内容区背景
      卡片背景	--card-background	#ffffff	内容卡片、模态框
      阴影	--cartoon-shadow	rgba(0,0,0,0.1)	卡片阴影、按钮阴影
      使用约束：
      ✅ 必须使用CSS变量，不得硬编码色值
      ✅ 新增颜色需在 global.css 中声明
      ❌ 禁止使用纯黑 #000 或低对比度文本
- **内容区域布局（Content Area Layout）**：  
  - 子模块渲染区域
    子模块内容将被渲染在Flow框架的右侧内容区域内，标准尺寸如下：
    属性	      值	    说明
    标准宽度	1200px	内容区域最大宽度
    标准高度	800px	内容区域最大高度
    内边距	40px	四周padding
    可用内容宽度	1120px	扣除padding后
    可用内容高度	720px	扣除padding后
    页面容器模板
    .pageContainer {
      width: 100%;
      height: 100%;
      padding: 40px;
      box-sizing: border-box;
      overflow-y: auto;
    }
  - 常见布局模式
    1. 单栏居中布局（适用于：通知页、说明页）
    .centeredContent {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }
    2. 左右分栏布局（适用于：材料阅读+问答）
    .splitLayout {
      display: flex;
      gap: 24px;
      height: 100%;
    }

    .leftPanel {
      flex: 1;
      overflow-y: auto;
    }

    .rightPanel {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    3. 卡片网格布局（适用于：选择题、选项展示）
    .cardGrid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
    }
- **响应式适配（Responsive Adaptation）**：  
  - 关键原则：高度优先于宽度（教育测评场景下屏幕高度是主要约束）
    断点	条件	内容padding	字号缩放	适用设备
    默认	≥900px	40px	100%	1920×1080 标准桌面
    中等	≤800px	30px	95%	1280×800 常见笔记本
    紧凑	≤720px	25px	90%	1366×768 低分辨率
    媒体查询示例：
    .pageContainer {
      padding: 40px;
    }

    /* 中等屏幕 */
    @media (max-height: 800px) {
      .pageContainer {
        padding: 30px;
      }
  
      .title {
        font-size: 32px;  /* 原36px × 0.95 */
      }
    }

    /* 紧凑屏幕 */
    @media (max-height: 720px) {
      .pageContainer {
        padding: 25px;
      }
  
      .title {
        font-size: 28px;  /* 原36px × 0.9 */
      }
  
      .paragraph {
        font-size: 14px;  /* 原16px × 0.9 */
      }
    }
- **排版规范（Typography）**：  
  - 字体家族
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 
                'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 
                 sans-serif;
  - 字号层级
    级别	尺寸	字重	行高	使用场景
    H1 标题	36px	700	1.4	页面主标题
    H2 标题	28px	700	1.4	章节标题
    H3 标题	24px	600	1.4	子章节标题
    正文	16px	400	1.6	段落内容、问题描述
    小号文本	14px	400	1.5	标签、说明文字
    辅助文本	12px	400	1.4	提示信息、脚注
    标题样式
    .pageTitle {
      font-size: 36px;
      font-weight: 700;
      color: var(--text-color);
      margin-bottom: 24px;
      line-height: 1.4;
    }

    .sectionTitle {
      font-size: 28px;
      font-weight: 700;
     color: var(--text-color);
      margin-bottom: 16px;
    }
  -中文排版特殊处理
    .paragraph {
      font-size: 16px;
     line-height: 1.6;
     color: var(--text-color);
     text-align: justify;        /* 两端对齐 */
     text-indent: 2em;           /* 首行缩进2字符 */
     word-break: break-all;      /* 中英文混排 */
     margin-bottom: 16px;
    }
- **组件设计标准（Component Standards）**：
- 表单控件
    TextArea：
    .textarea {
      width: 100%;
     min-height: 100px;
      padding: 12px 16px;
      border: 2px solid var(--cartoon-border);
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
      line-height: 1.6;
      resize: vertical;
      transition: border-color 0.3s ease;
    }

    .textarea:focus {
      border-color: var(--cartoon-primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(89, 193, 255, 0.1);
    }

    .textarea:disabled {
     background: #f5f5f5;
     cursor: not-allowed;
    }
    Input：
    .input {
      width: 100%;
      height: 44px;
      padding: 0 16px;
      border: 2px solid var(--cartoon-border);
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    .input:focus {
      border-color: var(--cartoon-primary);
      outline: none;
    }
    Checkbox：
    .checkboxWrapper {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
    }

    .checkbox {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      border: 2px solid var(--cartoon-border);
      appearance: none;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .checkbox:checked {
      background: linear-gradient(135deg, var(--cartoon-primary), #4aa3d6);
      border-color: var(--cartoon-primary);
    }

    .checkbox:checked::after {
      content: '✓';
      display: block;
      text-align: center;
      color: white;
      font-size: 14px;
      line-height: 20px;
    }
    RadioButton：
    .radioWrapper {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
    }

    .radio {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid var(--cartoon-border);
      appearance: none;
      cursor: pointer;
      position: relative;
      transition: all 0.2s ease;
    }

    .radio:checked {
      border-color: var(--cartoon-primary);
      background: var(--cartoon-primary);
    }

    .radio:checked::after {
      content: '';
      position: absolute;
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    - 卡片（Card）
    .card {
      background: var(--card-background);
      border: 2px solid var(--cartoon-border);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 8px var(--cartoon-shadow);
    }

    .cardClickable {
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .cardClickable:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px var(--cartoon-shadow);
    }

    .cardSelected {
      border-color: var(--cartoon-primary);
      box-shadow: 0 0 0 3px rgba(89, 193, 255, 0.2);
    }
- 选项组（Option Group）
    .optionGroup {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .optionItem {
      display: flex;
      align-items: center;
      padding: 16px;
      border: 2px solid var(--cartoon-border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .optionItem:hover {
      border-color: var(--cartoon-primary);
      background: rgba(89, 193, 255, 0.05);
    }

    .optionItemSelected {
     border-color: var(--cartoon-primary);
     background: rgba(89, 193, 255, 0.1);
    }
- **动画与交互（Animation & Interaction）**：
  - 动画时长标准
    类型	时长	缓动函数	使用场景
    快速	0.2s	ease	hover状态、点击反馈
    标准	0.3s	ease	状态切换、展开收起
    慢速	0.5s	ease-in-out	复杂动画、特殊效果
  -常见动画效果
    1. 元素上浮：
    .hoverable:hover {
      transform: translateY(-3px);
      transition: transform 0.3s ease;
    }
    2. 淡入显示：
    .fadeIn {
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
     from { 
       opacity: 0; 
        transform: translateY(20px); 
      }
      to { 
       opacity: 1; 
        transform: translateY(0); 
      }
    }
    3. 脉冲提示：
    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    4. 选中反馈：
    .selectFeedback {
      animation: selectPop 0.2s ease;
    }

    @keyframes selectPop {
      0% { transform: scale(1); }
      50% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }
- **卡通风格特征（Cartoon Style Features）**：
  - 基于目标用户（10-15岁）的审美偏好：
    特征	实现方式	效果
    圆角	border-radius: 12px (大组件), 8px (小组件)	柔和、亲和
    渐变	linear-gradient(135deg, color1, color2)	活泼、立体
    柔和阴影	box-shadow: 0 4px 8px rgba(0,0,0,0.1)	浮起感
    亮色系	蓝色 #59c1ff、黄色 #ffce6b	活力、正面
    微交互	hover上浮、选中缩放	趣味性、即时反馈
- **其图标与图形规范（Icons & Graphics）**：
  - 元素	尺寸	格式	说明
    小图标	16px × 16px	SVG	文本内嵌图标
    标准图标	24px × 24px	SVG	按钮图标
    大图标	48px × 48px	SVG/PNG	功能入口
    插图	按需	SVG优先	说明性插图
    优化建议：
    ✅ 优先使用内联SVG（减少网络请求）
    ✅ 插图使用CSS变量控制颜色
    ❌ 避免使用位图图标（除非照片类素材）
---

## 11. 配置项与扩展性（Options & Extensibility）[可选]

> 说明：定义 `options`（Flow 传入的变体配置）内容，让子模块可以在不改代码的前提下支持多种变体。

- **配置项列表示例**：

| 配置项名            | 类型                  | 默认值   | 说明                                       |
|---------------------|-----------------------|----------|--------------------------------------------|
| `variant`           | `"A" \| "B"`          | `"A"`    | 题目集变体                                 |
| `enablePractice`    | `boolean`             | `false`  | 是否启用练习模式                           |
| `questionnaireOnly` | `boolean`             | `false`  | 若为 true，仅展示问卷部分                  |

- **约束与说明**：  
  - 所有配置项应有合理默认值，保证在 `options` 为空时模块仍可正常运行；  
  - 如配置项影响 Flow 步数或页面列表，需在说明书中说明如何与 `getTotalSteps` 保持一致。

---

## 12. 日志与埋点要求（Logging & Telemetry）[推荐]

> 说明：列出需要额外记录的运行日志或埋点，方便后期排查问题与分析数据。

- **必需埋点**：  
  - `flow_context`（Flow 上下文）：  
    - **由 Flow 容器统一打点**（见 `FlowModule` 与 `usePageSubmission` 的 `flowContext` 注入逻辑），子模块代码 **无需也不应** 再手动上报 `flow_context`，以免产生重复或冲突；  
  - 进入子模块的业务埋点（可选）：  
    - 如需额外的业务统计，可使用自定义 `eventType`（例如 `module_enter_business`），并在说明书中说明字段；  
  - 完成子模块：记录一次“模块完成”事件；  
  - 异常中断：如提交连续失败 / 初始化失败超出重试次数，记录异常事件。

- **字段要求**：  
  - 所有关键埋点都应包含：  
    - `flowId`、`submoduleId`、`stepIndex`、`pageNumber`；  
    - 必要时包含 `examNo`、`batchCode`（可从 `userContext` 获取）。

> 对应代码位置：  
> - Flow 上下文打点：`src/flows/FlowModule.jsx`、`src/shared/types/flow.ts:createFlowContextOperation`；  
> - 提交路径中的 flow_context 注入：`src/shared/services/submission/usePageSubmission.js`。

---

## 13. 性能与安全要求（Performance & Safety）[推荐]

> 说明：给出基本的性能与安全约束，便于 AI 工程师在实现时做正确的取舍。

- **性能目标**（示例，可按模块调整）：  
  - 首屏渲染时间：在正常网络条件下（例如 4G/家庭宽带），首屏可交互时间不超过 3 秒；  
  - 单页渲染：切换页面时，主要内容渲染不超过 500ms；  
  - 内存占用：避免在单页加载过多大图或视频资源，如需加载，采用懒加载策略。

- **安全与隐私**：  
  - 禁止在本地持久化敏感信息明文（如身份证号、手机号等）；  
  - 不得向外域发送任何数据（网络请求需通过统一 API 域名）；  
  - 如有截图 / 文件上传等，需在说明书中明确，并与后端协商数据格式。

---

## 14. 验收标准与测试清单（Acceptance & Test Plan）[必填]

> 说明：本节用于指导 QA/自测，AI 工程师也可据此编写自动化测试或调试脚本。

- **功能用例（示例结构）**：

1. 正常完成流程  
   - 前置：登录后进入绑定了本子模块所在 Flow；  
   - 步骤：按页面顺序完成所有题目并点击下一页；  
   - 验证：  
     - 所有页面均可正常访问；  
     - 提交数据格式符合规范（特别是 `pageNumber/pageDesc/answerList`）；  
     - Flow 能顺利进入下一个步骤。

2. 中途刷新恢复  
   - 前置：在任务第 N 页作答部分问题；  
   - 步骤：刷新浏览器，再次进入同一 Flow；  
   - 验证：  
     - 恢复到正确的页面；  
     - 已保存答案被正确回填。

3. 计时器到期  
   - 前置：接近任务/问卷结束时间；  
   - 步骤：等待计时器到期；  
   - 验证：  
     - 自动提交行为按照规范执行；  
     - 未答题目写入 `"超时未回答"`；  
     - Flow 正确进入过渡页或下一步骤。

4. 网络错误与重试  
  - 模拟提交失败（网络超时/服务端 500）；  
  - 验证错误提示、重试逻辑与阻断导航行为。

5. Flow 级上下文埋点  
   - 步骤：首次进入每个 step 时，完成一次页面加载与一次提交；  
   - 验证：  
     - 对应 Mark 数据的 `operationList` 中存在一条 `eventType = 'flow_context'` 的记录（由 Flow 容器与 `usePageSubmission` 负责注入）；  
     - 子模块自身的业务事件不会覆盖或破坏这条 `flow_context` 记录。

- **与统一规范对齐检查项**：  
  - CMI 接口字段是否全部实现；  
  - 是否使用 `usePageSubmission` 进行数据提交；  
  - 是否使用统一计时器引擎，未自行实现倒计时逻辑；  
  - 是否通过容器进行导航，未直接操控路由或 URL。

---

## 15. 代码与文档交付物清单（Deliverables）[必填]

> 说明：本节列出完成一个子模块开发时必须交付的内容，便于验收。

- **代码交付**：  
  - `src/submodules/<submoduleId>/index.tsx`：导出 `SubmoduleDefinition`；  
  - `src/submodules/<submoduleId>/components/*`：模块内部通用组件；  
  - `src/submodules/<submoduleId>/pages/*`：页面组件；  
  - `src/submodules/<submoduleId>/styles/*`：样式文件（如 CSS Modules）；  
  - 如有：模块内部 `context`、`hooks` 等。

- **文档交付**：  
  - 本设计说明书的“实例化版本”（针对本子模块填写完整）；  
  - 页面列表表格（4.1）与页码映射规则（4.2）；  
  - 事件与埋点清单（6.2、12）；  
  - 计时策略说明（5）；  
  - 验收用例与测试记录（14）。

---

> 使用建议：  
> - 对于 AI 交互工程师：在开始编码前，务必逐项阅读并理解本说明书；编码过程中，如遇不在说明书范围内的决策，应先在说明书中补充分节，再实施。  
> - 对于评审者：可将本说明书作为 Code Review 与验收 checklist，逐项检查是否满足。  
> - 对于后续维护者：本说明书应随代码版本更新而维护，确保版本号、页面列表、计时与数据格式等信息始终最新。
