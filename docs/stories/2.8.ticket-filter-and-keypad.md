故事 2.8：车票筛选与自定义键盘（完整版）
故事编号: 2.8
故事名称: 车票筛选与自定义键盘
对应页面: PDF 第17页（车票选择）/ 第18页（最终推荐与计价）
页面路由（建议）:

09-TicketFilterPage（车票选择）

10-TicketPricingPage（最终推荐与计价）

需求概述
作为一个开发者，我需要实现PDF第17页的“车票筛选”和第18页的“最终推荐与计价”两个页面。第17页要求用户从给定的列车列表中多选符合条件的车次，并支持多选交互。第18页则展示筛选后的车次，并提供一个功能和布局都与PDF完全一致的自定义屏幕小键盘，让用户录入票价计算公式并填写总票价 。

验收标准
车票筛选页（PDF 第17页）:

页面应渲染一个包含5条车次信息的表格 。表格列头、数据内容和排版必须与PDF截图完全一致。

每行车次名称的左侧都有一个空心的 

☆ 图标，点击后应变为实心。该功能支持多选 。

页面需显示小明妈妈的额外要求：

3张车票为同一车次 。

到达时间在18时30分前 。

当用户至少选择一条车次后，“下一页”按钮将被激活 。

最终推荐与计价页（PDF 第18页）:

页面应仅展示在第17页被选中的、符合所有筛选条件的车次信息 。表格列头与上一页相同。

页面包含一个必填的“推荐理由”输入框 。

页面右侧应有一个与PDF布局和按键集合完全一致的自定义小键盘 。


只能通过小键盘录入字符到公式输入区域，物理键盘输入被禁用 。

小键盘按键包括数字、运算符（+ - × ÷）、括号、等号、换行（↵）、退格（⌫）和清空（AC） 。

点击 

“=” 按钮，系统应安全求值，并将结果自动回填到“总票价”输入框 。

**“总票价”**输入框为必填项，且其值必须与公式求值结果一致 。

当所有必填项（

已选车次 ≥ 1，推荐理由非空，公式合法，总票价合法且与公式求值一致）均完成后，“下一页”按钮才会被激活 。

左侧导航栏高亮顺序正确：进入本故事时高亮“9”，下一页高亮“10” 。

表格数据
第17页：可供选择的5辆列车信息
| 车次 | 出发时间 (到达时间) | 乘车时长 | 一等座票价 (剩余票数) | 二等座票价 (剩余票数) |
|:---|:---|:---|:---|:---|
| C769 | 11:15 (12:58) | 1小时43分 | 96元 (2张) | 60元 (无) |
| D175 | 12:36 (14:06) | 1小时30分 | 148元 (5张) | 112元 (1张) |
| C751 | 14:38 (16:25) | 1小时47分 | 96元 (3张) | 60元 (6张) |
| C757 | 16:36 (18:13) | 1小时37分 | 96元 (1张) | 60元 (1张) |
| D163 | 18:16 (19:50) | 1小时34分 | 148元 (12张) | 112元 (8张) |

第18页：符合筛选条件的列车信息
| 车次 | 出发时间 (到达时间) | 乘车时长 | 一等座票价 (剩余票数) | 二等座票价 (剩余票数) |
|:---|:---|:---|:---|:---|
| D175 | 12:36 (14:06) | 1小时30分 | 148元 (5张) | 112元 (1张) |
| C751 | 14:38 (16:25) | 1小时47分 | 96元 (3张) | 60元 (6张) |

核心逻辑与组件
交互规则：

车次选择（P17）: 多选功能通过点击 

☆ 图标切换选中状态；至少选中1条车次后，允许跳转下一页 。

推荐与计价（P18）: 推荐理由为必填项；公式输入仅通过小键盘实现；

“=” 按键会触发安全求值并自动回填总价 。

最终提交校验: “下一页”按钮启用条件为：已选车次 ≥ 1，推荐理由非空，表达式合法，总票价合法且与表达式求值一致 。

组件与目录结构（建议）：


09-TicketFilterPage/ 和 10-TicketPricingPage/ 两个主目录，分别包含各自的页面文件和子组件 。

关键组件包括 

TrainTable.jsx（表格）、Keypad.jsx（自定义小键盘）和 FormulaEditor.jsx（公式编辑器）等 。

数据模型（建议）：

定义 

TrainItem 对象来存储每条车次的所有信息 。

使用 

TicketFilterState 和 TicketPricingState 对象来管理两个页面的状态 。

数据上报：

P17 提交时，上报选中的车次ID数组 (

selected_trains) 和操作日志 。

P18 提交时，上报理由、公式和总票价 (

reason, formula, total_price) 和操作日志 。