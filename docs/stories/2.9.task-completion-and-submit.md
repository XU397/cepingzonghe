# 故事 2.9：测评完成与数据总提交（PDF 第19页）

## 概述
- 步骤编号：左侧导航 11（测评完成）
- 页面编号映射：
  - 第12页：task-completion（测评完成）
- 样式与交互：保持与已实现页面一致（AssessmentPageLayout、浮动按钮）；标题与图文按 PDF 呈现。

---

## 用户故事
作为学生，我在完成所有题目后进入“测评完成”页面，点击“完成”按钮后，系统会停止计时并将本模块会话期间收集的所有数据进行汇总并提交到后端，显示提交结果。

## 验收标准
1. 页面图文与 PDF 第19页一致，按钮文案为“完成”。
2. 点击“完成”按钮：
   - 全局 40 分钟计时器停止显示，状态置为完成。
   - 汇总本模块所有页面的 `operationList` 与 `answerList`（按页面维度合并/序列化）。
   - 通过 `shared/services/dataLogger` 统一接口调用后端完成提交。
   - 显示提交成功/失败提示。
3. 左侧导航栏高亮数字 11。

## UI 结构（建议）
- 上：完成页插图 + 说明文案（按 PDF）
- 下：提示已完成并可点击“完成”按钮提交；提交后可禁用按钮，避免重复提交

## 组件与状态
- 新页面组件：`src/modules/grade-4/pages/12-TaskCompletionPage.jsx`（建议命名）
- 样式：`12-TaskCompletionPage.module.css`
- Context 动作：
  - `completeGlobalTimer()`：置全局计时器完成
  - `submitAllModuleData()`：模块级别汇总与提交（建议在 Grade4Context 新增或在页面中按页聚合调用现有 `submitPageData` 方案）
  - `setNavigationStep('11')`

## 数据汇总规范（建议）
- 聚合格式：
```json
{
  "moduleId": "grade-4",
  "version": "1.0.0",
  "batchCode": "...",
  "examNo": "...",
  "pages": [
    {
      "pageNumber": "1",
      "pageDesc": "注意事项",
      "operationList": [...],
      "answerList": [...],
      "beginTime": "YYYY-MM-DD HH:mm:ss",
      "endTime": "YYYY-MM-DD HH:mm:ss"
    },
    { "pageNumber": "2", ... }
  ]
}
```
- 若后端只接受分页面提交（当前实现）：
  - 完成页点击后，对最后一页进行提交；
  - 其余页面已在导航时“自动提交”，此处可不重复提交；
  - 同时在日志中记录模块完成事件：`{ targetElement: '模块', eventType: 'module_complete', value: 'grade-4 end' }`。

## 日志与答案
- 操作日志：
  - `button_click`（完成）
  - `module_complete`
- 答案（可选）：
  - targetElement: `task-completion`
  - value: `{ completed: true, timestamp: 1731234567890 }`

## 配置与导航
- `moduleConfig.pages` 建议新增：
  - `'task-completion'`: `{ number: 12, desc: '测评完成', component: '12-TaskCompletionPage', route: '/task-completion' }`
- `index.jsx`：
  - `renderCurrentPage` 中添加 `case 12`
  - `getInitialPage` 添加 `case 12: pageId = 'task-completion'`
- `Grade4Context.navigateToPage` 映射表新增 `'task-completion': 12`

> 注：若左侧导航总步数固定为 11，完成页不显示在导航序列中，仅用于终点提交，则 number 可保持为 11，或者将完成页作为覆盖层展示（不计入导航）。具体以 PDF & 评审为准。

---

## 样式与交互规范
- 样式：复用 CSS Modules，避免全局污染；与已实现 P1~P9 视觉风格一致。
- 交互：按钮禁用态、加载态（提交中），错误提示与重试按钮（失败时）。

