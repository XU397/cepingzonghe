# Grade 7 Tracking Module - E2E 测试指南

**模块**: Grade 7 Tracking Module
**版本**: 1.0.0
**测试日期**: 2025-10-15

---

## 测试目标

从登录到完成整个测评流程，验证所有交互、数据收集和提交功能。

---

## 准备工作

### 1. 启动开发服务器

```bash
cd d:\myproject\cp
npm run dev
```

服务器启动后访问: `http://localhost:3000`

---

### 2. 配置 Mock 模式

确保 `.env` 文件包含:

```env
VITE_USE_MOCK=1
```

这将使用 Mock API，无需后端服务器。

---

### 3. 准备浏览器开发工具

1. 打开 Chrome 浏览器
2. 按 F12 打开开发者工具
3. 切换到以下标签页准备监控:
   - **Console**: 查看日志和错误
   - **Network**: 监控 API 请求
   - **Application > Local Storage**: 查看会话数据

---

### 4. 清空会话数据

在 Console 中执行:

```javascript
localStorage.clear();
sessionStorage.clear();
```

---

## E2E 测试流程

### 第0步: 登录

#### 操作步骤
1. 访问 `http://localhost:3000/login`
2. 输入任意账号和密码（Mock 模式下任何凭证都有效）
   - 用户名: `test001`
   - 密码: `password`
3. 点击"登录"按钮

#### 验证点
- [ ] 登录成功后跳转到 Grade 7 Tracking 模块
- [ ] URL 变为: `http://localhost:3000/#/` 或包含模块路径
- [ ] 页面显示"注意事项"页面
- [ ] Console 显示模块初始化日志:
  ```
  [ModuleRouter] 模块加载成功
  [Grade7TrackingModule] 7年级追踪测评模块初始化
  ```

#### LocalStorage 验证
在 Application > Local Storage 中检查:
- [ ] `hci-batchCode`: "250619"
- [ ] `hci-examNo`: "1001"
- [ ] `hci-moduleUrl`: "/grade-7-tracking"
- [ ] `hci-isAuthenticated`: "true"

---

### 第1步: 注意事项页面 (Page01_Notice)

#### 页面元素
- 标题: "注意事项"
- 4条注意事项列表
- 复选框: "我已阅读并理解以上注意事项"
- 倒计时显示: "请仔细阅读注意事项 (剩余40秒)"
- "下一页"按钮（初始禁用）

#### 操作步骤
1. 阅读4条注意事项
2. 观察40秒倒计时
3. 倒计时到0秒后，按钮自动启用
4. 勾选复选框
5. 点击"下一页"按钮

#### 快速测试（跳过倒计时）
如果需要快速测试，在 Console 中执行:
```javascript
// 模拟倒计时完成
const button = document.querySelector('button');
if (button) button.disabled = false;
```

#### 验证点
- [ ] 倒计时从40秒倒数到0秒
- [ ] 倒计时到0秒后，按钮自动启用（即使未勾选复选框）
- [ ] 勾选复选框后，可以点击"下一页"
- [ ] 页面切换到"情景引入"页面
- [ ] Console 显示操作日志:
  ```
  [TrackingProvider] 页面进入: Page_00_1_Precautions
  [TrackingProvider] 复选框勾选
  [TrackingProvider] 页面退出: Page_00_1_Precautions
  ```

#### Network 验证
- [ ] 发送 `POST /stu/saveHcMark` 请求
- [ ] FormData 包含:
  - `batchCode`: "250619"
  - `examNo`: "1001"
  - `mark`: JSON字符串，包含:
    - `pageNumber`: "0.1"
    - `pageDesc`: "注意事项"
    - `operationList`: 包含 `page_enter`, 复选框点击, `page_exit`
    - `answerList`: []

---

### 第2步: 情景引入页面 (Page02_Intro)

#### 页面元素
- 标题: "情景引入"
- 蜂蜜下落情景描述
- 图片或插图
- "下一页"按钮（立即启用）
- **计时器显示**: "剩余时间: 40:00"（右上角）

#### 操作步骤
1. 阅读情景内容
2. 观察计时器开始倒计时
3. 点击"下一页"按钮

#### 验证点
- [ ] 页面显示蜂蜜情景内容
- [ ] **40分钟计时器启动**，显示 "剩余时间: 40:00"
- [ ] 计时器每秒更新一次
- [ ] 点击"下一页"跳转到"问题提出"页面
- [ ] Console 显示:
  ```
  [TrackingProvider] 探究任务计时器启动: 40分钟
  [TrackingProvider] 页面进入: Page_01_Intro
  ```

#### Network 验证
- [ ] 发送 `POST /stu/saveHcMark` 请求
- [ ] `mark` 包含:
  - `pageNumber`: "1"
  - `pageDesc`: "情景引入"

---

### 第3步: 问题提出页面 (Page03_Question)

#### 页面元素
- 标题: "问题提出"
- 提示: "请基于情景，提出一个科学问题"
- 文本输入框（多行）
- 字符计数: "当前字符数: 0 / 最少10字符"
- "下一页"按钮（初始禁用）

#### 操作步骤
1. 在文本框中输入科学问题
2. 输入至少10个字符
3. 观察字符计数更新
4. 点击"下一页"按钮

#### 测试输入
```
蜂蜜在不同温度和含水量条件下，流动速度会有什么变化？
```

#### 验证点
- [ ] 输入不足10字符时，按钮保持禁用
- [ ] 字符计数实时更新
- [ ] 输入≥10字符后，按钮启用
- [ ] 点击"下一页"跳转到"资料阅读"页面
- [ ] Console 显示输入操作日志

#### Network 验证
- [ ] `mark` 的 `answerList` 包含:
  ```json
  [{
    "targetElement": "scientific-question",
    "value": "蜂蜜在不同温度和含水量条件下，流动速度会有什么变化？"
  }]
  ```

---

### 第4步: 资料阅读页面 (Page04_Resource)

#### 页面元素
- 标题: "资料阅读"
- 5个资料按钮:
  1. 资料1：液体流动性基础知识
  2. 资料2：温度对液体粘度的影响
  3. 资料3：含水量对蜂蜜粘度的影响
  4. 资料4：实验设计方法
  5. 资料5：数据分析技巧
- 复选框组: "请选择你认为会影响蜂蜜流动速度的因素（至少选择1项）"
  - 温度
  - 含水量
  - 蜂蜜种类
  - 容器材质
- "下一页"按钮（初始禁用）

#### 操作步骤
1. 点击每个资料按钮，阅读资料内容
2. 关闭模态窗口
3. 勾选至少1个影响因素（建议勾选"温度"和"含水量"）
4. 点击"下一页"按钮

#### 验证点
- [ ] 点击资料按钮打开模态窗口
- [ ] 模态窗口显示资料内容
- [ ] 点击"关闭"或背景关闭模态窗口
- [ ] 至少勾选1个因素后，按钮启用
- [ ] 点击"下一页"跳转到"假设陈述"页面
- [ ] Console 显示每个资料点击和因素选择日志

#### Network 验证
- [ ] `operationList` 包含5次资料按钮点击
- [ ] `operationList` 包含因素复选框点击
- [ ] `answerList` 包含选中的影响因素

---

### 第5步: 假设陈述页面 (Page06_Hypothesis)

#### 页面元素
- 标题: "假设陈述"
- 假设内容: "我们假设：温度越高、含水量越高，蜂蜜流动速度越快"
- 天气图或示意图
- "下一页"按钮（立即启用）

#### 操作步骤
1. 阅读假设内容
2. 查看天气图
3. 点击"下一页"按钮

#### 验证点
- [ ] 页面显示假设内容
- [ ] 天气图正确显示
- [ ] 点击"下一页"跳转到"方案设计"页面

---

### 第6步: 方案设计页面 (Page07_Design)

#### 页面元素
- 标题: "方案设计"
- 提示: "请设计3个实验方案来验证假设"
- 3个文本输入框:
  - 实验想法1（≥10字符）
  - 实验想法2（≥10字符）
  - 实验想法3（≥10字符）
- 进度提示: "已完成 X/3 个实验想法"
- "下一页"按钮（初始禁用）

#### 操作步骤
1. 在3个输入框中分别输入实验想法
2. 每个想法至少10个字符
3. 观察进度提示更新
4. 点击"下一页"按钮

#### 测试输入
```
实验想法1: 控制含水量不变，改变温度，测量蜂蜜下落时间
实验想法2: 控制温度不变，改变含水量，测量蜂蜜下落时间
实验想法3: 同时改变温度和含水量，观察综合影响
```

#### 验证点
- [ ] 每个输入框字符计数正确
- [ ] 输入不足10字符时，该输入框标红或提示
- [ ] 进度提示实时更新: "已完成 1/3", "2/3", "3/3"
- [ ] 3个想法都≥10字符后，按钮启用
- [ ] 点击"下一页"跳转到"方案评估"页面

#### Network 验证
- [ ] `answerList` 包含3个实验想法答案

---

### 第7步: 方案评估页面 (Page08_Evaluation)

#### 页面元素
- 标题: "方案评估"
- 3种实验方法展示:
  1. 方法A：固定温度，改变含水量
  2. 方法B：固定含水量，改变温度
  3. 方法C：同时改变温度和含水量
- 每个方法有优缺点输入框（可选填写，至少3个）
- 完成度提示: "已填写 X 个优缺点"
- 进度条显示
- "下一页"按钮（初始禁用）

#### 操作步骤
1. 阅读3种实验方法
2. 填写至少3个优缺点（任意方法）
3. 观察完成度提示和进度条更新
4. 点击"下一页"按钮

#### 测试输入
```
方法A优点: 控制变量清晰，便于分析含水量的单独影响
方法B优点: 控制变量清晰，便于分析温度的单独影响
方法C优点: 能够观察到综合效应
```

#### 验证点
- [ ] 每个优缺点输入框正常工作
- [ ] 完成度提示实时更新: "已填写 1 个", "2 个", "3 个"
- [ ] 进度条百分比正确（如12个框，3个填写=25%）
- [ ] 填写≥3个后，按钮启用
- [ ] 点击"下一页"跳转到"过渡页面"

#### Network 验证
- [ ] `answerList` 包含所有填写的优缺点

---

### 第8步: 过渡页面 (Page09_Transition)

#### 页面元素
- 标题: "过渡"
- 鼓励文字: "做得很好！接下来我们将进行模拟实验"
- "下一页"按钮（立即启用）

#### 操作步骤
1. 阅读鼓励文字
2. 点击"下一页"按钮

#### 验证点
- [ ] 页面显示鼓励内容
- [ ] 点击"下一页"跳转到"模拟实验"页面

---

### 第9步: 模拟实验页面 (Page10_Experiment) ⭐ 核心页面

#### 页面元素
- 标题: "模拟实验"
- **量筒选择区**（4个量筒按钮）:
  - 20% 含水量
  - 25% 含水量
  - 30% 含水量
  - 35% 含水量
- **温度控制区**（5档温度）:
  - 10°C
  - 20°C
  - 30°C
  - 40°C
  - 50°C
- **实验区**:
  - 量筒图形显示
  - 小球位置
  - "开始实验"按钮
  - 计时器显示（实验进行中）
- **实验历史表格**:
  - 列: 实验编号、含水量、温度、下落时间
  - 显示所有已完成的实验
- "下一页"按钮（至少完成3次实验后启用）

#### 操作步骤
1. **第一次实验**:
   - 选择量筒: 20%
   - 选择温度: 10°C
   - 点击"开始实验"
   - 观察小球下落动画（约3-5秒）
   - 动画结束后，自动记录下落时间到历史表格

2. **第二次实验**:
   - 选择量筒: 25%
   - 选择温度: 30°C
   - 点击"开始实验"
   - 观察动画

3. **第三次实验**:
   - 选择量筒: 35%
   - 选择温度: 50°C
   - 点击"开始实验"
   - 观察动画

4. 查看实验历史表格，确认3次实验都已记录
5. 点击"下一页"按钮（现在应该已启用）

#### 验证点

**选择交互**:
- [ ] 点击量筒按钮，该量筒高亮显示（蓝色边框或背景）
- [ ] 点击温度按钮，该温度高亮显示
- [ ] 未选择量筒或温度时，"开始实验"按钮禁用
- [ ] 两者都选择后，"开始实验"按钮启用

**实验动画**:
- [ ] 点击"开始实验"后，小球从顶部开始下落
- [ ] 动画流畅，帧率≥60 FPS（无明显卡顿）
- [ ] 小球下落时间根据含水量和温度动态计算（含水量越高、温度越高，下落越快）
- [ ] 动画期间显示计时器: "0.00s", "0.50s", "1.00s"...
- [ ] 动画结束后，显示"下落时间: X.XX秒"

**数据记录**:
- [ ] 实验完成后，数据自动添加到历史表格
- [ ] 表格显示: 实验编号（1, 2, 3...）、含水量、温度、下落时间
- [ ] 可以进行多次实验（不限制次数）
- [ ] 至少3次实验后，"下一页"按钮启用

**导航**:
- [ ] 点击"下一页"跳转到"数据分析1"页面
- [ ] **实验区保持可用**（在分析页面仍可继续实验）

#### Console 验证
```
[TrackingProvider] 量筒选择: 20%
[TrackingProvider] 温度选择: 10°C
[TrackingProvider] 实验启动
[TrackingProvider] 小球下落动画开始
[TrackingProvider] 实验完成: 下落时间 4.52秒
```

#### Network 验证
- [ ] `operationList` 包含量筒选择、温度选择、实验启动操作
- [ ] `answerList` 包含实验数据数组:
  ```json
  [{
    "targetElement": "experiment-history",
    "value": "[{\"id\":1,\"water\":20,\"temp\":10,\"time\":4.52}]"
  }]
  ```

---

### 第10-12步: 数据分析页面 (Page11-13_Analysis1-3)

#### 页面元素
- 标题: "数据分析 (1/3)", "(2/3)", "(3/3)"
- 分析题目（单选题）
- **实验区仍然可用**（可继续进行实验）
- 4个选项（A、B、C、D）
- "下一页"按钮（初始禁用）

#### 操作步骤

**数据分析1** (Page11):
1. 阅读题目: "根据实验数据，温度对蜂蜜流动速度的影响是？"
2. 选择答案: A. 温度越高，流动速度越快
3. （可选）继续进行实验
4. 点击"下一页"

**数据分析2** (Page12):
1. 阅读题目: "根据实验数据，含水量对蜂蜜流动速度的影响是？"
2. 选择答案: B. 含水量越高，流动速度越快
3. 点击"下一页"

**数据分析3** (Page13):
1. 阅读题目: "温度和含水量的综合影响是？"
2. 选择答案: C. 两者都能显著影响流动速度
3. 点击"下一页"

#### 验证点
- [ ] 每个分析页面都显示题目和选项
- [ ] **实验区保持可见和可用**（可以继续选择量筒、温度、开始实验）
- [ ] 新实验数据继续添加到历史表格
- [ ] 选择答案后，按钮启用
- [ ] 点击"下一页"跳转到下一个分析页面或方案选择页面

#### Network 验证
- [ ] 每个分析页面提交一次数据
- [ ] `answerList` 包含单选答案
- [ ] 如果在分析页进行了新实验，`answerList` 也包含新实验数据

---

### 第13步: 方案选择页面 (Page14_Solution)

#### 页面元素
- 标题: "方案选择"
- **折线图**:
  - X轴: 温度 (10°C, 20°C, 30°C, 40°C, 50°C)
  - Y轴: 下落时间（秒）
  - 多条折线: 不同含水量的曲线
  - 图例显示含水量
- **动态表格**:
  - 列: 温度、含水量、操作
  - "添加行"按钮
  - 每行可选择温度和含水量
  - "删除"按钮
- **理由输入框**:
  - 提示: "请说明你的选择理由（至少10字符）"
  - 字符计数
- "下一页"按钮（初始禁用）

#### 操作步骤
1. 查看折线图，分析不同条件下的下落时间
2. 点击"添加行"按钮，添加至少1行
3. 在新行中选择温度（如30°C）和含水量（如25%）
4. 在理由输入框中输入至少10个字符
5. 点击"下一页"按钮

#### 测试输入
```
理由: 根据实验数据，30°C和25%含水量是最优组合，能够使蜂蜜保持适中的流动速度。
```

#### 验证点

**折线图**:
- [ ] 折线图正确显示实验数据
- [ ] X轴标签: 温度
- [ ] Y轴标签: 下落时间
- [ ] 多条折线颜色区分
- [ ] 图例正确显示含水量

**动态表格**:
- [ ] 点击"添加行"增加一行
- [ ] 新行包含温度下拉框、含水量下拉框、删除按钮
- [ ] 温度选项: 10, 20, 30, 40, 50°C
- [ ] 含水量选项: 20%, 25%, 30%, 35%
- [ ] 点击"删除"按钮删除该行
- [ ] 至少有1行数据

**理由输入**:
- [ ] 字符计数实时更新
- [ ] 输入≥10字符后，按钮启用

**导航**:
- [ ] 点击"下一页"跳转到"任务总结"页面

#### Network 验证
- [ ] `answerList` 包含:
  - 表格数据数组（温度、含水量组合）
  - 理由文本

---

### 第14步: 任务总结页面 (Page13_Summary)

#### 页面元素
- 标题: "任务总结"
- 总结内容: "恭喜你完成了探究任务！你成功设计并执行了实验，分析了数据，得出了结论。"
- 提示: "接下来请完成问卷调查（约10分钟）"
- "继续"按钮（立即启用）

#### 操作步骤
1. 阅读总结内容
2. 点击"继续"按钮

#### 验证点
- [ ] 页面显示总结和鼓励文字
- [ ] 点击"继续"跳转到"问卷说明"页面
- [ ] **40分钟探究任务计时器停止**（如果还在运行）

---

### 第15步: 问卷说明页面 (Page02_QuestionnaireNotice)

#### 页面元素
- 标题: "问卷调查说明"
- 说明内容: "接下来请回答一些关于你的学习体验和感受的问题"
- 提示: "共27题，预计10分钟完成"
- "开始作答"按钮（立即启用）
- **计时器显示**: "剩余时间: 10:00"

#### 操作步骤
1. 阅读问卷说明
2. 点击"开始作答"按钮

#### 验证点
- [ ] 页面显示问卷说明
- [ ] **10分钟问卷计时器启动**，显示 "剩余时间: 10:00"
- [ ] 点击"开始作答"跳转到"问卷第1页"

#### Console 验证
```
[TrackingProvider] 问卷计时器启动: 10分钟
[TrackingProvider] 导航模式切换: Questionnaire
```

---

### 第16-23步: 问卷页面 (Page15-22_Questionnaire1-8)

#### 页面结构
- 每页包含3-4个问题（共27题）
- 每个问题都是单选题
- 选项: 完全不同意 / 不同意 / 中立 / 同意 / 完全同意
- 进度提示: "问卷进度: X/27"
- "下一页"按钮（初始禁用）
- 最后一页: "提交问卷"按钮

#### 问卷页面分布

| 页面 | 题目范围 | 题目数 |
|------|----------|--------|
| Page15 | Q1-Q5 | 5题 |
| Page16 | Q6-Q9 | 4题 |
| Page17 | Q10-Q12 | 3题 |
| Page18 | Q13-Q15 | 3题 |
| Page19 | Q16-Q18 | 3题 |
| Page20 | Q19-Q22 | 4题 |
| Page21 | Q23-Q25 | 3题 |
| Page22 | Q26-Q27 | 2题 |

#### 操作步骤

**每个问卷页面**:
1. 阅读题目
2. 选择答案（每题都必须选择）
3. 观察进度提示更新
4. 点击"下一页"（或最后一页点击"提交问卷"）

#### 快速测试选项
为了快速测试，可以选择相同的答案（如"同意"）:
- Q1-Q27: 都选择"同意"

#### 验证点

**每个问卷页面**:
- [ ] 显示题目内容和选项
- [ ] 单选按钮正常工作
- [ ] 必须回答所有题目才能启用"下一页"
- [ ] 进度提示正确更新: "问卷进度: 5/27", "9/27", ...
- [ ] 点击"下一页"跳转到下一个问卷页面
- [ ] Console 显示答案选择日志

**最后一页 (Page22)**:
- [ ] 显示 Q26-Q27
- [ ] 回答所有问题后，"提交问卷"按钮启用
- [ ] 点击"提交问卷"跳转到"完成页面"
- [ ] Console 显示:
  ```
  [TrackingProvider] 问卷完成
  [TrackingProvider] 提交最后一页数据
  ```

#### Network 验证
- [ ] 每个问卷页面提交一次数据
- [ ] 共8次 `POST /stu/saveHcMark` 请求（Page15-22）
- [ ] 每次 `answerList` 包含当前页面的所有答案
- [ ] `pageNumber` 依次为 "14", "15", "16", "17", "18", "19", "20", "21"

---

### 第24步: 完成页面 (Page23_Completion)

#### 页面元素
- 标题: "测评完成"
- 感谢消息: "感谢你完成本次测评！你的数据已经成功提交。"
- "返回登录页面"按钮（立即启用）

#### 操作步骤
1. 阅读完成消息
2. 点击"返回登录页面"按钮

#### 验证点
- [ ] 页面显示感谢消息
- [ ] 点击"返回登录页面"跳转到登录页
- [ ] **10分钟问卷计时器停止**
- [ ] Console 显示:
  ```
  [TrackingProvider] 测评完成
  [TrackingProvider] 清除会话数据
  ```

#### LocalStorage 验证
- [ ] `hci-isAuthenticated` 变为 "false"（或被清除）
- [ ] 其他会话数据保留或清除（根据实现）

---

## 数据完整性验证

### Network 请求总览

在完成整个流程后，打开 Network 标签，过滤 `/stu/saveHcMark`:

#### 预期请求数量
- **探究任务部分**: 约13次（Page0.1, Page1-13）
- **问卷部分**: 8次（Page14-21）
- **总计**: 约21次 POST 请求

#### 逐个验证请求

使用以下脚本在 Console 中查看所有请求:

```javascript
// 查看所有 saveHcMark 请求
const requests = performance.getEntriesByType('resource')
  .filter(r => r.name.includes('saveHcMark'));
console.log(`总请求数: ${requests.length}`);
```

#### 检查 FormData 结构

在 Network 标签中，随机选择3-5个请求，点击查看:

1. **Headers 标签**:
   - Request Method: `POST`
   - Content-Type: `multipart/form-data`

2. **Payload 标签** (FormData):
   - `batchCode`: "250619"
   - `examNo`: "1001"
   - `mark`: JSON字符串

3. **mark 字段解析**:
   ```json
   {
     "pageNumber": "X",
     "pageDesc": "页面描述",
     "operationList": [
       {
         "targetElement": "元素ID",
         "eventType": "操作类型",
         "value": "值",
         "time": "ISO时间戳"
       }
     ],
     "answerList": [
       {
         "targetElement": "答案ID",
         "value": "答案内容"
       }
     ],
     "beginTime": "YYYY-MM-DD HH:mm:ss",
     "endTime": "YYYY-MM-DD HH:mm:ss",
     "imgList": []
   }
   ```

#### 验证点
- [ ] 所有请求返回 `200 OK`
- [ ] 所有请求包含正确的 `batchCode` 和 `examNo`
- [ ] 所有 `mark` 字段是有效的 JSON 字符串
- [ ] 所有 `mark` 包含完整的 MarkObject 结构
- [ ] `pageNumber` 依次递增
- [ ] `operationList` 不为空（除非是纯导航页面）
- [ ] `beginTime` 和 `endTime` 格式正确

---

## Console 日志验证

### 预期日志类型

在 Console 中应该看到以下类型的日志:

#### 模块初始化
```
[ModuleRegistry] 模块系统初始化
[ModuleRouter] 模块加载成功: grade-7-tracking
[Grade7TrackingModule] 7年级追踪测评模块初始化
[TrackingProvider] 初始化: initialPageId = Page_00_1_Precautions
```

#### 页面导航
```
[TrackingProvider] 页面进入: Page_00_1_Precautions
[TrackingProvider] 页面退出: Page_00_1_Precautions
[TrackingProvider] 导航到下一页: Page_01_Intro
```

#### 用户交互
```
[TrackingProvider] 操作记录: 复选框勾选
[TrackingProvider] 操作记录: 文本输入
[TrackingProvider] 操作记录: 量筒选择 - 20%
[TrackingProvider] 操作记录: 温度选择 - 10°C
[TrackingProvider] 操作记录: 实验启动
```

#### 数据提交
```
[useDataLogger] 提交页面数据: Page_00_1_Precautions
[useDataLogger] 数据提交成功
[TrackingProvider] 清除操作日志
```

#### 计时器
```
[TrackingProvider] 探究任务计时器启动: 40分钟
[TrackingProvider] 问卷计时器启动: 10分钟
[TrackingProvider] 计时器更新: 39:58
```

### 验证点
- [ ] 无 `[Error]` 日志
- [ ] 无红色错误消息
- [ ] 所有操作都有对应日志
- [ ] 数据提交日志显示"成功"

---

## 性能验证

### 使用 Performance API

在 Console 中执行以下脚本:

```javascript
// 获取导航计时
const navTiming = performance.getEntriesByType('navigation')[0];
console.log('首屏加载时间:', navTiming.loadEventEnd - navTiming.fetchStart, 'ms');
console.log('DOM加载时间:', navTiming.domContentLoadedEventEnd - navTiming.fetchStart, 'ms');

// 获取资源加载时间
const resources = performance.getEntriesByType('resource');
console.log('总资源数:', resources.length);
console.log('平均资源加载时间:',
  resources.reduce((sum, r) => sum + r.duration, 0) / resources.length, 'ms');
```

### 验证点
- [ ] 首屏加载时间 < 2000ms
- [ ] DOM加载时间 < 1500ms
- [ ] 平均资源加载时间 < 500ms

### 使用 Chrome DevTools Performance 标签

1. 打开 Performance 标签
2. 点击"Record"按钮
3. 执行一些操作（页面切换、按钮点击、实验动画）
4. 停止录制
5. 查看火焰图和时间线

#### 验证点
- [ ] FPS 保持在 60 左右（动画期间）
- [ ] 主线程没有长任务（>50ms的黄色/红色块）
- [ ] 交互响应时间 < 100ms

---

## 页面刷新恢复测试

### 测试步骤

1. 完成到任意页面（如 Page10_Experiment）
2. 记录当前页面ID
3. 按 F5 刷新页面
4. 观察页面是否恢复到刷新前的位置

### 验证点
- [ ] 刷新后恢复到相同页面
- [ ] 已填写的数据恢复（如果实现了持久化）
- [ ] 计时器状态恢复（如果实现了持久化）
- [ ] 实验历史数据恢复
- [ ] Console 显示:
  ```
  [ModuleRouter] 恢复会话: pageNum = X
  [Grade7TrackingModule] 页面恢复: Page_XX
  ```

---

## 错误处理测试

### 模拟网络失败

1. 打开 Chrome DevTools > Network 标签
2. 将网络状态设置为 "Offline"
3. 尝试点击"下一页"按钮
4. 观察错误提示

#### 验证点
- [ ] 显示友好的错误提示: "网络连接失败，请检查网络后重试"
- [ ] 提供"重试"按钮
- [ ] Console 显示错误日志
- [ ] 用户数据不丢失

### 模拟 API 错误

如果可以修改 Mock API，返回错误响应（如500）:

```javascript
// 在 vite.config.js 中临时修改
res.statusCode = 500;
res.end(JSON.stringify({ code: 500, msg: 'Internal Server Error' }));
```

#### 验证点
- [ ] 显示错误提示
- [ ] 提供重试选项
- [ ] 最多重试3次
- [ ] 3次失败后显示明确错误信息

---

## 测试通过标准

### 功能测试
- [ ] 完整流程无报错
- [ ] 所有页面正常显示和切换
- [ ] 所有交互正常响应
- [ ] 所有验证逻辑正确
- [ ] 计时器正常工作

### 数据测试
- [ ] 所有操作都被记录
- [ ] 所有答案都被收集
- [ ] 数据提交100%成功
- [ ] MarkObject 结构完整

### 性能测试
- [ ] 页面加载 < 2秒
- [ ] 交互响应 < 100ms
- [ ] 动画流畅 60 FPS
- [ ] 无明显卡顿

### 用户体验
- [ ] 界面清晰易懂
- [ ] 操作流程顺畅
- [ ] 错误提示友好
- [ ] 无死锁或无法前进的情况

---

## 测试报告模板

### 测试基本信息
- **测试人员**: _________________
- **测试日期**: 2025-10-15
- **测试浏览器**: Chrome 120+
- **测试环境**: 开发环境 (Mock API)

### 测试结果统计
- **总测试项**: _________
- **通过项**: _________
- **失败项**: _________
- **通过率**: _________%

### 发现的问题

| 编号 | 页面 | 问题描述 | 严重程度 | 状态 |
|------|------|----------|----------|------|
| 1 | - | - | 高/中/低 | 待修复/已修复 |

### 测试结论

- [ ] ✅ **测试通过** - 所有功能正常，可以进入下一阶段
- [ ] ⚠️ **有限通过** - 存在少量非关键问题，可以上线
- [ ] ❌ **测试不通过** - 存在关键问题，需要修复后重新测试

### 测试人员签名
_________________

---

**备注**:
- 本测试指南涵盖了完整的 E2E 流程
- 建议至少执行2-3次完整测试以确保稳定性
- 记录所有异常情况和控制台错误
- 保存测试期间的截图和日志
