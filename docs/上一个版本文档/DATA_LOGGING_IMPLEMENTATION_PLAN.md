# 数据记录实施计划

## 1. 实施概述

本计划基于《数据记录规范文档》，分阶段实施完整的用户行为数据记录系统。目标是在所有页面实现标准化的数据记录，确保数据完整性和准确性。

## 2. 实施阶段

### 阶段一：核心架构优化（已部分完成）
**目标**：优化现有的数据记录基础架构
**状态**：90% 完成

- [x] AppContext.jsx 中的 logOperation 和 collectAnswer 函数
- [x] API服务 submitPageMarkData 函数
- [x] 时间格式化函数
- [ ] 数据验证和错误处理增强

### 阶段二：页面映射和标准化（进行中）
**目标**：更新页面映射，确保pageNumber和pageDesc符合规范
**状态**：需要更新

#### 步骤 2.1：更新 pageMappings.js
- 更新页面编号和描述映射
- 添加进度题目编号映射
- 实现页面描述生成函数

#### 步骤 2.2：更新 API 提交格式
- 确保使用 POST 方法提交到 `/stu/submitPageMarkData`
- 验证数据格式符合规范要求

### 阶段三：登录页面数据记录（优先级：高）
**目标**：实现登录页面的完整数据记录
**估时**：2小时

#### 步骤 3.1：登录页面交互记录
- 账号输入框的 input 和 input_blur 事件
- 密码输入框的 input 和 input_blur 事件  
- 登录按钮点击事件
- 页面进入和退出时间记录

#### 步骤 3.2：登录页面数据提交
- 登录成功后提交登录页面数据
- 错误处理和重试机制

### 阶段四：注意事项页面完善（优先级：高）
**目标**：完善注意事项页面的数据记录
**估时**：1小时

#### 步骤 4.1：交互记录完善
- 复选框的 checkbox_check/checkbox_uncheck 事件
- 继续按钮点击事件
- 页面进入时间记录（任务开始前）

### 阶段五：输入型页面标准化（优先级：高）
**目标**：所有包含输入框的页面实现标准数据记录
**估时**：4小时

#### 涉及页面：
- Page_03_Dialogue_Question（对话与提出问题）
- Page_11_Solution_Design_Measurement_Ideas（方案设计）
- Page_12_Solution_Evaluation_Measurement_Critique（方案评估）

#### 步骤 5.1：输入框标准化
- 实现 onChange 和 onBlur 事件记录
- 确保失焦时记录答案
- 添加输入内容验证

#### 步骤 5.2：按钮交互记录
- 下一页按钮点击记录
- 数据提交前的验证记录

### 阶段六：资料阅读页面完善（优先级：中）
**目标**：完善 Page_04_Material_Reading_Factor_Selection 的数据记录
**估时**：2小时

#### 步骤 6.1：模态框交互记录（已部分完成）
- [x] 资料链接点击记录
- [x] 模态框打开/关闭记录
- [x] 查看时长记录

#### 步骤 6.2：因素选择记录
- [x] 复选框选择/取消记录
- [x] 最终答案收集
- [ ] 提交验证增强

### 阶段七：模拟实验页面数据记录（优先级：高）
**目标**：实现模拟实验相关页面的详细数据记录
**估时**：6小时

#### 涉及页面：
- Page_14_Simulation_Intro_Exploration（模拟实验介绍）
- Page_15_Simulation_Question_1（模拟实验问题1）
- Page_16_Simulation_Question_2（模拟实验问题2）
- Page_17_Simulation_Question_3（模拟实验问题3）

#### 步骤 7.1：模拟实验交互记录
- 计时器开始/停止记录
- 参数调整记录
- 实验操作记录
- 结果观察记录

#### 步骤 7.2：答案选择记录
- 单选按钮选择记录
- 答案提交验证

### 阶段八：方案选择页面完善（优先级：中）
**目标**：完善 Page_18_Solution_Selection 的数据记录
**估时**：3小时

#### 步骤 8.1：表格交互记录
- 表格单元格编辑记录
- 数据输入验证记录
- 推理过程记录

### 阶段九：任务完成页面（优先级：低）
**目标**：实现任务完成页面的数据记录
**估时**：1小时

#### 步骤 9.1：完成状态记录
- 任务完成时间记录
- 最终数据汇总

### 阶段十：数据完整性验证和测试（优先级：高）
**目标**：确保所有页面的数据记录完整性
**估时**：4小时

#### 步骤 10.1：端到端测试
- 完整流程数据记录测试
- 数据格式验证测试
- 错误处理测试

#### 步骤 10.2：性能优化
- 数据记录性能测试
- 内存使用优化
- 网络请求优化

## 3. 开发优先级

### 立即开始（本次实施）：
1. **更新 pageMappings.js**（阶段二）
2. **登录页面数据记录**（阶段三）
3. **输入型页面标准化**（阶段五）

### 后续实施：
4. 模拟实验页面数据记录（阶段七）
5. 方案选择页面完善（阶段八）
6. 数据完整性验证（阶段十）

## 4. 技术实施要点

### 4.1 统一的数据记录 Hook
创建 `useDataLogging` 自定义 Hook，封装常用的数据记录逻辑：

```jsx
const useDataLogging = (pageId) => {
  const { logOperation, collectAnswer } = useAppContext();
  
  const logInput = (element, value) => {
    logOperation({
      targetElement: element,
      eventType: 'input',
      value: value
    });
  };
  
  const logInputBlur = (element, value) => {
    logOperation({
      targetElement: element,
      eventType: 'input_blur',
      value: value
    });
    
    collectAnswer({
      targetElement: element,
      value: value
    });
  };
  
  // ... 其他通用方法
  
  return { logInput, logInputBlur, ... };
};
```

### 4.2 自动化数据验证
实现数据验证中间件，确保提交的数据格式正确：

```jsx
const validatePageData = (pageData) => {
  // 验证必填字段
  // 验证数据类型
  // 验证时间格式
  return { isValid, errors };
};
```

### 4.3 错误处理和重试
实现自动重试机制和用户友好的错误提示：

```jsx
const submitWithRetry = async (data, maxRetries = 3) => {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await submitPageMarkData(data);
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await delay(1000 * (i + 1)); // 递增延迟
    }
  }
};
```

## 5. 质量保证

### 5.1 代码审查检查点
- [ ] 所有交互元素都有数据记录
- [ ] 时间格式统一正确
- [ ] 错误处理覆盖完整
- [ ] 性能影响最小化

### 5.2 测试用例
- [ ] 每个页面的完整交互流程
- [ ] 网络异常情况下的数据处理
- [ ] 大量数据记录的性能测试
- [ ] 数据格式的准确性验证

## 6. 风险和缓解措施

### 6.1 主要风险
1. **数据记录过于频繁影响性能**
   - 缓解：使用防抖和节流技术
   - 缓解：本地缓存和批量提交

2. **网络错误导致数据丢失**
   - 缓解：本地存储备份
   - 缓解：自动重试机制

3. **数据格式不一致**
   - 缓解：统一的数据验证
   - 缓解：类型定义和检查

### 6.2 应急预案
- 数据提交失败时的本地备份策略
- 关键数据的冗余记录
- 系统异常时的数据恢复机制

## 7. 成功指标

1. **数据完整性**：所有用户交互都有对应记录
2. **数据准确性**：记录的数据格式和内容正确
3. **系统性能**：数据记录不影响用户体验
4. **错误处理**：网络异常时数据不丢失
5. **用户体验**：数据记录过程对用户透明 