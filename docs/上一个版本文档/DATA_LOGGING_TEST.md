# 数据记录功能测试指南

## 测试目标

验证蒸馒头科学探究任务系统中的用户行为数据记录功能是否按照规范正确实施。

## 测试环境准备

1. 启动开发服务器：`npm run dev`
2. 打开浏览器并访问 `http://localhost:3001`
3. 打开浏览器开发者工具（F12），查看控制台输出

## 测试用例

### 测试用例1：登录页面数据记录

**测试步骤：**
1. 在登录页面输入账号（例如：test123）
2. 在账号输入框中输入时观察控制台
3. 点击账号输入框外部（失焦）
4. 在密码输入框中输入密码
5. 点击密码输入框外部（失焦）
6. 点击登录按钮

**预期结果：**
- 控制台应显示 "发起登录请求" 的调试信息
- 应记录页面进入事件（eventType: 'page_enter'）
- 应记录账号输入事件（eventType: 'input'）
- 应记录账号失焦事件（eventType: 'input_blur'）
- 应记录密码输入事件（eventType: 'input'，但值应是"密码长度X位"）
- 应记录密码失焦事件（eventType: 'input_blur'）
- 应记录登录按钮点击事件（eventType: 'click'）
- 登录成功后应提交登录页面数据

**数据格式验证：**
```json
{
  "batchCode": "测评批次号",
  "examNo": "学生考号",
  "mark": {
    "pageNumber": "Login",
    "pageDesc": "用户登录",
    "operationList": [
      {
        "code": 1,
        "targetElement": "页面",
        "eventType": "page_enter",
        "value": "用户登录页面",
        "time": "2025-01-29 HH:mm:ss"
      },
      {
        "code": 2,
        "targetElement": "账号输入框",
        "eventType": "input",
        "value": "test123",
        "time": "2025-01-29 HH:mm:ss"
      },
      {
        "code": 3,
        "targetElement": "账号输入框",
        "eventType": "input_blur",
        "value": "test123",
        "time": "2025-01-29 HH:mm:ss"
      }
    ],
    "answerList": [
      {
        "code": 1,
        "targetElement": "登录账号",
        "value": "test123"
      },
      {
        "code": 2,
        "targetElement": "登录密码状态",
        "value": "已输入密码"
      }
    ],
    "beginTime": "2025-01-29 HH:mm:ss",
    "endTime": "2025-01-29 HH:mm:ss",
    "imgList": []
  }
}
```

### 测试用例2：注意事项页面数据记录

**测试步骤：**
1. 登录成功后自动跳转到注意事项页面
2. 点击"我已阅读并理解上述注意事项"复选框
3. 点击"继续"按钮

**预期结果：**
- 应记录页面进入事件
- 应记录复选框选中事件（eventType: 'checkbox_check'）
- 应记录继续按钮点击事件（eventType: 'click'）
- 应收集注意事项确认状态答案
- 点击继续后应启动任务计时器

### 测试用例3：输入型页面数据记录（对话与提出问题）

**测试步骤：**
1. 在科学问题输入框中输入问题
2. 在输入过程中观察控制台
3. 点击输入框外部（失焦）
4. 点击"下一页"按钮

**预期结果：**
- 应记录页面进入事件
- 应记录每次输入的内容（eventType: 'input'）
- 应记录输入框失焦事件（eventType: 'input_blur'）
- 应记录下一页按钮点击事件
- 应收集用户提出的科学问题答案
- 应提交页面数据到后端

### 测试用例4：资料阅读页面数据记录

**测试步骤：**
1. 进入资料阅读与因素选择页面
2. 点击任一资料链接打开模态框
3. 在模态框中停留几秒后关闭
4. 选择或取消复选框选项
5. 点击"下一页"按钮

**预期结果：**
- 应记录资料链接点击事件（eventType: 'modal_open'）
- 应记录模态框关闭事件（eventType: 'modal_close'），包含查看时长
- 应记录复选框选择/取消事件（eventType: 'checkbox_check'/'checkbox_uncheck'）
- 应收集选中的因素答案

## 数据验证要点

### 1. 时间格式验证
- 所有时间字段应使用格式：`YYYY-MM-DD HH:mm:ss`
- beginTime 应小于或等于 endTime
- operationList 中的时间应在 beginTime 和 endTime 之间

### 2. 数据完整性验证
- pageNumber 和 pageDesc 应符合页面映射规范
- operationList 的 code 应从 1 开始递增
- answerList 的 code 应从 1 开始递增
- 必须包含 batchCode 和 examNo（来自登录响应）

### 3. 交互事件完整性
- 每个用户交互都应有对应的操作记录
- 输入框失焦时必须记录 input_blur 事件
- 按钮点击必须记录 click 事件
- 页面进入必须记录 page_enter 事件

### 4. 答案收集完整性
- 所有用户输入的内容都应被收集为答案
- 复选框、单选框的选择状态应被收集
- 答案的 targetElement 应清晰描述对应的问题或元素

## 错误检测

### 常见问题检查
1. **时间格式错误**：检查控制台是否有时间格式相关错误
2. **数据提交失败**：检查控制台是否有 API 错误信息
3. **缺失交互记录**：检查是否所有交互都有对应记录
4. **重复记录**：检查是否有不必要的重复记录

### 网络错误测试
1. 断开网络连接
2. 进行正常操作
3. 检查错误处理是否正确
4. 恢复网络连接后检查重试机制

## 性能测试

### 响应性测试
1. 快速连续输入文本
2. 检查页面响应是否流畅
3. 观察内存使用情况

### 数据量测试
1. 在输入框中输入大量文本（1000字符以上）
2. 频繁点击复选框
3. 检查系统性能是否受影响

## 测试报告模板

```
测试日期：2025-01-29
测试版本：v1.0.0
测试人员：[姓名]

测试结果：
□ 登录页面数据记录 - 通过/失败
□ 注意事项页面数据记录 - 通过/失败  
□ 输入型页面数据记录 - 通过/失败
□ 资料阅读页面数据记录 - 通过/失败

发现的问题：
1. [描述问题]
2. [描述问题]

建议改进：
1. [改进建议]
2. [改进建议]
```

## 自动化测试建议

可以考虑使用以下工具进行自动化测试：
- **Jest** + **Testing Library**：组件级别的单元测试
- **Playwright**：端到端的用户交互测试
- **Mock Service Worker**：模拟 API 响应进行测试

## 联系方式

如测试过程中发现问题，请联系开发团队并提供：
1. 详细的问题描述
2. 重现步骤
3. 控制台错误日志
4. 测试环境信息 