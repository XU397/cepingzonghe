# 浏览器验证清单 - 模块统一平台集成

## 验证目标

验证三个模块 (Grade-4、Grade-7、Grade-7-Tracking) 集成到统一平台后的功能正确性。

## 前置条件

```bash
# 1. 启动开发服务器
npm run dev

# 2. 访问地址
http://localhost:3000

# 3. 测试账号 (根据实际情况调整)
# Mock 模式默认账号请查看 vite.config.js
```

## 验证清单

### A. Grade-7 模块验证 (优先级: 高)

**原因**: Grade-7 已全量使用 AssessmentPageFrame,需重点验证

#### A1. 登录与模块加载

- [ ] **登录页面**: 访问 http://localhost:3000,登录页面正常显示
- [ ] **模块路由**: 登录后系统正确路由到 Grade-7 模块 (`/seven-grade`)
- [ ] **页面加载**: 首页 (注意事项页/实验页) 正常加载,无白屏/报错

**验证步骤**:
1. 打开浏览器开发者工具 (F12)
2. 切换到 Console 标签
3. 登录系统
4. 检查是否有以下日志 (正常情况):
   ```
   [Grade7Wrapper] 🎯 7年级模块包装器已挂载
   [AssessmentPageFrame] 页面框架初始化
   ```
5. 检查是否有红色错误信息

#### A2. 统一页面框架 (AssessmentPageFrame)

- [ ] **布局结构**: 页面分为左侧导航 + 主内容区域
- [ ] **左侧导航**: LeftStepperNav 显示正常
  - 圆点样式正确 (当前高亮、已完成、未完成)
  - 步骤指示器显示 (如 "5/12")
  - 导航不可点击 (只读模式)
- [ ] **顶部计时器**: TimerDisplay 显示正常
  - 倒计时正常运行 (秒数递减)
  - 时间格式正确 (MM:SS 或 HH:MM:SS)
  - 警告状态 (5分钟以下变黄色,1分钟以下变红色)

**验证步骤**:
1. 观察页面左侧是否有导航栏
2. 观察页面顶部是否有计时器
3. 等待 5-10 秒,确认计时器数字在变化
4. 截图保存 (建议文件名: `grade7-page-frame.png`)

#### A3. 实验页面 → 问卷页面切换

- [ ] **导航模式切换**: 从实验页面进入问卷页面后
  - 左侧导航自动切换为问卷模式
  - 计时器自动切换为问卷计时器 (10分钟)
  - `data-nav-mode` 属性正确 (检查 DOM)

**验证步骤**:
1. 完成实验部分,进入问卷页面
2. 打开开发者工具 → Elements 标签
3. 检查 `<nav>` 元素的 `data-nav-mode` 属性
4. 实验页面应为 `data-nav-mode="experiment"`
5. 问卷页面应为 `data-nav-mode="questionnaire"`

#### A4. 数据提交与 401 处理

- [ ] **正常提交**: 点击"下一页"按钮,数据正常提交
  - Console 显示: `[usePageSubmission] 提交成功`
  - 页面正常跳转到下一页
- [ ] **401 错误处理**: (需要后端配合或 Mock)
  - 模拟会话过期后提交
  - 系统应自动弹出提示: "您的登录会话已过期,请重新登录"
  - 自动跳转到登录页面
  - localStorage 被清空

**验证步骤** (正常提交):
1. 在任意页面填写答案
2. 点击"下一页"按钮
3. 打开 Console,观察日志
4. 检查页面是否正常跳转

**验证步骤** (401 错误) - 可选,需后端配合:
1. 在开发者工具 → Network 标签中
2. 右键 `/stu/saveHcMark` 请求 → Block request URL
3. 点击"下一页"按钮
4. 观察系统行为

#### A5. 跨刷新恢复

- [ ] **页面位置恢复**: 刷新页面后,停留在当前页面 (不回到首页)
- [ ] **计时器恢复**: 刷新后计时器从之前的剩余时间继续倒计时
- [ ] **数据恢复**: 刷新后已填写的答案仍然存在

**验证步骤**:
1. 进入第 5 页,填写一些答案
2. 等待计时器走到 38:00 左右
3. 按 F5 刷新页面
4. 检查页面是否仍在第 5 页
5. 检查计时器是否从 38:00 继续倒计时
6. 检查答案是否仍然存在

### B. Grade-4 模块验证 (优先级: 中)

**原因**: Grade-4 部分使用统一框架,需验证兼容性

#### B1. 旧版布局 (默认)

- [ ] **环境变量**: 未设置 `VITE_USE_UNIFIED_FRAME` 或设置为 `false`
- [ ] **布局验证**: 使用旧版 LeftNavigation 组件
  - 左侧导航样式为旧版
  - 计时器位置在旧版位置
- [ ] **功能正常**: 登录、导航、提交、跨刷新恢复都正常

**验证步骤**:
1. 确认 `.env.local` 中没有 `VITE_USE_UNIFIED_FRAME=true`
2. 重启开发服务器: `npm run dev`
3. 登录到 Grade-4 模块 (根据后端配置,可能需要修改 mock 数据)
4. 观察页面布局
5. 截图保存 (建议文件名: `grade4-legacy.png`)

#### B2. 新版布局 (可选,需设置环境变量)

- [ ] **环境变量**: 设置 `VITE_USE_UNIFIED_FRAME=true`
- [ ] **布局验证**: ScenarioIntroPage 使用 AssessmentPageFrame
  - 左侧导航使用 LeftStepperNav
  - 顶部计时器使用 TimerDisplay
  - 布局与 Grade-7 一致
- [ ] **功能正常**: 提交、导航、计时器都正常工作

**验证步骤**:
1. 创建 `.env.local` 文件,添加: `VITE_USE_UNIFIED_FRAME=true`
2. 重启开发服务器: `npm run dev`
3. 登录到 Grade-4 模块
4. 进入 ScenarioIntroPage (场景介绍页)
5. 观察页面布局是否与 Grade-7 一致
6. 截图保存 (建议文件名: `grade4-unified.png`)

### C. Grade-7-Tracking 模块验证 (优先级: 中)

**原因**: 主要是后端逻辑改动,UI 变化较小

#### C1. useDataLogger 委托验证

- [ ] **提交功能**: 点击"下一页",数据正常提交
  - Console 显示: `[useDataLogger] 提交数据`
  - Console 显示: `[usePageSubmission] 提交成功`
- [ ] **401 处理**: 会话过期时自动登出 (与 Grade-7 相同)
- [ ] **重试逻辑**: 网络错误时自动重试 (可选,需模拟网络故障)

**验证步骤**:
1. 登录到 Grade-7-Tracking 模块
2. 进入实验页面,进行一次试验
3. 点击"提交"或"下一页"
4. 观察 Console 日志
5. 检查数据是否正常提交到后端

#### C2. TimerService 集成验证

- [ ] **实验计时器**: 进入实验页面,计时器正常启动
- [ ] **问卷计时器**: 进入问卷页面,计时器正常启动
- [ ] **跨刷新恢复**: 刷新页面,计时器从剩余时间继续
- [ ] **超时跳转**: 计时器归零后,自动跳转到下一页 (如果实现)

**验证步骤**:
1. 登录到 Grade-7-Tracking 模块
2. 观察顶部或右上角计时器
3. 等待 10-20 秒,确认计时器在倒计时
4. 刷新页面,观察计时器是否恢复
5. (可选) 修改 localStorage 中的计时器值,测试跨刷新恢复

### D. 通用验证 (所有模块)

#### D1. DEV 环境失败放行

- [ ] **提交失败测试**: (需后端配合或 Mock)
  - 在 DEV 环境,模拟提交失败 (后端返回 500)
  - 系统应显示警告,但允许继续
  - Console 显示: `[usePageSubmission] DEV 模式允许失败后继续`

**验证步骤**:
1. 在开发者工具 → Network 标签中
2. 右键 `/stu/saveHcMark` 请求 → Block request URL
3. 点击"下一页"按钮
4. 观察系统是否显示警告但允许继续

#### D2. Console 日志监控

- [ ] **无红色错误**: Console 中没有红色的错误信息
- [ ] **关键日志存在**: 以下日志应存在
  - `[ModuleRouter]` - 模块路由日志
  - `[Grade7Wrapper]` 或 `[Grade4Module]` - 模块挂载日志
  - `[FlowBridge]` - Flow 桥接日志
  - `[usePageSubmission]` - 提交日志
  - `[TimerService]` - 计时器日志

**验证步骤**:
1. 打开 Console 标签
2. 清空日志 (点击 🚫 图标)
3. 重新登录
4. 浏览 2-3 个页面
5. 检查日志内容

#### D3. 性能验证

- [ ] **页面加载时间**: 首屏加载 < 2s
- [ ] **页面切换流畅**: 点击"下一页"后 < 500ms 完成切换
- [ ] **计时器流畅**: 每秒准时更新,无卡顿
- [ ] **内存泄漏**: 长时间使用后,内存占用不持续增长

**验证步骤**:
1. 开发者工具 → Performance 标签
2. 点击 Record 按钮
3. 登录并浏览几个页面
4. 停止录制
5. 检查 FPS (应 > 30)、加载时间、渲染时间

## 验证结果记录

### 通过标准

- ✅ **关键功能**: 登录、导航、提交、计时器、跨刷新恢复都正常
- ✅ **无严重错误**: Console 中无红色错误
- ✅ **性能达标**: 页面加载 < 2s,切换 < 500ms
- ✅ **兼容性**: 旧版布局和新版布局都能正常工作

### 问题记录模板

如发现问题,请记录:

```markdown
**问题 #1: [简短描述]**
- 模块: Grade-4 / Grade-7 / Grade-7-Tracking
- 页面: Page_XX
- 复现步骤:
  1.
  2.
  3.
- 预期行为:
- 实际行为:
- Console 错误信息: (粘贴完整错误)
- 截图: (如有)
- 严重程度: 致命 / 严重 / 一般 / 轻微
```

## 验证完成后

### 下一步操作

1. **问题修复**: 如有问题,创建 Bug 报告并修复
2. **性能优化**: 如性能不达标,进行优化
3. **文档更新**: 更新 IMPLEMENTATION_SUMMARY.md 中的验证结果
4. **归档提案**: 执行 `openspec archive update-module-integration-to-unified-platform`

### 自动化测试建议

后续可添加以下自动化测试:
- E2E 测试 (Playwright/Cypress) 覆盖关键流程
- 单元测试覆盖 usePageSubmission、TimerService
- 集成测试覆盖 FlowBridge 组件

---

**验证人**: ________________
**验证日期**: ________________
**验证环境**: DEV / STG / PROD
**验证结果**: 通过 / 部分通过 / 未通过
