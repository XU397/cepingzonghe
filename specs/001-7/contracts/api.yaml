openapi: 3.0.3
info:
  title: 7å¹´çº§è¿½è¸ªæµ‹è¯„-èœ‚èœœé»åº¦æ¢ç©¶ APIå¥‘çº¦
  description: |
    å®šä¹‰7å¹´çº§è¿½è¸ªæµ‹è¯„æ¨¡å—ä¸åç«¯æœåŠ¡çš„APIäº¤äº’å¥‘çº¦ã€‚
    éµå¾ªå¹³å°constitution.mdä¸­çš„Data Logging & Submission Protocolã€‚
  version: 1.0.0
  contact:
    name: HCI-Evaluation Assessment Platform
    email: support@example.com

servers:
  - url: https://api.example.com
    description: ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨
  - url: http://localhost:3000
    description: æœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼ˆMockæ¨¡å¼ï¼‰

tags:
  - name: data-submission
    description: æ•°æ®æäº¤ç›¸å…³æ¥å£
  - name: session-management
    description: ä¼šè¯ç®¡ç†ç›¸å…³æ¥å£

paths:
  /stu/saveHcMark:
    post:
      summary: æäº¤é¡µé¢æ•°æ®æ ‡è®°
      description: |
        å­¦ç”Ÿæ¯å®Œæˆä¸€é¡µå†…å®¹åï¼Œæäº¤è¯¥é¡µçš„æ“ä½œè®°å½•ã€ç­”æ¡ˆæ•°æ®å’Œæ—¶é—´æˆ³ã€‚
        è¿™æ˜¯å¹³å°ç»Ÿä¸€çš„æ•°æ®æäº¤æ¥å£ï¼Œæ‰€æœ‰æ¨¡å—å…±ç”¨ã€‚

        **âœ… åç«¯å·²ç¡®è®¤**ï¼š
        - `batchCode` å’Œ `examNo` å‚æ•°å¯ä» Session è·å–ï¼Œå‰ç«¯å¯é€‰ä¼ é€’
        - `mark` å­—æ®µä¸º JSON å¯¹è±¡ï¼ˆéæ•°ç»„ï¼‰ï¼ŒåŒ…å«å•ä¸ªé¡µé¢çš„ MarkObject
        - Session å¤±æ•ˆæ—¶ç”±åç«¯æ‹¦æˆªå™¨è‡ªåŠ¨è¿”å› `code === 401`

        **è°ƒç”¨æ—¶æœº**ï¼š
        - ç‚¹å‡»"ä¸‹ä¸€é¡µ"æŒ‰é’®å
        - é¡µé¢æ•°æ®éªŒè¯é€šè¿‡å

        **é‡è¯•ç­–ç•¥**ï¼š
        - å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•3æ¬¡
        - é‡è¯•é—´éš”ï¼š1ç§’ã€2ç§’ã€4ç§’ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
        - æ‰€æœ‰é‡è¯•å¤±è´¥åæ˜¾ç¤ºé”™è¯¯æ¨¡æ€æ¡†
      tags:
        - data-submission
      operationId: saveHcMark
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - mark
              properties:
                batchCode:
                  type: string
                  description: è¯„ä»·æ‰¹æ¬¡ï¼ˆå¯ä» Session è·å–ï¼Œå¯é€‰å‚æ•°ï¼‰
                  example: "375186"
                examNo:
                  type: string
                  description: è€ƒç”Ÿå·ï¼ˆå¯ä» Session è·å–ï¼Œå¯é€‰å‚æ•°ï¼‰
                  example: "xxx"
                mark:
                  type: string
                  description: |
                    âš ï¸ æ³¨æ„ï¼šè¿™æ˜¯ JSON å­—ç¬¦ä¸²ï¼ˆå¯¹è±¡ï¼Œéæ•°ç»„ï¼‰ã€‚
                    åŒ…å«å•ä¸ªé¡µé¢çš„æ“ä½œè®°å½•ã€ç­”æ¡ˆåˆ—è¡¨ã€æ—¶é—´æˆ³ç­‰ã€‚

                    **MarkObject ç»“æ„**ï¼š
                    - pageNumber: string (å¦‚ "3.5")
                    - pageDesc: string (é¡µé¢æè¿°)
                    - beginTime: string (ISO 8601æ ¼å¼)
                    - endTime: string (ISO 8601æ ¼å¼)
                    - answerList: array<{key, value}>
                    - imgList: array<{imgUrl}>
                    - operationList: array<{code, targetElement, eventType, time, value?}>
                  example: |
                    {
                      "pageNumber": "9",
                      "pageDesc": "ç¬¬1æ¬¡èœ‚èœœé»åº¦å®éªŒ",
                      "operationList": [
                        {
                          "timestamp": 1697012340000,
                          "action": "select_water_content",
                          "target": "water_content_selector",
                          "value": 20
                        },
                        {
                          "timestamp": 1697012342000,
                          "action": "select_temperature",
                          "target": "temperature_selector",
                          "value": 25
                        },
                        {
                          "timestamp": 1697012350000,
                          "action": "click_start_animation",
                          "target": "start_button",
                          "value": null
                        },
                        {
                          "timestamp": 1697012358700,
                          "action": "animation_complete",
                          "target": "ball_drop_animation",
                          "value": 8.7
                        }
                      ],
                      "answerList": [
                        {
                          "questionId": "trial_1_water_content",
                          "answer": 20,
                          "answerTime": 1697012340000
                        },
                        {
                          "questionId": "trial_1_temperature",
                          "answer": 25,
                          "answerTime": 1697012342000
                        },
                        {
                          "questionId": "trial_1_fall_time",
                          "answer": 8.7,
                          "answerTime": 1697012358700
                        }
                      ],
                      "beginTime": 1697012330000,
                      "endTime": 1697012360000,
                      "imgList": []
                    }
                file:
                  type: string
                  format: binary
                  description: |
                    æ–‡ä»¶ä¸Šä¼ å­—æ®µï¼ˆæœ¬æ¨¡å—ä¸ä½¿ç”¨ï¼‰ã€‚
                    ä¿ç•™ä»¥ä¿æŒä¸å¹³å°å…¶ä»–æ¨¡å—çš„æ¥å£å…¼å®¹æ€§ã€‚
                  nullable: true
            encoding:
              jsonStr:
                contentType: application/json
              file:
                contentType: image/png, image/jpeg
      responses:
        '200':
          description: æ•°æ®æäº¤æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  summary: æäº¤æˆåŠŸç¤ºä¾‹
                  value:
                    code: 200
                    msg: "æˆåŠŸ"
                    obj: true
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                invalid_json:
                  summary: JSONæ ¼å¼é”™è¯¯
                  value:
                    code: 400
                    msg: "JSONæ ¼å¼é”™è¯¯ï¼šjsonStrå‚æ•°æ— æ³•è§£æ"
                    obj: false
                missing_required_field:
                  summary: ç¼ºå°‘å¿…å¡«å­—æ®µ
                  value:
                    code: 400
                    msg: "ç¼ºå°‘å¿…å¡«å­—æ®µï¼špageNumber"
                    obj: false
        '401':
          description: ä¼šè¯å·²å¤±æ•ˆï¼ˆå¤šè®¾å¤‡ç™»å½•æ£€æµ‹ï¼‰
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                session_expired:
                  summary: ä¼šè¯è¢«è¸¢å‡º
                  value:
                    code: 401
                    msg: "æ‚¨çš„è´¦å·å·²åœ¨å…¶ä»–è®¾å¤‡ç™»å½•ï¼Œå½“å‰ä¼šè¯å·²å¤±æ•ˆ"
                    obj: false
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                server_error:
                  summary: æœåŠ¡å™¨é”™è¯¯
                  value:
                    code: 500
                    msg: "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•"
                    obj: false
      security:
        - sessionAuth: []

  /stu/checkSession:
    get:
      summary: æ£€æŸ¥ä¼šè¯æœ‰æ•ˆæ€§ï¼ˆå¿ƒè·³æ£€æµ‹ï¼‰ - âŒ **ä¸éœ€è¦æ–°å¢**
      description: |
        âœ… **åç«¯å·²ç¡®è®¤**ï¼šæ— éœ€æ–°å¢æ­¤æ¥å£ï¼Œåç«¯å·²é€šè¿‡æ‹¦æˆªå™¨å®ç° session å¤±æ•ˆæ£€æµ‹ã€‚

        **åç«¯å®ç°æœºåˆ¶**ï¼š
        - æ‰€æœ‰ API è¯·æ±‚ç»è¿‡ç»Ÿä¸€æ‹¦æˆªå™¨æ£€æŸ¥ session æœ‰æ•ˆæ€§
        - Session å¤±æ•ˆæ—¶ï¼Œä»»ä½• API è¯·æ±‚è‡ªåŠ¨è¿”å› `code === 401`
        - å‰ç«¯æ— éœ€å•ç‹¬è°ƒç”¨å¿ƒè·³æ£€æµ‹æ¥å£

        **å‰ç«¯å®ç°ç­–ç•¥**ï¼š
        - åœ¨å…¨å±€ axios æ‹¦æˆªå™¨ä¸­æ•è· `response.data.code === 401`
        - 401 å“åº”æ—¶ï¼Œæ¸…ç©º Context çŠ¶æ€å¹¶è·³è½¬åˆ°ç™»å½•é¡µ
        - æ˜¾ç¤ºæç¤ºï¼š"æ‚¨çš„è´¦å·å·²åœ¨å…¶ä»–è®¾å¤‡ç™»å½•"

        **ä¸éœ€è¦çš„åŠŸèƒ½**ï¼š
        - âŒ ä¸éœ€è¦ 30ç§’è½®è¯¢å¿ƒè·³æ£€æµ‹
        - âŒ ä¸éœ€è¦ Page Visibility API ä¼˜åŒ–
        - âŒ ä¸éœ€è¦å•ç‹¬çš„ `/stu/checkSession` æ¥å£

        **æ³¨æ„**ï¼šä»¥ä¸‹æ¥å£å®šä¹‰ä»…ä¾›å‚è€ƒï¼Œå®é™…å¼€å‘ä¸­ä¸éœ€è¦å®ç°ã€‚
      deprecated: true
      tags:
        - session-management
      operationId: checkSession
      parameters:
        - name: sessionId
          in: query
          required: true
          description: |
            å®¢æˆ·ç«¯ç”Ÿæˆçš„ä¼šè¯å”¯ä¸€æ ‡è¯†ï¼ˆUUID v4ï¼‰ã€‚
            åœ¨å­¦ç”Ÿç™»å½•åç”Ÿæˆï¼Œå­˜å‚¨åœ¨Contextä¸­ã€‚
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
        - name: studentCode
          in: query
          required: true
          description: å­¦ç”Ÿä»£ç ï¼ˆç”¨äºæœåŠ¡ç«¯æŸ¥æ‰¾æ´»è·ƒä¼šè¯ï¼‰
          schema:
            type: string
            example: "STU001"
      responses:
        '200':
          description: ä¼šè¯æœ‰æ•ˆ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                valid_session:
                  summary: ä¼šè¯æ­£å¸¸
                  value:
                    code: 200
                    msg: "ä¼šè¯æœ‰æ•ˆ"
                    obj: true
        '401':
          description: ä¼šè¯å·²å¤±æ•ˆï¼ˆå·²åœ¨å…¶ä»–è®¾å¤‡ç™»å½•ï¼‰
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                session_kicked:
                  summary: ä¼šè¯è¢«è¸¢å‡º
                  value:
                    code: 401
                    msg: "æ‚¨çš„è´¦å·å·²åœ¨å…¶ä»–è®¾å¤‡ç™»å½•ï¼Œå½“å‰ä¼šè¯å·²å¤±æ•ˆ"
                    obj: false
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                server_error:
                  summary: æœåŠ¡å™¨é”™è¯¯
                  value:
                    code: 500
                    msg: "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"
                    obj: false
      security:
        - sessionAuth: []

components:
  schemas:
    ApiResponse:
      type: object
      description: å¹³å°ç»Ÿä¸€çš„APIå“åº”æ ¼å¼
      required:
        - code
        - msg
        - obj
      properties:
        code:
          type: integer
          description: |
            å“åº”çŠ¶æ€ç ï¼š
            - 200: æˆåŠŸ
            - 400: è¯·æ±‚å‚æ•°é”™è¯¯
            - 401: ä¼šè¯å¤±æ•ˆ
            - 500: æœåŠ¡å™¨é”™è¯¯
          example: 200
        msg:
          type: string
          description: å“åº”æ¶ˆæ¯ï¼ˆç”¨äºé”™è¯¯æç¤ºï¼‰
          example: "æˆåŠŸ"
        obj:
          description: |
            å“åº”æ•°æ®è½½è·ã€‚
            - Boolean: è¡¨ç¤ºæ“ä½œæ˜¯å¦æˆåŠŸï¼ˆsaveHcMark, checkSessionï¼‰
            - Object: åŒ…å«å…·ä½“ä¸šåŠ¡æ•°æ®ï¼ˆå…¶ä»–æ¥å£ï¼‰
          oneOf:
            - type: boolean
            - type: object
          example: true

    MarkObject:
      type: object
      description: |
        é¡µé¢æ•°æ®æ ‡è®°å¯¹è±¡ï¼Œå®šä¹‰å­¦ç”Ÿåœ¨å•ä¸ªé¡µé¢çš„å®Œæ•´æ“ä½œå’Œç­”æ¡ˆè®°å½•ã€‚
        å‚è€ƒ data-model.md ä¸­çš„ MarkObject å®šä¹‰ã€‚
      required:
        - pageNumber
        - pageDesc
        - operationList
        - answerList
        - beginTime
        - endTime
      properties:
        pageNumber:
          type: string
          description: |
            é¡µç å­—ç¬¦ä¸²ã€‚
            å¯èƒ½çš„å€¼ï¼š"0.1", "0.2", "1"-"21"
          example: "9"
        pageDesc:
          type: string
          description: é¡µé¢æè¿°ï¼ˆç”¨äºåç«¯æ•°æ®åˆ†æï¼‰
          example: "ç¬¬1æ¬¡èœ‚èœœé»åº¦å®éªŒ"
        operationList:
          type: array
          description: ç”¨æˆ·æ“ä½œåºåˆ—ï¼ˆæŒ‰æ—¶é—´æˆ³å‡åºæ’åˆ—ï¼‰
          items:
            $ref: '#/components/schemas/Operation'
        answerList:
          type: array
          description: ç­”æ¡ˆåˆ—è¡¨ï¼ˆé¡µé¢ä¸­æ‰€æœ‰å¯å›ç­”é—®é¢˜çš„ç­”æ¡ˆï¼‰
          items:
            $ref: '#/components/schemas/Answer'
        beginTime:
          type: integer
          format: int64
          description: é¡µé¢è¿›å…¥æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
          example: 1697012330000
        endTime:
          type: integer
          format: int64
          description: é¡µé¢ç¦»å¼€æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
          example: 1697012360000
        imgList:
          type: array
          description: |
            å›¾ç‰‡é™„ä»¶åˆ—è¡¨ï¼ˆæœ¬æ¨¡å—ä¸ä½¿ç”¨ï¼‰ã€‚
            å§‹ç»ˆä¸ºç©ºæ•°ç»„ï¼Œä¿ç•™ä»¥ä¿æŒæ¥å£å…¼å®¹æ€§ã€‚
          items:
            $ref: '#/components/schemas/Image'
          default: []

    Operation:
      type: object
      description: å•ä¸ªç”¨æˆ·æ“ä½œè®°å½•
      required:
        - timestamp
        - action
      properties:
        timestamp:
          type: integer
          format: int64
          description: æ“ä½œå‘ç”Ÿæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
          example: 1697012340000
        action:
          type: string
          description: |
            æ“ä½œç±»å‹ã€‚å¸¸è§å€¼ï¼š
            - select_water_content: é€‰æ‹©å«æ°´é‡
            - select_temperature: é€‰æ‹©æ¸©åº¦
            - click_start_animation: å¼€å§‹åŠ¨ç”»
            - animation_complete: åŠ¨ç”»å®Œæˆ
            - input_text: è¾“å…¥æ–‡æœ¬
            - select_option: é€‰æ‹©é€‰é¡¹ï¼ˆé—®å·ï¼‰
            - click_next: ç‚¹å‡»ä¸‹ä¸€é¡µ
          example: "select_water_content"
        target:
          type: string
          description: æ“ä½œç›®æ ‡å…ƒç´ æ ‡è¯†ï¼ˆå¯é€‰ï¼‰
          example: "water_content_selector"
          nullable: true
        value:
          description: æ“ä½œå€¼ï¼ˆç±»å‹æ ¹æ®actionåŠ¨æ€ï¼‰
          nullable: true
          oneOf:
            - type: string
            - type: number
            - type: boolean
          example: 20

    Answer:
      type: object
      description: å•ä¸ªé—®é¢˜çš„ç­”æ¡ˆè®°å½•
      required:
        - questionId
        - answer
      properties:
        questionId:
          type: string
          description: |
            é—®é¢˜å”¯ä¸€æ ‡è¯†ã€‚æ ¼å¼ç¤ºä¾‹ï¼š
            - trial_1_water_content: ç¬¬1æ¬¡è¯•éªŒçš„å«æ°´é‡
            - text_question_1: ç¬¬1ä¸ªå¼€æ”¾æ€§é—®é¢˜
            - questionnaire_q1: é—®å·ç¬¬1é¢˜
          example: "trial_1_water_content"
        answer:
          description: |
            ç­”æ¡ˆå†…å®¹ï¼ˆç±»å‹æ ¹æ®é—®é¢˜åŠ¨æ€ï¼‰ï¼š
            - æ•°å­—: å«æ°´é‡ã€æ¸©åº¦ã€ä¸‹è½æ—¶é—´
            - å­—ç¬¦ä¸²: æ–‡æœ¬å›ç­”ã€é€‰é¡¹ï¼ˆA/B/C/D/Eï¼‰
            - æ•°ç»„: å¤šé€‰é¢˜ç­”æ¡ˆï¼ˆæœ¬æ¨¡å—æœªä½¿ç”¨ï¼‰
          oneOf:
            - type: string
            - type: number
            - type: array
              items:
                type: string
          example: 20
        answerTime:
          type: integer
          format: int64
          description: å›ç­”æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼Œå¯ä¸ºnullè¡¨ç¤ºæœªå›ç­”ï¼‰
          example: 1697012340000
          nullable: true

    Image:
      type: object
      description: å›¾ç‰‡é™„ä»¶å¯¹è±¡ï¼ˆæœ¬æ¨¡å—ä¸ä½¿ç”¨ï¼‰
      required:
        - imageKey
        - imageUrl
      properties:
        imageKey:
          type: string
          description: å›¾ç‰‡å”¯ä¸€æ ‡è¯†
          example: "screenshot_001"
        imageUrl:
          type: string
          format: uri
          description: å›¾ç‰‡è®¿é—®URL
          example: "https://cdn.example.com/images/abc123.png"

  securitySchemes:
    sessionAuth:
      type: apiKey
      in: header
      name: Authorization
      description: |
        ä¼šè¯è®¤è¯ä»¤ç‰Œï¼ˆå¦‚æœå¹³å°ä½¿ç”¨JWTæˆ–Bearer Tokenï¼‰ã€‚
        å…·ä½“å®ç°å–å†³äºå¹³å°çš„è®¤è¯æœºåˆ¶ã€‚

        **æ³¨æ„**ï¼šæœ¬å¥‘çº¦å‡è®¾å¹³å°å·²æœ‰ç»Ÿä¸€çš„è®¤è¯æœºåˆ¶ï¼Œ
        æ¨¡å—æ— éœ€é¢å¤–å¤„ç†è®¤è¯é€»è¾‘ã€‚

# ============================================================================
# æ•°æ®ç¤ºä¾‹ï¼šä¸åŒé¡µé¢ç±»å‹çš„MarkObject
# ============================================================================

x-examples:
  experiment-trial-page:
    summary: å®éªŒè¯•éªŒé¡µé¢ï¼ˆç¬¬9é¡µï¼‰
    description: |
      å­¦ç”Ÿå®Œæˆç¬¬1æ¬¡èœ‚èœœé»åº¦å®éªŒï¼š
      1. é€‰æ‹©å«æ°´é‡20%
      2. é€‰æ‹©æ¸©åº¦25Â°C
      3. ç‚¹å‡»å¼€å§‹æŒ‰é’®ï¼Œè§‚å¯Ÿå°çƒä¸‹è½
      4. ç³»ç»Ÿè®°å½•ä¸‹è½æ—¶é—´8.7ç§’
    value:
      pageNumber: "9"
      pageDesc: "ç¬¬1æ¬¡èœ‚èœœé»åº¦å®éªŒ"
      operationList:
        - timestamp: 1697012340000
          action: "select_water_content"
          target: "water_content_selector"
          value: 20
        - timestamp: 1697012342000
          action: "select_temperature"
          target: "temperature_selector"
          value: 25
        - timestamp: 1697012350000
          action: "click_start_animation"
          target: "start_button"
          value: null
        - timestamp: 1697012358700
          action: "animation_complete"
          target: "ball_drop_animation"
          value: 8.7
        - timestamp: 1697012360000
          action: "click_next"
          target: "next_button"
          value: null
      answerList:
        - questionId: "trial_1_water_content"
          answer: 20
          answerTime: 1697012340000
        - questionId: "trial_1_temperature"
          answer: 25
          answerTime: 1697012342000
        - questionId: "trial_1_fall_time"
          answer: 8.7
          answerTime: 1697012358700
      beginTime: 1697012330000
      endTime: 1697012360000
      imgList: []

  chart-page:
    summary: å›¾è¡¨ç»˜åˆ¶é¡µé¢ï¼ˆç¬¬12é¡µï¼‰
    description: |
      å­¦ç”ŸåŸºäº3æ¬¡å®éªŒç»“æœç»˜åˆ¶æŠ˜çº¿å›¾ï¼š
      - æ·»åŠ 3ä¸ªæ•°æ®ç‚¹
      - æŸ¥çœ‹Rechartsæ¸²æŸ“çš„å›¾è¡¨
    value:
      pageNumber: "12"
      pageDesc: "ç»˜åˆ¶å«æ°´é‡ä¸ä¸‹è½æ—¶é—´å…³ç³»å›¾"
      operationList:
        - timestamp: 1697012400000
          action: "add_chart_point"
          target: "chart_data_input"
          value: { waterContent: 20, fallTime: 8.7 }
        - timestamp: 1697012410000
          action: "add_chart_point"
          target: "chart_data_input"
          value: { waterContent: 25, fallTime: 6.5 }
        - timestamp: 1697012420000
          action: "add_chart_point"
          target: "chart_data_input"
          value: { waterContent: 15, fallTime: 11.2 }
        - timestamp: 1697012430000
          action: "view_chart"
          target: "line_chart"
          value: null
        - timestamp: 1697012440000
          action: "click_next"
          target: "next_button"
          value: null
      answerList:
        - questionId: "chart_data_points"
          answer:
            - { waterContent: 20, fallTime: 8.7, source: "trial", trialNumber: 1 }
            - { waterContent: 25, fallTime: 6.5, source: "trial", trialNumber: 2 }
            - { waterContent: 15, fallTime: 11.2, source: "trial", trialNumber: 3 }
          answerTime: 1697012420000
      beginTime: 1697012390000
      endTime: 1697012440000
      imgList: []

  text-response-page:
    summary: å¼€æ”¾æ€§é—®é¢˜é¡µé¢ï¼ˆç¬¬13é¡µï¼‰
    description: |
      å­¦ç”Ÿå›ç­”3ä¸ªå¼€æ”¾æ€§é—®é¢˜ï¼š
      1. æè¿°å«æ°´é‡ä¸ä¸‹è½æ—¶é—´çš„å…³ç³»
      2. è§£é‡ŠåŸå› 
      3. é¢„æµ‹æ¸©åº¦å˜åŒ–çš„å½±å“ï¼ˆæœªå›ç­”ï¼‰
    value:
      pageNumber: "13"
      pageDesc: "å¼€æ”¾æ€§é—®é¢˜å›ç­”"
      operationList:
        - timestamp: 1697012500000
          action: "focus_textarea"
          target: "question_1_input"
          value: null
        - timestamp: 1697012510000
          action: "input_text"
          target: "question_1_input"
          value: "å«æ°´é‡è¶Šé«˜ï¼Œèœ‚èœœé»åº¦è¶Šå°ï¼Œå°çƒä¸‹è½æ—¶é—´è¶ŠçŸ­ã€‚"
        - timestamp: 1697012520000
          action: "focus_textarea"
          target: "question_2_input"
          value: null
        - timestamp: 1697012540000
          action: "input_text"
          target: "question_2_input"
          value: "å«æ°´é‡å¢åŠ ä¼šé™ä½èœ‚èœœçš„é»åº¦ï¼Œå‡å°‘å¯¹å°çƒçš„é˜»åŠ›ã€‚"
        - timestamp: 1697012550000
          action: "click_next"
          target: "next_button"
          value: null
      answerList:
        - questionId: "text_question_1"
          answer: "å«æ°´é‡è¶Šé«˜ï¼Œèœ‚èœœé»åº¦è¶Šå°ï¼Œå°çƒä¸‹è½æ—¶é—´è¶ŠçŸ­ã€‚"
          answerTime: 1697012510000
        - questionId: "text_question_2"
          answer: "å«æ°´é‡å¢åŠ ä¼šé™ä½èœ‚èœœçš„é»åº¦ï¼Œå‡å°‘å¯¹å°çƒçš„é˜»åŠ›ã€‚"
          answerTime: 1697012540000
        - questionId: "text_question_3"
          answer: ""
          answerTime: null
      beginTime: 1697012490000
      endTime: 1697012550000
      imgList: []

  questionnaire-page:
    summary: é—®å·è°ƒæŸ¥é¡µé¢ï¼ˆç¬¬14é¡µï¼‰
    description: |
      å­¦ç”Ÿå›ç­”é—®å·ç¬¬1é¡µçš„3ä¸ªå•é€‰é¢˜ï¼š
      - é—®é¢˜1é€‰æ‹©B
      - é—®é¢˜2é€‰æ‹©A
      - é—®é¢˜3é€‰æ‹©C
    value:
      pageNumber: "14"
      pageDesc: "é—®å·è°ƒæŸ¥ç¬¬1é¡µ"
      operationList:
        - timestamp: 1697012600000
          action: "select_option"
          target: "question_1"
          value: "B"
        - timestamp: 1697012610000
          action: "select_option"
          target: "question_2"
          value: "A"
        - timestamp: 1697012620000
          action: "select_option"
          target: "question_3"
          value: "C"
        - timestamp: 1697012630000
          action: "click_next"
          target: "next_button"
          value: null
      answerList:
        - questionId: "questionnaire_q1"
          answer: "B"
          answerTime: 1697012600000
        - questionId: "questionnaire_q2"
          answer: "A"
          answerTime: 1697012610000
        - questionId: "questionnaire_q3"
          answer: "C"
          answerTime: 1697012620000
      beginTime: 1697012590000
      endTime: 1697012630000
      imgList: []

  transition-page:
    summary: è¿‡æ¸¡é¡µé¢ï¼ˆç¬¬0.1é¡µ-æ³¨æ„äº‹é¡¹ï¼‰
    description: |
      å­¦ç”Ÿé˜…è¯»æ³¨æ„äº‹é¡¹é¡µé¢ï¼š
      - æ— äº¤äº’æ“ä½œ
      - æ— ç­”æ¡ˆè®°å½•
      - ä»…è®°å½•åœç•™æ—¶é—´
    value:
      pageNumber: "0.1"
      pageDesc: "æ³¨æ„äº‹é¡¹"
      operationList:
        - timestamp: 1697012100000
          action: "page_enter"
          target: null
          value: null
        - timestamp: 1697012150000
          action: "click_next"
          target: "next_button"
          value: null
      answerList: []
      beginTime: 1697012100000
      endTime: 1697012150000
      imgList: []

# ============================================================================
# é”™è¯¯å¤„ç†ç¤ºä¾‹
# ============================================================================

x-error-scenarios:
  invalid-json-format:
    description: |
      åœºæ™¯ï¼šå‰ç«¯æäº¤çš„jsonStrå‚æ•°ä¸æ˜¯æœ‰æ•ˆçš„JSONå­—ç¬¦ä¸²ã€‚
      åŸå› ï¼šåºåˆ—åŒ–é”™è¯¯æˆ–æ•°æ®æŸåã€‚
    request:
      jsonStr: "{ invalid json }"
    response:
      code: 400
      msg: "JSONæ ¼å¼é”™è¯¯ï¼šUnexpected token i in JSON at position 2"
      obj: false
    frontend-action: |
      æ˜¾ç¤ºé”™è¯¯æ¨¡æ€æ¡†ï¼š"æ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•"

  missing-required-field:
    description: |
      åœºæ™¯ï¼šMarkObjectç¼ºå°‘å¿…å¡«å­—æ®µï¼ˆå¦‚pageNumberï¼‰ã€‚
      åŸå› ï¼šå‰ç«¯æ•°æ®æ„é€ é”™è¯¯ã€‚
    request:
      jsonStr: |
        {
          "pageDesc": "ç¬¬1æ¬¡å®éªŒ",
          "operationList": [],
          "answerList": []
        }
    response:
      code: 400
      msg: "ç¼ºå°‘å¿…å¡«å­—æ®µï¼špageNumber"
      obj: false
    frontend-action: |
      å¼€å‘é˜¶æ®µï¼šæ§åˆ¶å°æŠ¥é”™å¹¶ä¸­æ–­æäº¤
      ç”Ÿäº§é˜¶æ®µï¼šè®°å½•åˆ°Sentryï¼Œæ˜¾ç¤ºé€šç”¨é”™è¯¯æç¤º

  session-expired:
    description: |
      åœºæ™¯ï¼šå­¦ç”Ÿåœ¨è®¾å¤‡Aç™»å½•åï¼Œåˆåœ¨è®¾å¤‡Bç™»å½•ï¼Œè®¾å¤‡Açš„ä¼šè¯è¢«è¸¢å‡ºã€‚
      è§¦å‘æ—¶æœºï¼šè®¾å¤‡Aè°ƒç”¨saveHcMarkæˆ–checkSessionæ¥å£ã€‚
    request:
      jsonStr: "{ valid mark object }"
    response:
      code: 401
      msg: "æ‚¨çš„è´¦å·å·²åœ¨å…¶ä»–è®¾å¤‡ç™»å½•ï¼Œå½“å‰ä¼šè¯å·²å¤±æ•ˆ"
      obj: false
    frontend-action: |
      1. åœæ­¢å¿ƒè·³æ£€æµ‹å®šæ—¶å™¨
      2. æ˜¾ç¤ºæ¨¡æ€æ¡†ï¼š"æ‚¨çš„è´¦å·å·²åœ¨å…¶ä»–è®¾å¤‡ç™»å½•"ï¼ˆ5ç§’åè‡ªåŠ¨å…³é—­ï¼‰
      3. æ¸…ç©ºContextçŠ¶æ€
      4. è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ

  network-timeout:
    description: |
      åœºæ™¯ï¼šç½‘ç»œä¸ç¨³å®šï¼Œè¯·æ±‚è¶…æ—¶ï¼ˆè¶…è¿‡10ç§’æ— å“åº”ï¼‰ã€‚
    request:
      jsonStr: "{ valid mark object }"
    response: null (timeout)
    frontend-action: |
      1. ç¬¬1æ¬¡é‡è¯•ï¼ˆ1ç§’åï¼‰
      2. ç¬¬2æ¬¡é‡è¯•ï¼ˆ2ç§’åï¼‰
      3. ç¬¬3æ¬¡é‡è¯•ï¼ˆ4ç§’åï¼‰
      4. æ‰€æœ‰é‡è¯•å¤±è´¥åæ˜¾ç¤ºé”™è¯¯æ¨¡æ€æ¡†ï¼š
         "ç½‘ç»œè¿æ¥ä¸ç¨³å®šï¼Œæ•°æ®æäº¤å¤±è´¥ã€‚è¯·æ£€æŸ¥ç½‘ç»œåç‚¹å‡»é‡è¯•ã€‚"
         [é‡è¯•æŒ‰é’®] [å–æ¶ˆæŒ‰é’®]

  server-error:
    description: |
      åœºæ™¯ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼ˆæ•°æ®åº“è¿æ¥å¤±è´¥ã€å¼‚å¸¸æŠ›å‡ºç­‰ï¼‰ã€‚
    request:
      jsonStr: "{ valid mark object }"
    response:
      code: 500
      msg: "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•"
      obj: false
    frontend-action: |
      æ‰§è¡Œé‡è¯•ç­–ç•¥ï¼ˆåŒnetwork-timeoutï¼‰

# ============================================================================
# MockæœåŠ¡å™¨å®ç°æŒ‡å—
# ============================================================================

x-mock-server-guide:
  description: |
    æœ¬åœ°å¼€å‘æ—¶ï¼Œå¯ä½¿ç”¨MockæœåŠ¡å™¨æ¨¡æ‹Ÿåç«¯APIå“åº”ã€‚

    **æ¨èå·¥å…·**ï¼š
    - json-server: è½»é‡çº§REST APIæ¨¡æ‹Ÿ
    - msw (Mock Service Worker): æµè§ˆå™¨çº§æ‹¦æˆª
    - Viteæ’ä»¶: vite-plugin-mock

  json-server-setup:
    install: "npm install -g json-server"
    config-file: "mock-db.json"
    run-command: "json-server --watch mock-db.json --port 3000"

  msw-setup:
    install: "npm install msw --save-dev"
    init-command: "npx msw init public/ --save"
    handler-file: "src/mocks/handlers.js"
    example-handler: |
      import { rest } from 'msw';

      export const handlers = [
        // æ¨¡æ‹ŸsaveHcMarkæ¥å£
        rest.post('/stu/saveHcMark', async (req, res, ctx) => {
          const formData = await req.formData();
          const jsonStr = formData.get('jsonStr');
          const markObject = JSON.parse(jsonStr);

          console.log('ğŸ“ æ¥æ”¶åˆ°MarkObject:', markObject);

          // æ¨¡æ‹Ÿ10%çš„å¤±è´¥ç‡ï¼ˆç”¨äºæµ‹è¯•é‡è¯•é€»è¾‘ï¼‰
          if (Math.random() < 0.1) {
            return res(
              ctx.delay(500),
              ctx.status(500),
              ctx.json({ code: 500, msg: 'æœåŠ¡å™¨é”™è¯¯', obj: false })
            );
          }

          // æˆåŠŸå“åº”
          return res(
            ctx.delay(300), // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
            ctx.status(200),
            ctx.json({ code: 200, msg: 'æˆåŠŸ', obj: true })
          );
        }),

        // æ¨¡æ‹ŸcheckSessionæ¥å£
        rest.get('/stu/checkSession', (req, res, ctx) => {
          const sessionId = req.url.searchParams.get('sessionId');

          // æ¨¡æ‹Ÿ5%çš„ä¼šè¯å¤±æ•ˆç‡ï¼ˆæµ‹è¯•å¤šè®¾å¤‡ç™»å½•æ£€æµ‹ï¼‰
          if (Math.random() < 0.05) {
            return res(
              ctx.delay(200),
              ctx.status(401),
              ctx.json({
                code: 401,
                msg: 'æ‚¨çš„è´¦å·å·²åœ¨å…¶ä»–è®¾å¤‡ç™»å½•ï¼Œå½“å‰ä¼šè¯å·²å¤±æ•ˆ',
                obj: false
              })
            );
          }

          // æ­£å¸¸ä¼šè¯
          return res(
            ctx.delay(200),
            ctx.status(200),
            ctx.json({ code: 200, msg: 'ä¼šè¯æœ‰æ•ˆ', obj: true })
          );
        })
      ];

  vite-plugin-mock-setup:
    install: "npm install vite-plugin-mock -D"
    vite-config: |
      import { defineConfig } from 'vite';
      import { viteMockServe } from 'vite-plugin-mock';

      export default defineConfig({
        plugins: [
          viteMockServe({
            mockPath: 'mock',
            enable: true,
          }),
        ],
      });
    mock-file: "mock/api.js"
    example-mock: |
      export default [
        {
          url: '/stu/saveHcMark',
          method: 'post',
          timeout: 300,
          response: ({ body }) => {
            const jsonStr = body.get('jsonStr');
            const markObject = JSON.parse(jsonStr);
            console.log('ğŸ“ Mock API æ¥æ”¶:', markObject);
            return {
              code: 200,
              msg: 'æˆåŠŸ',
              obj: true,
            };
          },
        },
        {
          url: '/stu/checkSession',
          method: 'get',
          timeout: 200,
          response: ({ query }) => {
            return {
              code: 200,
              msg: 'ä¼šè¯æœ‰æ•ˆ',
              obj: true,
            };
          },
        },
      ];

# ============================================================================
# é›†æˆæµ‹è¯•å»ºè®®
# ============================================================================

x-integration-testing:
  description: |
    é’ˆå¯¹APIå¥‘çº¦çš„é›†æˆæµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿å‰åç«¯åè®®ä¸€è‡´æ€§ã€‚

  test-cases:
    - name: "æ­£å¸¸æäº¤å®éªŒè¯•éªŒæ•°æ®"
      request:
        endpoint: POST /stu/saveHcMark
        jsonStr: { pageNumber: "9", ... }
      expected:
        status: 200
        response.code: 200
        response.obj: true

    - name: "æäº¤ç©ºoperationListï¼ˆè¾¹ç•Œæƒ…å†µï¼‰"
      request:
        endpoint: POST /stu/saveHcMark
        jsonStr: { pageNumber: "9", operationList: [], ... }
      expected:
        status: 200
        response.code: 200
        note: "operationListå¯ä¸ºç©ºï¼Œä¸å½±å“æäº¤"

    - name: "æäº¤è¶…å¤§JSONï¼ˆå‹åŠ›æµ‹è¯•ï¼‰"
      request:
        endpoint: POST /stu/saveHcMark
        jsonStr: { pageNumber: "13", operationList: [1000ä¸ªæ“ä½œ], ... }
      expected:
        status: 200 or 413 (Payload Too Large)
        note: "éªŒè¯æœåŠ¡å™¨payloadé™åˆ¶"

    - name: "ä¼šè¯è¿‡æœŸåæäº¤æ•°æ®"
      setup: "åœ¨è®¾å¤‡Aç™»å½•ï¼Œç„¶ååœ¨è®¾å¤‡Bç™»å½•ï¼ˆè¸¢å‡ºè®¾å¤‡Aï¼‰"
      request:
        endpoint: POST /stu/saveHcMark
        jsonStr: { valid mark object }
      expected:
        status: 401
        response.code: 401
        response.msg: "æ‚¨çš„è´¦å·å·²åœ¨å…¶ä»–è®¾å¤‡ç™»å½•ï¼Œå½“å‰ä¼šè¯å·²å¤±æ•ˆ"

    - name: "å¿ƒè·³æ£€æµ‹æ­£å¸¸æµç¨‹"
      request:
        endpoint: GET /stu/checkSession?sessionId=xxx&studentCode=STU001
      expected:
        status: 200
        response.code: 200
        response.obj: true

    - name: "å¿ƒè·³æ£€æµ‹ä¼šè¯å¤±æ•ˆ"
      setup: "åœ¨è®¾å¤‡Aå‘èµ·å¿ƒè·³ï¼ŒåŒæ—¶è®¾å¤‡Bå·²ç™»å½•"
      request:
        endpoint: GET /stu/checkSession?sessionId=xxx&studentCode=STU001
      expected:
        status: 401
        response.code: 401

# ============================================================================
# ç‰ˆæœ¬å†å²
# ============================================================================

x-changelog:
  - version: 1.0.0
    date: 2025-10-14
    changes:
      - åˆå§‹ç‰ˆæœ¬
      - å®šä¹‰saveHcMarkå’ŒcheckSessionæ¥å£
      - æ·»åŠ MarkObjectã€Operationã€Answer schema
      - æä¾›4ç§é¡µé¢ç±»å‹çš„æ•°æ®ç¤ºä¾‹
      - å®šä¹‰é”™è¯¯å¤„ç†åœºæ™¯
      - æ·»åŠ MockæœåŠ¡å™¨å®ç°æŒ‡å—
      - æ·»åŠ é›†æˆæµ‹è¯•å»ºè®®

# ============================================================================
# ä¸‹ä¸€æ­¥è®¡åˆ’
# ============================================================================

x-next-steps:
  - task: "ç”Ÿæˆquickstart.md"
    description: "å¼€å‘è€…ä¸Šæ‰‹æŒ‡å—ï¼ŒåŒ…æ‹¬ç¯å¢ƒæ­å»ºã€Mockæ¨¡å¼é…ç½®ã€æ¨¡å—æ³¨å†Œæ­¥éª¤"
    priority: P0

  - task: "æ›´æ–°Agent Context"
    description: "è¿è¡Œ update-agent-context.ps1 æ·»åŠ Rechartsåˆ°Claude Codeä¸Šä¸‹æ–‡"
    priority: P1

  - task: "æ‰§è¡ŒConstitution Check"
    description: "éªŒè¯Phase 1è®¾è®¡artifactsæ˜¯å¦ç¬¦åˆ7å¤§æ ¸å¿ƒåŸåˆ™"
    priority: P1

  - task: "ç”Ÿæˆtasks.md"
    description: "Phase 2ä»»åŠ¡åˆ†è§£ï¼Œä¸ºå®ç°é˜¶æ®µå‡†å¤‡"
    priority: P2
