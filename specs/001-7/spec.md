# Feature Specification: 7年级追踪测评 - 蜂蜜黏度探究交互实验模块

**Feature Branch**: `001-7`
**Created**: 2025-01-14
**Status**: Draft
**Input**: User description: "请参考目前项目中7年级测评的页面布局方式,根据文档 @docs/7年级追踪测评需求描述.md 中的每个页面的详细描述,构建一个新的人机交互测评模块。这个模块是现在7年级模块的后续延展模块,整体样式、布局都按照现在的7年级的模块来构建,只是中间的内部部分,按照需求描述文档进行替换,按照需求描述文档的交互进行构建。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 学生完成科学探究实验流程 (Priority: P1)

学生登录系统后,进入"探究蜂蜜黏度"交互式实验,按照科学探究的完整流程(发现问题-提出猜想-收集资料-设计实验-进行实验-分析数据-得出结论),通过13个页面完成探究任务,包括阅读注意事项、了解情景背景、提出科学问题、收集资料并猜想、设计和评估实验方案、进行模拟实验、分析数据并得出结论。

**Why this priority**: 这是整个测评模块的核心功能,构成了完整的科学探究学习体验。没有这个流程,模块将无法实现其教育目标。

**Independent Test**: 学生可以从登录开始,依次完成所有13页的探究实验内容,最终在第13页看到"任务完成"页面,并能点击"继续"按钮进入问卷部分。测试通过标准是所有页面的交互元素(文本输入、选择题、实验操作)都能正常响应,且"下一页"按钮的启用逻辑符合各页面的完成条件。

**Acceptance Scenarios**:

1. **Given** 学生已登录系统且被分配到7年级追踪测评任务, **When** 学生进入测评模块, **Then** 系统显示第0.1页"注意事项"页面,包含倒计时40秒和复选框
2. **Given** 学生在注意事项页勾选"我已阅读上述注意事项"或倒计时结束, **When** 学生点击"下一页", **Then** 系统跳转到第1页"蜂蜜的奥秘"情景引入页
3. **Given** 学生在第2页"提出问题"页面, **When** 学生在文本框中输入科学问题并点击"下一页", **Then** 系统保存输入内容并跳转到第3页"资料阅读"
4. **Given** 学生在第3页点击平板上的5个资料按钮, **When** 弹出信息窗口并阅读后关闭, **Then** 学生可以在右侧选择至少一个影响因素复选框后启用"下一页"按钮
5. **Given** 学生在第5页"方案设计"页面, **When** 学生至少填写一个实验方案文本框, **Then** "下一页"按钮变为可点击状态
6. **Given** 学生在第8页"模拟实验"页面, **When** 学生选择量筒、调节温度并点击"计时开始", **Then** 系统播放小球下落动画并显示计时结果
7. **Given** 学生在第9-11页回答实验相关问题, **When** 学生选择单选答案, **Then** 系统记录答案并允许进入下一页
8. **Given** 学生在第12页"方案选择"页面, **When** 学生通过表格选择温度和含水量组合,填写理由后点击"完成实验,进入问卷", **Then** 系统保存所有实验数据并跳转到问卷说明页

---

### User Story 2 - 学生完成问卷调查 (Priority: P2)

学生完成探究实验后,进入问卷调查部分,通过8页问卷(第14-21页)回答关于好奇心、创造力、想象力、科学探究自信心、环境支持和科学活动参与频率等方面的问题,最后在第22页看到"问卷已完成"提示并返回登录页面。

**Why this priority**: 问卷调查是收集学生学习行为和态度数据的重要环节,为教育研究提供量化数据支持。虽然重要,但相对于核心探究实验流程,问卷部分可以在实验功能稳定后独立实施。

**Independent Test**: 学生完成第13页实验任务后点击"继续",进入第0.2页"问卷说明"页面,然后依次完成8页问卷题目(每页题目数量从5到11题不等),所有题目必须全部作答后才能点击"下一页"或"提交问卷"按钮。测试通过标准是所有单选题能正确记录答案,且提交后显示第22页"问卷已完成"页面,点击"返回登录页面"按钮能成功退出模块。

**Acceptance Scenarios**:

1. **Given** 学生完成第13页实验任务, **When** 学生点击"继续"按钮, **Then** 系统显示第0.2页"调查问卷说明"页面,包含10分钟计时提示
2. **Given** 学生在问卷说明页, **When** 学生点击"开始作答", **Then** 系统跳转到第14页问卷第1部分(9个问题)
3. **Given** 学生在第14-20页任一问卷页面, **When** 学生未完成该页所有题目, **Then** "下一页"按钮保持灰色不可点击状态
4. **Given** 学生在第14-20页任一问卷页面, **When** 学生完成该页所有题目, **Then** "下一页"按钮变为可点击状态
5. **Given** 学生在第21页(问卷最后一页), **When** 学生完成所有3个努力程度评估题(1-10分量表), **Then** "提交问卷"按钮变为可点击状态
6. **Given** 学生点击"提交问卷"按钮, **When** 系统成功提交所有问卷数据, **Then** 系统显示第22页"问卷已完成"页面,包含绿色标题和感谢语
7. **Given** 学生在第22页, **When** 学生点击"返回登录页面"按钮, **Then** 系统退出测评模块并返回到登录界面

---

### User Story 3 - 学生进行交互式模拟实验 (Priority: P1)

学生在第8页进入模拟实验环境,通过可视化界面操作虚拟实验设备:选择不同含水量的量筒(15%, 17%, 19%, 21%),调节环境温度(25℃-45℃),观察小钢球在蜂蜜中的下落时间,并在第9-11页基于实验数据回答分析问题,最终在第12页根据折线图数据选择最佳的温度和含水量组合。

**Why this priority**: 模拟实验是本测评模块的技术核心,提供了传统纸笔测评无法实现的交互式学习体验。这个功能直接支持科学探究能力的评估,与User Story 1的实验流程紧密结合,必须在第一阶段实现。

**Independent Test**: 学生在第8页可以自由组合4个量筒和5个温度档位(共20种组合),点击"计时开始"后观察小球下落动画和计时结果,点击"重置"按钮可以重新选择参数进行实验。第8页的实验界面在第9-11页保持可用,学生可以边做实验边回答问题。测试通过标准是所有温度和含水量组合都能正确触发下落动画,计时结果符合物理规律(高温/高含水量→下落时间短),且第9-11页的答案选项与实验数据一致。

**Acceptance Scenarios**:

1. **Given** 学生进入第8页"模拟实验"页面, **When** 学生点击任意一个量筒图标, **Then** 该量筒呈现选中状态(视觉高亮)
2. **Given** 学生已选择量筒, **When** 学生通过温度控制器调节温度到指定档位(25℃/30℃/35℃/40℃/45℃), **Then** 温度数值显示更新
3. **Given** 学生已选择量筒和温度, **When** 学生点击"计时开始"按钮, **Then** 系统播放小钢球从量筒顶部下落的动画,计时器开始计时,小球到达底部后停止计时并显示结果(精确到0.1秒)
4. **Given** 实验正在进行中, **When** 学生点击"重置"按钮, **Then** 系统停止当前实验,清除计时结果,允许学生重新选择量筒和温度
5. **Given** 学生已进行多次实验并积累了数据, **When** 学生进入第9页并看到问题"在40℃条件下,含水量为多少时下落时间最短?", **Then** 学生可以根据之前的实验结果选择正确答案(21%)
6. **Given** 学生在第12页查看"温度、含水量与落球时间的关系"折线图, **When** 学生点击动态表格中的下拉菜单选择温度和含水量组合, **Then** 系统允许学生添加多个组合(通过"新增"按钮)或删除已选择的组合(通过"删除"按钮)
7. **Given** 学生在第12页完成方案选择并填写理由, **When** 学生点击"完成实验,进入问卷"按钮, **Then** 系统保存学生选择的温度/含水量组合及理由,并跳转到问卷说明页

---

### User Story 4 - 系统记录和提交学生操作数据 (Priority: P2)

系统在学生完成测评过程中,自动记录所有关键操作(页面访问时间、输入内容、选择答案、实验操作参数、问卷答案等),在学生点击"提交问卷"后,将所有数据按照MarkObject结构组织并提交到后端API(POST /stu/saveHcMark),确保数据完整性和可追溯性。

**Why this priority**: 数据记录功能是评估系统的基础设施,必须准确记录学生的所有交互行为,但可以在核心交互功能稳定后再集成数据提交逻辑。在开发阶段可以先使用本地存储或模拟提交。

**Independent Test**: 开发者可以在浏览器控制台查看logOperation()调用记录,验证每个页面的操作日志是否包含必要的信息(pageNumber, operationList, answerList, beginTime, endTime)。在第22页提交问卷后,检查网络请求中的FormData是否包含完整的JSON数据(覆盖所有13页实验和8页问卷的内容)。测试通过标准是后端成功接收数据(HTTP 200响应),且管理员可以在后台查看学生的完整操作轨迹。

**Acceptance Scenarios**:

1. **Given** 学生在任意页面进行操作(如输入文本、选择答案、点击按钮), **When** 操作完成, **Then** 系统调用logOperation()记录操作类型、时间戳和操作内容
2. **Given** 学生完成一个页面并点击"下一页", **When** 系统跳转到下一页, **Then** 系统保存当前页面的MarkObject数据,包括pageNumber, pageDesc, operationList, answerList, beginTime, endTime
3. **Given** 学生在第8-12页进行模拟实验, **When** 学生选择量筒、调节温度、开始计时, **Then** 系统记录每次实验的参数(量筒含水量、温度值)和结果(下落时间)到operationList
4. **Given** 学生在第14-21页完成问卷, **When** 学生选择单选答案, **Then** 系统记录每个问题的题号和选择的选项编号到answerList
5. **Given** 学生在第21页点击"提交问卷"按钮, **When** 系统准备提交数据, **Then** 系统将所有页面的MarkObject数据序列化为JSON字符串,并通过FormData封装后发送POST请求到/stu/saveHcMark
6. **Given** 后端成功接收并保存数据, **When** 返回HTTP 200响应, **Then** 系统显示第22页"问卷已完成"页面
7. **Given** 网络请求失败(超时或服务器错误), **When** 系统检测到提交失败, **Then** 系统显示错误提示,允许学生重新提交或联系教师

---

### Edge Cases

- **时间管理边界情况**:
  - 当学生在第0.1页等待40秒倒计时时关闭浏览器,重新登录后系统如何处理?(预期:重新开始倒计时)
  - 当探究任务的40分钟计时结束时,学生正在填写第8页的实验数据,系统是否允许完成当前页?(预期:自动保存当前页数据并强制跳转到问卷说明页)
  - 当问卷的10分钟计时结束时,学生尚未完成所有问卷题目,系统如何处理?(预期:自动提交已完成的题目,未完成的题目记录为空值)

- **输入验证边界情况**:
  - 当学生在第2页/第5页/第6页的文本输入框中输入超长文本(如10000字),系统是否限制字符数量?(预期:设置合理的字符上限,如500字,并显示剩余字符数提示)
  - 当学生在第12页的理由输入框中不填写任何内容直接点击"完成实验,进入问卷",系统是否允许?(预期:要求至少填写10个字符)

- **实验交互边界情况**:
  - 当学生在第8页连续点击"计时开始"按钮10次以上,系统是否会出现性能问题?(预期:限制每秒最多触发1次实验,防止重复点击)
  - 当学生在第8页进行实验时刷新浏览器,之前的实验数据是否保留?(预期:实验数据存储在会话级Context中,刷新后丢失,学生需要重新进行实验)

- **页面导航边界情况**:
  - 当学生在第10页时点击浏览器的后退按钮,系统是否允许返回第9页?(预期:根据模块架构的"线性导航"原则,禁用浏览器后退按钮,或显示警告提示)
  - 当学生在第15页问卷中途想要修改第2页的科学问题,系统是否允许?(预期:不允许,一旦进入下一页,上一页的答案即锁定)

- **数据提交边界情况**:
  - 当学生在网络不稳定的环境下点击"提交问卷",请求超时后系统是否重试?(预期:自动重试3次,每次间隔5秒,3次失败后显示错误提示并保留本地数据)
  - 当学生在第21页点击"提交问卷"后立即关闭浏览器,数据是否成功提交?(预期:使用同步请求或Beacon API确保数据发送完成)

- **用户会话边界情况**:
  - 当学生登录后长时间未操作(如超过60分钟),系统是否自动退出?(预期:根据后端Session过期时间,触发401错误后自动跳转到登录页)
  - 当学生在两台设备上同时登录同一账号并进入测评,系统如何处理数据冲突?(预期:禁止多设备同时登录,后登录的设备会自动踢掉先登录设备的会话,先登录的设备会收到"您的账号已在其他设备登录"提示并强制退出到登录页)

## Requirements *(mandatory)*

### Functional Requirements

**页面结构与导航要求**:

- **FR-001**: 系统MUST实现23个页面(第0.1页注意事项 + 第1-13页探究实验 + 第0.2页问卷说明 + 第14-21页问卷 + 第22页完成页),页面结构包含左侧页码导航栏(显示当前页码和总页数)和主内容区域
- **FR-001a**: 系统MUST使用独立的导航系统:人机交互部分(第1-13页)导航显示"第X页/共13页",问卷部分(第14-21页)导航显示"第X页/共8页"(X为当前页在本部分的序号,如第14页显示"第1页/共8页",第21页显示"第8页/共8页")
- **FR-001b**: 系统MUST在过渡页(第0.1页注意事项和第0.2页问卷说明)不显示页码导航栏,这两页作为两个测评部分的过渡界面
- **FR-002**: 系统MUST采用线性导航模式,用户只能通过点击"下一页"/"继续"/"开始作答"等按钮向前推进,不允许通过页码导航栏或浏览器后退按钮返回上一页
- **FR-003**: 系统MUST在每个页面底部提供唯一的前进按钮(根据页面语义命名为"下一页"/"继续"/"开始作答"/"完成实验,进入问卷"/"提交问卷"/"返回登录页面"),按钮初始状态为灰色不可点击,满足页面完成条件后变为可点击状态

**注意事项页(第0.1页)要求**:

- **FR-004**: 系统MUST在第0.1页显示4条注意事项文本,包括"作答时间共40分钟"、"请按顺序回答"、"不要提前点击下一页"、"遇到故障请举手"
- **FR-005**: 系统MUST在第0.1页提供一个复选框("我已阅读上述注意事项")和一个40秒倒计时器,两者并行显示
- **FR-006**: 系统MUST在用户勾选复选框OR倒计时结束时,启用"下一页"按钮(任一条件满足即可)
- **FR-007**: 系统MUST在倒计时结束后自动勾选复选框,并保持"下一页"按钮可点击状态

**探究实验页面(第1-13页)要求**:

- **FR-008**: 系统MUST在第1页显示情景引入文本(蜂蜜背景故事)和一张蜂蜜图片,无需额外交互即可点击"下一页"
- **FR-009**: 系统MUST在第2页显示小明和爸爸的对话气泡(左侧),以及科学问题输入区域(右侧,包含提示文字和多行文本框),用户输入任意内容后启用"下一页"按钮
- **FR-010**: 系统MUST在第3页显示平板电脑图形(左侧)和6个影响因素复选框(右侧),平板上包含5个可点击按钮("蜂蜜酿造流程"、"黏度原理揭秘"、"蜂蜜知识问答"、"蜂蜜储存说明"、"掺假蜂蜜探析")
- **FR-011**: 系统MUST在用户点击第3页平板上的任意按钮时,弹出模态窗口显示对应资料内容,窗口包含关闭按钮(点击或按Esc键关闭)
- **FR-012**: 系统MUST在用户选择第3页右侧至少1个复选框后,启用"下一页"按钮
- **FR-013**: 系统MUST在第4页显示假设陈述文本("环境温度和水分含量是影响蜂蜜黏度变化的关键因素")和成都当月天气情况图,无需额外交互即可点击"下一页"
- **FR-014**: 系统MUST在第5页提供3个独立的多行文本输入框("想法1"、"想法2"、"想法3"),用户至少填写1个输入框后启用"下一页"按钮
- **FR-015**: 系统MUST在第6页显示3种实验方法(观察法、落球法、流速法),每种方法包含图片、名称和两个文本输入框("优点"和"缺点"),用户需要为所有6个输入框填写内容后才能启用"下一页"按钮
- **FR-016**: 系统MUST在第7页显示过渡页面,包含小明和小伙伴的图片及鼓励文字("开启科学探索之旅吧!"),无需额外交互即可点击"下一页"

**模拟实验页面(第8-12页)要求**:

- **FR-017**: 系统MUST在第8页左侧显示实验操作区,包含4个量筒图标(标注含水量15%/17%/19%/21%)、温度控制器(5个档位:25℃/30℃/35℃/40℃/45℃)、"计时开始"按钮、"重置"按钮和计时器显示区域
- **FR-018**: 系统MUST在第8页右侧显示小明头像、对话框("我想利用落球法测量蜂蜜的黏度...")和模拟实验步骤说明(列表形式)
- **FR-019**: 系统MUST在用户点击第8页某个量筒图标时,将该量筒标记为选中状态(视觉高亮,如边框加粗或背景颜色变化),同时取消其他量筒的选中状态(单选逻辑)
- **FR-020**: 系统MUST在用户拖动或点击温度控制器时,实时更新温度数值显示(范围:25℃-45℃,以5℃为步进单位)
- **FR-021**: 系统MUST在用户选择量筒AND设置温度后,启用"计时开始"按钮
- **FR-022**: 系统MUST在用户点击"计时开始"按钮时,播放小钢球从量筒顶部匀速下落到底部的动画,同时启动计时器(从0.0秒开始计时)
- **FR-023**: 系统MUST在小钢球到达量筒底部时,停止计时并在计时器显示区域显示最终时间(精确到0.1秒,格式如"8.3秒")
- **FR-024**: 系统MUST根据选择的含水量和温度计算小球下落时间,遵循物理规律:含水量越高→黏度越低→下落时间越短;温度越高→黏度越低→下落时间越短
- **FR-025**: 系统MUST在用户点击"重置"按钮时,清除当前实验结果(计时器归零),允许用户重新选择量筒和温度进行新实验
- **FR-026**: 系统MUST在第8页允许用户进行多次实验(无次数限制),每次实验的参数和结果都独立记录,用户可以自由探索不同组合
- **FR-027**: 系统MUST在第8页完成至少1次有效实验后,启用"下一页"按钮
- **FR-028**: 系统MUST在第9-11页保留第8页的实验操作区(左侧),右侧变为问题展示区,用户可以边做实验边回答问题
- **FR-029**: 系统MUST在第9页右侧显示单选题:"模拟实验表明,在40℃条件下,蜂蜜的含水量为多少时,小钢球的下落时间最短?",选项:15%, 17%, 19%, 21%
- **FR-030**: 系统MUST在第10页右侧显示单选题:"模拟实验表明,当蜂蜜的含水量为15%时,温度至少需要达到多少度,才能使小钢球的下落时间小于5秒?",选项:25℃, 30℃, 35℃, 40℃, 45℃
- **FR-031**: 系统MUST在第11页右侧显示单选题:"模拟实验表明,蜂蜜的含水量为多少时,小钢球的下落时间随温度升高而缩短,但变化速度较慢?",选项:15%, 17%, 19%, 21%
- **FR-032**: 系统MUST在用户选择第9/10/11页的单选答案后,启用"下一页"按钮
- **FR-033**: 系统MUST在第12页左侧显示"温度、含水量与落球时间的关系"折线图(横轴:温度,纵轴:下落时间,多条线代表不同含水量)
- **FR-034**: 系统MUST在第12页右侧显示动态表格,包含"点亮图标"列、"温度"下拉菜单列、"含水量"下拉菜单列,以及"新增"和"删除"按钮
- **FR-035**: 系统MUST在第12页动态表格初始状态包含1个空行,用户可以通过下拉菜单选择温度(25℃-45℃)和含水量(15%-21%)
- **FR-036**: 系统MUST在用户点击第12页"新增"按钮时,在表格底部添加一行新的空行,允许用户选择新的温度/含水量组合
- **FR-037**: 系统MUST在用户点击第12页"删除"按钮时,删除当前选中的表格行(至少保留1行)
- **FR-038**: 系统MUST在第12页动态表格下方提供一个多行文本输入框("理由:"),用户需要填写至少10个字符的理由说明
- **FR-039**: 系统MUST在用户完成第12页至少1个温度/含水量组合选择AND填写理由后,启用"完成实验,进入问卷"按钮

**任务总结页(第13页)要求**:

- **FR-040**: 系统MUST在第13页显示任务完成提示文字("实验数据显示,小明家28℃环境下蜂蜜的含水量约为19%...确实可能与成都多雨的高湿度环境有关。"),无需额外交互即可点击"继续"按钮

**问卷说明页(第0.2页)要求**:

- **FR-041**: 系统MUST在第0.2页显示问卷说明标题、恭喜语("恭喜完成探究任务!接下来,你将进入问卷调查部分(10分钟)。")和4条说明文字
- **FR-042**: 系统MUST在第0.2页提供"开始作答"按钮,无需额外交互即可点击

**问卷调查页面(第14-21页)要求**:

- **FR-043**: 系统MUST在第14页显示顶部指令("1、你有多同意或不同意下列陈述?")、9行问题陈述和每行对应的4个单选按钮(非常不同意、比较不同意、比较同意、非常同意)
- **FR-044**: 系统MUST在第15页显示顶部指令("2、你有多同意或不同意下列陈述?")、9行问题陈述和每行对应的4个单选按钮
- **FR-045**: 系统MUST在第16页显示顶部指令("3、你有多同意或不同意下列陈述?")、10行问题陈述和每行对应的4个单选按钮
- **FR-046**: 系统MUST在第17页显示顶部指令("4、要做以下事情时,你感到有多自信?")、5行问题陈述和每行对应的4个单选按钮(一点也不自信、不太自信、自信、非常自信)
- **FR-047**: 系统MUST在第18页显示顶部指令("5、你有多同意或不同意下列陈述?")、11行问题陈述和每行对应的4个单选按钮
- **FR-048**: 系统MUST在第19页显示顶部指令("6、请选择你参与以下各项校内科学活动的频率。")、7行活动陈述和每行对应的5个单选按钮(没有或几乎没有、大约每年一次或两次、大约每月一次或两次、大约每星期一次或两次、每天或几乎每天)
- **FR-049**: 系统MUST在第20页显示顶部指令("请选择你参与以下各项校外科学活动的频率。")、7行活动陈述和每行对应的5个单选按钮
- **FR-050**: 系统MUST在第21页显示顶部指令("8、想象用10分的评分尺度来表示你对事情所付出的努力。")、评分说明、3行问题陈述和每行对应的10个单选按钮(1-10分)
- **FR-051**: 系统MUST在第14-20页要求用户完成该页所有题目后才能启用"下一页"按钮(每行必须选择一个单选按钮)
- **FR-052**: 系统MUST在第21页要求用户完成该页所有3个题目后才能启用"提交问卷"按钮

**问卷完成页(第22页)要求**:

- **FR-053**: 系统MUST在第22页显示绿色标题("问卷已完成")、感谢语("感谢你的参与!你的回答已成功提交。祝你学习进步,生活愉快!你现在可以返回登录页面了。")和"返回登录页面"按钮
- **FR-054**: 系统MUST在用户点击第22页"返回登录页面"按钮时,清除当前会话数据并跳转到登录页面(退出测评模块)

**计时器要求**:

- **FR-055**: 系统MUST在进入第1页时启动40分钟探究任务计时器,倒计时显示在页面顶部(格式:"剩余时间 XX:XX")
- **FR-056**: 系统MUST在40分钟探究任务计时结束时,自动保存当前页数据并强制跳转到第0.2页问卷说明页,显示时间到期提示
- **FR-057**: 系统MUST在进入第14页时启动10分钟问卷计时器,倒计时显示在页面顶部
- **FR-058**: 系统MUST在10分钟问卷计时结束时,自动提交已完成的问卷数据(未完成的题目记录为空值)并跳转到第22页

**数据记录与提交要求**:

- **FR-059**: 系统MUST在用户每次操作时调用logOperation()函数,记录操作类型、时间戳和操作内容(如:点击按钮、输入文本、选择选项、实验参数)
- **FR-060**: 系统MUST在用户离开某个页面时,将该页面的所有操作日志封装为一个MarkObject对象,包含pageNumber, pageDesc, operationList, answerList, beginTime, endTime字段
- **FR-061**: 系统MUST在用户进行模拟实验时,记录每次实验的参数(量筒含水量、温度值)和结果(小球下落时间)到operationList数组
- **FR-062**: 系统MUST在用户回答第9-11页单选题和第14-21页问卷题时,将答案记录到answerList数组,格式:[{questionId: "Q9", answer: "21%"}, ...]
- **FR-063**: 系统MUST在用户点击第21页"提交问卷"按钮时,将所有页面的MarkObject数据合并为一个JSON数组,通过FormData封装后发送POST请求到/stu/saveHcMark端点
- **FR-064**: 系统MUST在数据提交成功(HTTP 200)后,显示第22页"问卷已完成"页面
- **FR-065**: 系统MUST在数据提交失败(网络错误或HTTP非200)时,显示错误提示对话框,包含"重新提交"按钮和"联系教师"按钮
- **FR-066**: 系统MUST在用户点击"重新提交"按钮时,自动重试数据提交(最多重试3次,每次间隔5秒)

**样式与布局要求**:

- **FR-067**: 系统MUST复用现有7年级模块的整体样式和布局结构,包括页面容器、左侧导航栏、顶部计时器、底部按钮区域的CSS样式
- **FR-068**: 系统MUST使用CSS Modules确保所有新增样式仅作用于本模块,不影响其他模块或全局样式
- **FR-069**: 系统MUST确保所有页面在常见屏幕分辨率下(1280x720、1366x768、1920x1080)正常显示,文字清晰可读,按钮和输入框大小合适

**错误处理要求**:

- **FR-070**: 系统MUST在检测到401未授权错误时,自动清除本地会话数据并跳转到登录页面
- **FR-071**: 系统MUST使用ErrorBoundary组件包裹整个模块,捕获React组件渲染错误,显示友好的错误页面而不是白屏
- **FR-072**: 系统MUST在实验动画播放失败时(如浏览器不支持CSS动画),降级显示静态图片和文字说明

**会话管理要求**:

- **FR-073**: 系统MUST禁止学生在多台设备上同时登录同一账号进行测评,当后端检测到同一账号在新设备登录时,自动踢掉先登录设备的会话
- **FR-074**: 系统MUST在先登录设备被踢掉会话时,显示模态提示框"您的账号已在其他设备登录,当前会话已终止",并提供"返回登录"按钮(点击后清除本地数据并跳转到登录页)
- **FR-075**: 系统MUST在定期心跳检测中验证会话有效性(建议每30秒发送一次心跳请求),如果后端返回会话失效错误,立即触发FR-074的提示逻辑

### Key Entities *(include if feature involves data)*

- **ExperimentSession**: 代表一次完整的探究实验会话,包含学生ID、开始时间、结束时间、总耗时、是否完成等属性。关联多个PageRecord对象。

- **PageRecord**: 代表学生在某个页面的操作记录,包含页面编号(pageNumber)、页面描述(pageDesc)、操作列表(operationList)、答案列表(answerList)、进入时间(beginTime)、离开时间(endTime)等属性。每个PageRecord对应一个MarkObject。

- **ExperimentTrial**: 代表模拟实验的一次试验,包含量筒含水量(waterContent: 15%/17%/19%/21%)、环境温度(temperature: 25℃-45℃)、小球下落时间(fallTime: 秒)、试验时间戳(timestamp)等属性。属于第8-12页的PageRecord。

- **QuestionnaireAnswer**: 代表问卷调查的一个答案,包含问题ID(questionId)、题目文本(questionText)、选择的选项(selectedOption)、题目类型(type: single-choice-4/single-choice-5/single-choice-10)等属性。属于第14-21页的PageRecord。

- **StudentResponse**: 代表学生对开放性问题的文字回答,包含页面编号(pageNumber)、问题描述(prompt)、学生输入内容(textContent)、字符数(charCount)等属性。用于第2/5/6/12页的文本输入。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 学生能够在40分钟内完成第0.1-13页的探究实验流程,完成率达到90%以上(基于100名学生的真实测试)
- **SC-002**: 学生能够在10分钟内完成第14-21页的问卷调查,完成率达到95%以上
- **SC-003**: 模拟实验的物理模型准确性达到95%以上,即学生进行100次实验,至少95次的小球下落时间符合物理规律(含水量和温度与下落时间的关系正确)
- **SC-004**: 数据提交成功率达到99%以上(在正常网络环境下,100名学生中至少99名能成功提交数据到后端)
- **SC-005**: 页面加载和切换速度在2秒以内,即学生点击"下一页"按钮后,目标页面在2秒内完全渲染并可交互
- **SC-006**: 模块在主流浏览器(Chrome 90+, Firefox 88+, Edge 90+)上的兼容性达到100%,所有交互功能正常工作
- **SC-007**: 学生对模块的易用性评分达到4.0/5.0以上(通过问卷调查收集的"本次测评的界面是否清晰易懂"问题的平均分)
- **SC-008**: 系统能够支持50名学生同时在线进行测评,服务器CPU使用率不超过70%,内存使用率不超过80%
- **SC-009**: 所有页面的文字输入框和单选按钮的交互响应时间在100毫秒以内,即学生点击或输入后立即获得视觉反馈
- **SC-010**: 模拟实验的小球下落动画流畅度达到60帧/秒(FPS),在常见设备上(CPU: Intel i5 8代+, RAM: 8GB+)不出现卡顿

## Assumptions

1. **用户身份假设**: 所有使用本模块的学生已通过后端认证,并在userContext中获得有效的学生ID和session信息。模块不负责用户登录和权限验证,这些功能由全局认证系统处理。

2. **浏览器环境假设**: 学生使用的浏览器支持ES6+语法、CSS3动画、Fetch API和localStorage。不支持IE11及以下版本。学校机房的浏览器版本至少为Chrome 90+或等效的现代浏览器。

3. **网络环境假设**: 学生在测评过程中网络连接稳定,至少能够在提交问卷时完成一次HTTP POST请求。如果网络不稳定,系统会在本地缓存数据并在网络恢复后重试提交。

4. **数据保留假设**: 后端API(/stu/saveHcMark)会永久保存学生的测评数据,前端不负责数据的长期存储和备份。本地localStorage仅用于临时缓存(会话级别)。

5. **物理模型假设**: 小球下落时间的计算基于简化的黏度公式,不考虑复杂的流体力学因素(如湍流、边界效应)。含水量和温度与下落时间的关系采用线性或指数近似,具体公式由教育专家提供。

6. **内容固定假设**: 所有页面的文字内容(对话、问题、说明、选项)在开发阶段确定后不会频繁修改。如果未来需要修改内容,开发者需要手动更新JSX代码中的文本常量,暂不支持后端动态配置内容。

7. **单会话假设**: 学生一次只能进行一个测评会话,不支持中途暂停后跨设备或跨会话恢复。如果学生关闭浏览器或退出登录,之前的进度将丢失(除非后端支持进度恢复,但这不在本模块范围内)。

8. **响应式设计范围假设**: 本模块针对桌面端和平板端(横屏)优化,不考虑手机端(竖屏)的适配。学校机房的显示器分辨率主要为1366x768和1920x1080,这是主要测试目标。

9. **辅助功能假设**: 本模块不要求完全符合WCAG 2.1无障碍标准。如果学生有视力障碍或使用屏幕阅读器,可能需要教师的额外帮助。未来可以考虑添加辅助功能支持。

10. **问卷题目数量假设**: 第14-21页的问卷题目总数为61题(9+9+10+5+11+7+7+3),是固定的。如果教育研究需要调整题目数量,需要修改模块代码和页面布局。

## Dependencies

- **外部依赖 - 后端API**: 模块依赖后端提供POST /stu/saveHcMark端点来接收和存储学生的测评数据。该端点需要接受FormData格式的请求,其中包含JSON字符串格式的MarkObject数组。如果后端API不可用或响应格式不符合预期,数据提交功能将失败。

- **外部依赖 - 认证系统**: 模块依赖全局认证系统提供的userContext对象,包含学生的userId, userName, sessionToken等信息。如果用户未登录或session过期(401错误),模块将自动跳转到登录页面。

- **内部依赖 - AppContext**: 模块依赖全局AppContext提供的startTaskTimer()方法来启动40分钟探究任务计时器和10分钟问卷计时器。如果AppContext不可用,计时器功能将失效。

- **内部依赖 - ModuleRegistry**: 模块必须通过ModuleRegistry进行注册,并实现标准的模块接口(moduleId, displayName, url, version, ModuleComponent, getInitialPage)。如果ModuleRegistry的API发生变化,模块需要相应调整。

- **内部依赖 - 现有7年级模块样式**: 本模块复用现有7年级模块(src/modules/grade-7/)的CSS样式和布局组件(如LeftNavigation, AssessmentPageLayout)。如果现有7年级模块的样式或组件结构被修改,本模块可能需要同步更新以保持视觉一致性。

- **内部依赖 - utils/logOperation**: 模块依赖全局工具函数logOperation()来记录用户操作。如果该函数的签名或行为发生变化,模块需要调整日志记录代码。

- **资源依赖 - 图片素材**: 模块需要以下图片资源:蜂蜜图片、小明和爸爸对话气泡背景、平板电脑图形、成都天气图、实验方法示意图(观察法/落球法/流速法)、小明和小伙伴图片、量筒图标、温度控制器UI元素、折线图背景等。这些图片需要由设计师提供,并存放在src/modules/grade-7-tracking/assets/目录下。

- **浏览器API依赖**: 模块使用以下浏览器API:localStorage(用于临时缓存数据)、Fetch API(用于数据提交)、CSS Animations(用于小球下落动画)。如果浏览器不支持这些API,需要提供polyfill或降级方案。

## Out of Scope

1. **后端数据分析功能**: 本模块仅负责收集和提交学生的测评数据,不包括后端的数据分析、报表生成、教师管理界面等功能。这些功能属于独立的管理系统模块。

2. **实时协作功能**: 本模块不支持多个学生实时协作完成同一个测评任务(如分组实验)。每个学生独立完成自己的测评。

3. **离线模式**: 本模块不支持离线使用。学生必须在有网络连接的环境下进行测评,数据提交时需要联网。

4. **跨设备进度同步**: 本模块不支持学生在A设备上完成一半测评后,在B设备上继续完成剩余部分。如果需要此功能,需要后端支持进度保存和恢复API。

5. **自适应难度**: 本模块的题目难度和内容是固定的,不会根据学生的答题表现动态调整后续题目的难度(如CAT自适应测验)。

6. **音频/视频内容**: 本模块不包含音频讲解、视频教程或语音交互功能。所有内容以文字和静态图片/动画呈现。

7. **社交分享功能**: 本模块不支持学生将测评结果或实验数据分享到社交媒体(如微信、QQ)。

8. **教师实时监控**: 本模块不提供教师实时查看学生答题进度的功能(如在线监考、屏幕广播)。教师只能在学生提交后查看结果。

9. **成绩计算与评分**: 本模块不负责计算学生的成绩或给出评分。数据提交后,评分逻辑由后端系统根据预定的评分标准处理。

10. **国际化(i18n)**: 本模块仅支持简体中文,不提供多语言切换功能(如英文、繁体中文)。如果未来需要国际化,需要重构代码以支持i18n框架。

11. **移动端竖屏适配**: 本模块针对桌面端和平板端横屏优化,不保证在手机竖屏模式下的用户体验。如果学生使用手机访问,可能会出现布局错乱或按钮难以点击的问题。

12. **辅助功能全面支持**: 本模块不完全符合WCAG 2.1无障碍标准。不提供键盘快捷键、屏幕阅读器优化、高对比度模式等辅助功能。

13. **数据导出功能**: 本模块不提供学生自行导出测评结果为PDF、Excel等格式的功能。如果需要导出,学生需要联系教师或管理员。

14. **打印功能**: 本模块不支持打印测评页面或结果报告。页面布局未针对打印进行优化。

15. **浏览器插件/扩展**: 本模块不提供浏览器插件或扩展(如Chrome Extension)来增强功能或提供快捷操作。

## Notes

- 本规范基于需求文档"7年级追踪测评需求描述.md"编写,所有页面描述、交互逻辑和数据结构均来源于该文档。
- 模拟实验的物理模型(含水量、温度与下落时间的关系)需要与教育专家确认,确保数值合理且符合中学生的认知水平。
- 问卷调查的题目内容已在需求文档中明确,无需额外设计。但如果教育研究需要调整题目,需要重新评估开发工作量。
- 本模块是现有7年级模块的"后续延展模块",应尽可能复用现有代码和样式,减少重复开发。建议在实现时创建src/modules/grade-7-tracking/目录,并从grade-7模块中抽取公共组件(如LeftNavigation, AssessmentPageLayout)到共享目录src/shared/components/。
- 数据提交失败时的重试机制(最多3次,每次间隔5秒)需要在前端实现,确保在网络不稳定时数据不丢失。
- 第12页的动态表格功能(新增/删除行)可能需要自定义实现,建议使用React的状态管理(useState)来动态维护表格行数据。
- 小球下落动画可以使用CSS3的@keyframes或React的动画库(如react-spring, framer-motion)实现,确保在主流浏览器上流畅播放。
- **导航系统说明**: 人机交互部分(第1-13页)和问卷部分(第14-21页)使用独立的页码编号系统,两个过渡页(第0.1页和第0.2页)不显示导航栏。这样设计的目的是让学生清晰地感知到测评的两个独立阶段,提高用户体验。
- **多设备登录策略**: 系统采用"后登录踢掉先登录"的策略,确保数据一致性和测评的公平性。前端需要实现定期心跳检测机制(每30秒),及时发现会话被踢掉的情况并提示学生。
