<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¬ SessionéªŒè¯å¤±è´¥ä¸“å®¶è¯Šæ–­</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .form-group { margin: 20px 0; }
        label { display: block; margin-bottom: 5px; }
        input, textarea { width: 300px; padding: 8px; }
        button { padding: 10px 20px; margin: 10px 5px; background: #007acc; color: white; border: none; cursor: pointer; }
        button:hover { background: #005a99; }
        .log { background: #f5f5f5; padding: 15px; margin: 20px 0; max-height: 700px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 12px; }
        .error { color: #d32f2f; font-weight: bold; }
        .success { color: #388e3c; font-weight: bold; }
        .warning { color: #f57c00; font-weight: bold; }
        .info { color: #1976d2; }
        .step { background: #e7f3ff; padding: 15px; margin: 15px 0; border-left: 4px solid #007acc; }
        .critical { background: #ffebee; border: 2px solid #f44336; padding: 15px; margin: 10px 0; }
        .expert { background: #f3e5f5; border: 2px solid #9c27b0; padding: 15px; margin: 10px 0; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/jsencrypt@3.3.2/bin/jsencrypt.min.js"></script>
</head>
<body>
    <h1>ğŸ”¬ SessionéªŒè¯å¤±è´¥ä¸“å®¶è¯Šæ–­</h1>
    
    <div class="critical">
        <h3>ğŸš¨ å…³é”®å‘ç°</h3>
        <p><strong>ç™»å½•åç«‹å³æäº¤ï¼ˆ1ç§’å†…ï¼‰ä»ç„¶401é”™è¯¯</strong></p>
        <p>æ’é™¤ï¼šSessionè¶…æ—¶ã€æ•°æ®æ ¼å¼ã€æ—¶æœºé—®é¢˜</p>
        <p><strong>é—®é¢˜ç„¦ç‚¹ï¼š</strong>Sessionå­˜å‚¨/éªŒè¯æœºåˆ¶å­˜åœ¨æ ¹æœ¬æ€§é—®é¢˜</p>
    </div>
    
    <div class="expert">
        <h3>ğŸ”¬ ä¸“å®¶çº§è¯Šæ–­</h3>
        <button onclick="performExpertDiagnosis()">ğŸ” æ‰§è¡Œä¸“å®¶çº§å…¨é¢è¯Šæ–­</button>
        <button onclick="compareAPIsInDetail()">ğŸ“Š è¯¦ç»†å¯¹æ¯”ä¸¤ä¸ªAPI</button>
        <button onclick="testCookieScopeIssues()">ğŸª æµ‹è¯•Cookieä½œç”¨åŸŸé—®é¢˜</button>
        <button onclick="testWithExtraAuthParams()">ğŸ” æµ‹è¯•é¢å¤–è®¤è¯å‚æ•°</button>
    </div>
    
    <div class="step">
        <strong>æ ¸å¿ƒæµ‹è¯•ï¼š</strong> æ·±åº¦Sessionæœºåˆ¶åˆ†æ
    </div>
    
    <div class="form-group">
        <label for="accountName">è´¦å·åç§°:</label>
        <input type="text" id="accountName" value="3004">
    </div>
    
    <div class="form-group">
        <label for="password">å¯†ç :</label>
        <input type="password" id="password" value="1234">
    </div>
    
    <div class="form-group">
        <label for="batchCode">æ‰¹æ¬¡å·:</label>
        <input type="text" id="batchCode" placeholder="ç™»å½•åè‡ªåŠ¨å¡«å……">
    </div>
    
    <div class="form-group">
        <label for="examNo">è€ƒå·:</label>
        <input type="text" id="examNo" placeholder="ç™»å½•åè‡ªåŠ¨å¡«å……">
    </div>
    
    <div class="form-group">
        <button onclick="testSequentialCalls()">âš¡ è¿ç»­è°ƒç”¨æµ‹è¯•</button>
        <button onclick="testDifferentContentTypes()">ğŸ“ æµ‹è¯•ä¸åŒContent-Type</button>
        <button onclick="testBothAPIsWithSameRequest()">ğŸ”„ åŒè¯·æ±‚æµ‹è¯•ä¸¤ä¸ªAPI</button>
        <button onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div class="log" id="log">
        <div>ğŸ”¬ SessionéªŒè¯å¤±è´¥ä¸“å®¶è¯Šæ–­å·¥å…·å·²å°±ç»ª</div>
        <div>ğŸ¯ <strong>ç›®æ ‡ï¼š</strong>æ‰¾å‡ºç™»å½•åç«‹å³æäº¤ä»å¤±è´¥çš„æ ¹æœ¬åŸå› </div>
        <div>ğŸ” <strong>é‡ç‚¹ï¼š</strong>Sessionå­˜å‚¨æœºåˆ¶ã€Cookieä½œç”¨åŸŸã€APIéªŒè¯é€»è¾‘å·®å¼‚</div>
    </div>

    <script>
        const PUBLIC_KEY = 'MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAM5b2W+KjQrLMIJPLaINGAd7KCt5cRq5tLoioe6L3MdyUI9E9wwkZeRD92Aqp4AFR9GrUy1Yw9vuDfShaDcEjbsCAwEAAQ==';

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : 
                            type === 'success' ? 'success' : 
                            type === 'warning' ? 'warning' :
                            type === 'info' ? 'info' : '';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '<div>ğŸ”¬ æ—¥å¿—å·²æ¸…ç©ºï¼Œä¸“å®¶è¯Šæ–­å·¥å…·å°±ç»ª</div>';
        }

        function encryptPassword(password) {
            try {
                const encrypt = new JSEncrypt();
                encrypt.setPublicKey(PUBLIC_KEY);
                const encrypted = encrypt.encrypt(password);
                if (!encrypted || encrypted === 'false') {
                    throw new Error('åŠ å¯†å¤±è´¥');
                }
                return encrypted;
            } catch (error) {
                throw new Error('å¯†ç åŠ å¯†å¤±è´¥: ' + error.message);
            }
        }

        // ä¸“å®¶çº§å…¨é¢è¯Šæ–­
        async function performExpertDiagnosis() {
            log('ğŸ”¬ å¼€å§‹ä¸“å®¶çº§å…¨é¢è¯Šæ–­...', 'info');
            log('', 'info');
            
            log('ğŸ“‹ ç¯å¢ƒåŸºç¡€ä¿¡æ¯:', 'info');
            log(`   - å½“å‰åŸŸå: ${location.hostname}`, 'info');
            log(`   - å½“å‰ç«¯å£: ${location.port}`, 'info');
            log(`   - å½“å‰åè®®: ${location.protocol}`, 'info');
            log(`   - å®Œæ•´URL: ${location.href}`, 'info');
            
            log('ğŸ“‹ åˆ†æå‡è®¾:', 'info');
            log('   1. Cookieä½œç”¨åŸŸé—®é¢˜ - JSESSIONIDå¯èƒ½åªå¯¹ç‰¹å®šè·¯å¾„æœ‰æ•ˆ', 'warning');
            log('   2. åç«¯Sessionå­˜å‚¨ä¸ä¸€è‡´ - ä¸¤ä¸ªAPIä½¿ç”¨ä¸åŒçš„Sessionå­˜å‚¨', 'warning');
            log('   3. éªŒè¯é€»è¾‘å·®å¼‚ - æ•°æ®æäº¤APIéœ€è¦é¢å¤–çš„éªŒè¯å‚æ•°', 'warning');
            log('   4. è¯·æ±‚å¤´å·®å¼‚ - æ•°æ®æäº¤éœ€è¦ç‰¹å®šçš„è¯·æ±‚å¤´', 'warning');
            
            // å¼€å§‹æµ‹è¯•
            await testSequentialCalls();
        }

        // è¯¦ç»†å¯¹æ¯”ä¸¤ä¸ªAPI
        async function compareAPIsInDetail() {
            log('ğŸ“Š å¼€å§‹è¯¦ç»†å¯¹æ¯”ä¸¤ä¸ªAPI...', 'info');
            
            const accountName = document.getElementById('accountName').value;
            const password = document.getElementById('password').value;

            if (!accountName || !password) {
                log('âŒ è¯·è¾“å…¥è´¦å·å’Œå¯†ç ', 'error');
                return;
            }

            try {
                const encryptedPassword = encryptPassword(password);
                
                // 1. ç™»å½•APIè¯¦ç»†åˆ†æ
                log('ğŸ“Š 1. ç™»å½•APIè¯¦ç»†åˆ†æ:', 'info');
                
                const loginParams = new URLSearchParams({
                    accountName: accountName,
                    accountPass: encryptedPassword,
                    type: 2
                });
                
                const loginUrl = `/stu/login?${loginParams.toString()}`;
                log(`   URL: ${loginUrl}`, 'info');
                
                const loginResponse = await fetch(loginUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
                
                log(`   å“åº”çŠ¶æ€: ${loginResponse.status}`, 'info');
                log(`   å“åº”ç±»å‹: ${loginResponse.headers.get('content-type')}`, 'info');
                
                const loginData = await loginResponse.json();
                
                if (loginData.code === 200) {
                    log('   âœ… ç™»å½•æˆåŠŸ', 'success');
                    
                    // å¡«å……è¡¨å•
                    document.getElementById('batchCode').value = loginData.obj.batchCode;
                    document.getElementById('examNo').value = loginData.obj.examNo;
                    
                    // 2. æ•°æ®æäº¤APIè¯¦ç»†åˆ†æ
                    log('ğŸ“Š 2. æ•°æ®æäº¤APIè¯¦ç»†åˆ†æ:', 'info');
                    
                    const payload = {
                        batchCode: loginData.obj.batchCode,
                        examNo: loginData.obj.examNo,
                        mark: {
                            pageNumber: "1",
                            pageDesc: "APIå¯¹æ¯”æµ‹è¯•",
                            operationList: [],
                            answerList: [],
                            beginTime: new Date().toISOString().replace('T', ' ').substring(0, 19),
                            endTime: new Date().toISOString().replace('T', ' ').substring(0, 19),
                            imgList: []
                        }
                    };
                    
                    const submitUrl = `/stu/submitPageMarkData`;
                    log(`   URL: ${submitUrl}`, 'info');
                    
                    const submitResponse = await fetch(submitUrl, {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        body: JSON.stringify(payload)
                    });
                    
                    log(`   å“åº”çŠ¶æ€: ${submitResponse.status}`, 'info');
                    log(`   å“åº”ç±»å‹: ${submitResponse.headers.get('content-type')}`, 'info');
                    
                    const submitData = await submitResponse.json();
                    log(`   å“åº”æ•°æ®: ${JSON.stringify(submitData)}`, submitData.code === 200 ? 'success' : 'error');
                    
                    // 3. å…³é”®å·®å¼‚åˆ†æ
                    log('ğŸ“Š 3. å…³é”®å·®å¼‚åˆ†æ:', 'info');
                    log(`   - ç™»å½•æ–¹æ³•: GET vs æ•°æ®æäº¤æ–¹æ³•: POST`, 'info');
                    log(`   - ç™»å½•å‚æ•°: URLå‚æ•° vs æ•°æ®æäº¤: JSON Body`, 'info');
                    log(`   - ç™»å½•è·¯å¾„: /stu/login vs æ•°æ®æäº¤: /stu/submitPageMarkData`, 'info');
                    
                    if (submitData.code === 401) {
                        log('ğŸ” SessionéªŒè¯å¤±è´¥åˆ†æ:', 'warning');
                        log('   å¯èƒ½åŸå› 1: POSTè¯·æ±‚çš„SessionéªŒè¯é€»è¾‘ä¸GETä¸åŒ', 'warning');
                        log('   å¯èƒ½åŸå› 2: è·¯å¾„/stu/submitPageMarkDataéœ€è¦é¢å¤–è®¤è¯', 'warning');
                        log('   å¯èƒ½åŸå› 3: JSONè¯·æ±‚ä½“éœ€è¦ç‰¹æ®Šå¤„ç†', 'warning');
                    }
                    
                } else {
                    log(`   âŒ ç™»å½•å¤±è´¥: ${loginData.msg}`, 'error');
                }
                
            } catch (error) {
                log(`ğŸš« APIå¯¹æ¯”é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•Cookieä½œç”¨åŸŸé—®é¢˜
        async function testCookieScopeIssues() {
            log('ğŸª æµ‹è¯•Cookieä½œç”¨åŸŸé—®é¢˜...', 'info');
            
            log('ğŸ“‹ Cookieä½œç”¨åŸŸåˆ†æ:', 'info');
            log(`   - å½“å‰é¡µé¢è·¯å¾„: ${location.pathname}`, 'info');
            log(`   - ç™»å½•APIè·¯å¾„: /stu/login`, 'info');
            log(`   - æ•°æ®æäº¤APIè·¯å¾„: /stu/submitPageMarkData`, 'info');
            
            // æµ‹è¯•ä¸åŒè·¯å¾„çš„è¯·æ±‚
            const testPaths = [
                '/stu/login',
                '/stu/submitPageMarkData',
                '/stu/',
                '/stu'
            ];
            
            for (const path of testPaths) {
                try {
                    log(`ğŸ§ª æµ‹è¯•è·¯å¾„: ${path}`, 'info');
                    
                    const response = await fetch(`${path}?test=scope`, {
                        method: 'GET',
                        credentials: 'include'
                    });
                    
                    log(`   çŠ¶æ€: ${response.status}`, response.status === 200 ? 'success' : 'warning');
                    
                } catch (error) {
                    log(`   é”™è¯¯: ${error.message}`, 'warning');
                }
            }
            
            log('ğŸ’¡ Cookieä½œç”¨åŸŸå»ºè®®:', 'info');
            log('   - å¦‚æœæŸäº›è·¯å¾„æ— æ³•è®¿é—®ï¼Œå¯èƒ½æ˜¯Cookieä½œç”¨åŸŸé—®é¢˜', 'info');
            log('   - JSESSIONIDå¯èƒ½åªå¯¹ç‰¹å®šè·¯å¾„æœ‰æ•ˆ', 'info');
        }

        // æµ‹è¯•é¢å¤–è®¤è¯å‚æ•°
        async function testWithExtraAuthParams() {
            log('ğŸ” æµ‹è¯•é¢å¤–è®¤è¯å‚æ•°...', 'info');
            
            const batchCode = document.getElementById('batchCode').value;
            const examNo = document.getElementById('examNo').value;

            if (!batchCode || !examNo) {
                log('âŒ è¯·å…ˆç™»å½•è·å–æ‰¹æ¬¡å·å’Œè€ƒå·', 'error');
                return;
            }

            const basePayload = {
                batchCode: batchCode,
                examNo: examNo,
                mark: {
                    pageNumber: "1",
                    pageDesc: "è®¤è¯å‚æ•°æµ‹è¯•",
                    operationList: [],
                    answerList: [],
                    beginTime: new Date().toISOString().replace('T', ' ').substring(0, 19),
                    endTime: new Date().toISOString().replace('T', ' ').substring(0, 19),
                    imgList: []
                }
            };

            // æµ‹è¯•ä¸åŒçš„è®¤è¯å‚æ•°ç»„åˆ
            const testCases = [
                {
                    name: 'åŸºç¡€è¯·æ±‚',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    url: '/stu/submitPageMarkData'
                },
                {
                    name: 'æºå¸¦è®¤è¯å‚æ•°çš„URL',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    url: `/stu/submitPageMarkData?batchCode=${batchCode}&examNo=${examNo}`
                },
                {
                    name: 'é¢å¤–è¯·æ±‚å¤´',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Batch-Code': batchCode,
                        'X-Exam-No': examNo,
                        'Authorization': `Bearer ${batchCode}-${examNo}`
                    },
                    url: '/stu/submitPageMarkData'
                },
                {
                    name: 'æ¨¡æ‹Ÿæµè§ˆå™¨è¯·æ±‚å¤´',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json, text/plain, */*',
                        'Accept-Language': 'zh-CN,zh;q=0.9',
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache',
                        'Sec-Fetch-Dest': 'empty',
                        'Sec-Fetch-Mode': 'cors',
                        'Sec-Fetch-Site': 'same-origin'
                    },
                    url: '/stu/submitPageMarkData'
                }
            ];

            for (const testCase of testCases) {
                try {
                    log(`ğŸ§ª æµ‹è¯•: ${testCase.name}`, 'info');
                    
                    const response = await fetch(testCase.url, {
                        method: 'POST',
                        headers: testCase.headers,
                        credentials: 'include',
                        body: JSON.stringify(basePayload)
                    });

                    const responseData = await response.json();
                    log(`   ç»“æœ: ${JSON.stringify(responseData)}`, 
                        responseData.code === 200 ? 'success' : 'warning');

                    if (responseData.code === 200) {
                        log(`ğŸ‰ æˆåŠŸï¼${testCase.name} æœ‰æ•ˆï¼`, 'success');
                        return; // æ‰¾åˆ°æœ‰æ•ˆæ–¹æ³•å°±åœæ­¢
                    }

                } catch (error) {
                    log(`   é”™è¯¯: ${error.message}`, 'error');
                }
            }
            
            log('âŒ æ‰€æœ‰è®¤è¯å‚æ•°æµ‹è¯•éƒ½å¤±è´¥', 'error');
        }

        // è¿ç»­è°ƒç”¨æµ‹è¯•
        async function testSequentialCalls() {
            log('âš¡ æ‰§è¡Œè¿ç»­è°ƒç”¨æµ‹è¯•...', 'info');
            
            const accountName = document.getElementById('accountName').value;
            const password = document.getElementById('password').value;

            if (!accountName || !password) {
                log('âŒ è¯·è¾“å…¥è´¦å·å’Œå¯†ç ', 'error');
                return;
            }

            try {
                const encryptedPassword = encryptPassword(password);
                
                // 1. ç™»å½•
                log('1ï¸âƒ£ æ‰§è¡Œç™»å½•...', 'info');
                const loginResponse = await fetch(`/stu/login?accountName=${accountName}&accountPass=${encodeURIComponent(encryptedPassword)}&type=2`, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' },
                    credentials: 'include'
                });
                
                const loginData = await loginResponse.json();
                
                if (loginData.code !== 200) {
                    log(`âŒ ç™»å½•å¤±è´¥: ${loginData.msg}`, 'error');
                    return;
                }
                
                log('âœ… ç™»å½•æˆåŠŸ', 'success');
                
                // 2. ç«‹å³æäº¤ï¼ˆ0å»¶è¿Ÿï¼‰
                log('2ï¸âƒ£ ç«‹å³æäº¤æ•°æ®ï¼ˆ0ç§’å»¶è¿Ÿï¼‰...', 'info');
                
                const payload = {
                    batchCode: loginData.obj.batchCode,
                    examNo: loginData.obj.examNo,
                    mark: {
                        pageNumber: "1",
                        pageDesc: "è¿ç»­è°ƒç”¨æµ‹è¯•",
                        operationList: [],
                        answerList: [],
                        beginTime: new Date().toISOString().replace('T', ' ').substring(0, 19),
                        endTime: new Date().toISOString().replace('T', ' ').substring(0, 19),
                        imgList: []
                    }
                };
                
                const submitResponse = await fetch('/stu/submitPageMarkData', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(payload)
                });
                
                const submitData = await submitResponse.json();
                log(`ç»“æœ: ${JSON.stringify(submitData)}`, submitData.code === 200 ? 'success' : 'error');
                
                if (submitData.code === 401) {
                    log('ğŸ” åˆ†æï¼šå³ä½¿0å»¶è¿Ÿä»ç„¶å¤±è´¥', 'warning');
                    log('ğŸ’¡ è¿™è¯´æ˜é—®é¢˜ä¸åœ¨æ—¶é—´ï¼Œè€Œåœ¨SessionéªŒè¯é€»è¾‘æœ¬èº«', 'warning');
                    
                    // å°è¯•å†æ¬¡ç™»å½•åç«‹å³ä½¿ç”¨ç›¸åŒSession
                    log('3ï¸âƒ£ æµ‹è¯•Sessionå¤ç”¨...', 'info');
                    
                    const retryResponse = await fetch('/stu/submitPageMarkData', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify(payload)
                    });
                    
                    const retryData = await retryResponse.json();
                    log(`Sessionå¤ç”¨ç»“æœ: ${JSON.stringify(retryData)}`, retryData.code === 200 ? 'success' : 'error');
                }
                
            } catch (error) {
                log(`ğŸš« è¿ç»­è°ƒç”¨æµ‹è¯•é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•ä¸åŒContent-Type
        async function testDifferentContentTypes() {
            log('ğŸ“ æµ‹è¯•ä¸åŒContent-Type...', 'info');
            
            const batchCode = document.getElementById('batchCode').value;
            const examNo = document.getElementById('examNo').value;

            if (!batchCode || !examNo) {
                log('âŒ è¯·å…ˆç™»å½•', 'error');
                return;
            }

            const payload = {
                batchCode: batchCode,
                examNo: examNo,
                mark: {
                    pageNumber: "1",
                    pageDesc: "Content-Typeæµ‹è¯•",
                    operationList: [],
                    answerList: [],
                    beginTime: new Date().toISOString().replace('T', ' ').substring(0, 19),
                    endTime: new Date().toISOString().replace('T', ' ').substring(0, 19),
                    imgList: []
                }
            };

            const contentTypes = [
                'application/json',
                'application/json; charset=utf-8',
                'text/plain',
                'application/x-www-form-urlencoded'
            ];

            for (const contentType of contentTypes) {
                try {
                    log(`ğŸ§ª æµ‹è¯•Content-Type: ${contentType}`, 'info');
                    
                    let body;
                    if (contentType === 'application/x-www-form-urlencoded') {
                        body = new URLSearchParams({
                            data: JSON.stringify(payload)
                        }).toString();
                    } else {
                        body = JSON.stringify(payload);
                    }
                    
                    const response = await fetch('/stu/submitPageMarkData', {
                        method: 'POST',
                        headers: { 'Content-Type': contentType },
                        credentials: 'include',
                        body: body
                    });

                    const responseData = await response.json();
                    log(`   ç»“æœ: ${JSON.stringify(responseData)}`, 
                        responseData.code === 200 ? 'success' : 'warning');

                } catch (error) {
                    log(`   é”™è¯¯: ${error.message}`, 'error');
                }
            }
        }

        // åŒè¯·æ±‚æµ‹è¯•ä¸¤ä¸ªAPI
        async function testBothAPIsWithSameRequest() {
            log('ğŸ”„ ç”¨ç›¸åŒè¯·æ±‚æµ‹è¯•ä¸¤ä¸ªAPI...', 'info');
            
            const testPayload = { test: 'session-check' };
            
            try {
                // æµ‹è¯•ç™»å½•API
                log('1ï¸âƒ£ æµ‹è¯•ç™»å½•APIæ¥å—POSTè¯·æ±‚...', 'info');
                const loginResponse = await fetch('/stu/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(testPayload)
                });
                
                log(`   ç™»å½•API POSTçŠ¶æ€: ${loginResponse.status}`, 'info');
                
                // æµ‹è¯•æ•°æ®æäº¤API
                log('2ï¸âƒ£ æµ‹è¯•æ•°æ®æäº¤API...', 'info');
                const submitResponse = await fetch('/stu/submitPageMarkData', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(testPayload)
                });
                
                log(`   æ•°æ®æäº¤APIçŠ¶æ€: ${submitResponse.status}`, 'info');
                
                // åˆ†æå·®å¼‚
                if (loginResponse.status !== submitResponse.status) {
                    log('ğŸ” å‘ç°APIå“åº”å·®å¼‚ï¼', 'warning');
                    log(`   ç™»å½•API: ${loginResponse.status} vs æ•°æ®æäº¤API: ${submitResponse.status}`, 'warning');
                }
                
            } catch (error) {
                log(`ğŸš« åŒè¯·æ±‚æµ‹è¯•é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', function() {
            log('ğŸ”¬ SessionéªŒè¯å¤±è´¥ä¸“å®¶è¯Šæ–­å·¥å…·å·²å°±ç»ª');
            log('ğŸ’¡ å…³é”®é—®é¢˜ï¼šç™»å½•åç«‹å³æäº¤ä»ç„¶401');
            log('ğŸ¯ è¯Šæ–­é‡ç‚¹ï¼šSessionå­˜å‚¨æœºåˆ¶ã€Cookieä½œç”¨åŸŸã€APIéªŒè¯å·®å¼‚');
            log('ğŸ“ å»ºè®®ï¼šç‚¹å‡»"æ‰§è¡Œä¸“å®¶çº§å…¨é¢è¯Šæ–­"å¼€å§‹æ·±å…¥åˆ†æ');
        });
    </script>
</body>
</html> 